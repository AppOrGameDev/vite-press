var vr=Object.defineProperty;var Br=(s,t,e)=>t in s?vr(s,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):s[t]=e;var n=(s,t,e)=>(Br(s,typeof t!="symbol"?t+"":t,e),e);import{d as ie,h as Gt,k as Qe,o as pt,c as ft,l as Es,p as Ls,y as br,z as F,E as de,n as rt,b as A,t as ae,C as ui,a5 as As,B as Pr,F as gi,N as wr,T as Ir,I as ci,_ as Ke,a6 as Tr,s as di,u as Ds,x as Rr,Z as Vr,a7 as Pe,a8 as Fs,M as Ye,a9 as Er,aa as Lr,ab as Ar,ac as Dr,ad as Fr,ae as kr,af as Nr,ag as Or,ah as zr,ai as Ur,aj as jr,ak as Yr,al as Xr,J as Hr}from"./chunks/framework.9eb963cb.js";import{u as Gr}from"./chunks/useObserver.0f160736.js";import{u as Wr}from"./chunks/useNamespace.75a6a06b.js";import{t as mi}from"./chunks/theme.2367bbd8.js";const qr=["data-src"],Xe=ie({__name:"ImageLazyLoad",props:{src:null},setup(s){const t=Gt(null);Qe(()=>{const i=Gr();t.value&&(i==null||i.observe(t.value))});const e="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNjgzMzY1OTQ3ODcwIiBjbGFzcz0iaWNvbiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjI5NTkiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCI+PHBhdGggZD0iTTAgMGgxMDI0djEwMjRIMHoiIGZpbGw9IiNGNkY2RjYiIHAtaWQ9IjI5NjAiPjwvcGF0aD48cGF0aCBkPSJNNjk1Ljc2MjI4NiAxOTkuOTI2ODU3Yzc1LjQwMTE0MyAwIDEzNi41MzAyODYgNjEuMTI5MTQzIDEzNi41MzAyODUgMTM2LjUzMDI4NnYzNTEuMDg1NzE0YzAgNzUuNDAxMTQzLTYxLjEyOTE0MyAxMzYuNTMwMjg2LTEzNi41MzAyODUgMTM2LjUzMDI4NmgtMzUxLjA4NTcxNWMtNzUuNDEwMjg2IDAtMTM2LjUzMDI4Ni02MS4xMjkxNDMtMTM2LjUzMDI4NS0xMzYuNTMwMjg2VjMzNi40NTcxNDNjMC03NS40MDExNDMgNjEuMTItMTM2LjUzMDI4NiAxMzYuNTMwMjg1LTEzNi41MzAyODZ6TTI0Ny4xNDk3MTQgNDMxLjEwNFY2ODcuNTQyODU3YzAgNTMuODYwNTcxIDQzLjY2NjI4NiA5Ny41MjY4NTcgOTcuNTI2ODU3IDk3LjUyNjg1N2gyMzguNDM2NTcyQzU3My42NDExNDMgNjAwLjQxMTQyOSA0MzAuNDY0IDQ1MC4wMDIyODYgMjQ3LjE0OTcxNCA0MzEuMTA0ek02OTUuNzcxNDI5IDIzOC45MzAyODZoLTM1MS4wODU3MTVjLTUzLjg2MDU3MSAwLTk3LjUyNjg1NyA0My42NjYyODYtOTcuNTI2ODU3IDk3LjUyNjg1N3Y2NS4yNDM0MjhjMTk5LjU3MDI4NiAxOS4wODExNDMgMzU1LjcwMjg1NyAxODIuNjI4NTcxIDM2NS4yNTcxNDMgMzgzLjM2aDgzLjM1NTQyOWM1My44NTE0MjkgMCA5Ny41MjY4NTctNDMuNjU3MTQzIDk3LjUyNjg1Ny05Ny41MTc3MTRWNTg1LjE0Mjg1N2MtNTUuMzg3NDI5LTUyLjgtMTQzLjEwNC01Mi4wMDQ1NzEtMTk3LjUyMjI4NiAyLjQwNDU3MmExNC42Mjg1NzEgMTQuNjI4NTcxIDAgMSAxLTIwLjY4MTE0My0yMC42ODExNDNjNTkuMzgyODU3LTU5LjM5MiAxNTEuNjUyNTcxLTY1Ljg2NTE0MyAyMTguMjAzNDI5LTE5LjQxOTQyOVYzMzYuNDU3MTQzYzAtNTMuODYwNTcxLTQzLjY2NjI4Ni05Ny41MjY4NTctOTcuNTI2ODU3LTk3LjUyNjg1N3ogbS01OC41MTQyODYgNjguMjY5NzE0YTQ4Ljc1ODg1NyA0OC43NTg4NTcgMCAxIDEgMCA5Ny41MjY4NTcgNDguNzU4ODU3IDQ4Ljc1ODg1NyAwIDAgMSAwLTk3LjUyNjg1N3ogbTAgMTkuNTAxNzE0YTI5LjI1NzE0MyAyOS4yNTcxNDMgMCAxIDAgMCA1OC41MTQyODYgMjkuMjU3MTQzIDI5LjI1NzE0MyAwIDAgMCAwLTU4LjUxNDI4NnoiIGZpbGw9IiNEMEQwRDAiIHAtaWQ9IjI5NjEiPjwvcGF0aD48L3N2Zz4=";return(i,r)=>(pt(),ft("img",{ref_key:"imgRef",ref:t,"data-src":s.src,src:e,alt:""},null,8,qr))}}),Zr=({src:s,filename:t})=>{const e=document.createElement("a");e.download=t??`vite-press_${Date.now()}.${s.split(".").pop()}`,e.setAttribute("href",s),e.setAttribute("style","display: none;"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},$r={mounted(s,{value:t}){s.addEventListener("click",()=>Zr(t))}},K={close:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M556.8 512L832 236.8c12.8-12.8 12.8-32 0-44.8-12.8-12.8-32-12.8-44.8 0L512 467.2l-275.2-277.333333c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8l275.2 277.333333-277.333333 275.2c-12.8 12.8-12.8 32 0 44.8 6.4 6.4 14.933333 8.533333 23.466666 8.533333s17.066667-2.133333 23.466667-8.533333L512 556.8 787.2 832c6.4 6.4 14.933333 8.533333 23.466667 8.533333s17.066667-2.133333 23.466666-8.533333c12.8-12.8 12.8-32 0-44.8L556.8 512z" fill="currentColor"></path></svg>',left:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M384 512L731.733333 202.666667c17.066667-14.933333 19.2-42.666667 4.266667-59.733334-14.933333-17.066667-42.666667-19.2-59.733333-4.266666l-384 341.333333c-10.666667 8.533333-14.933333 19.2-14.933334 32s4.266667 23.466667 14.933334 32l384 341.333333c8.533333 6.4 19.2 10.666667 27.733333 10.666667 12.8 0 23.466667-4.266667 32-14.933333 14.933333-17.066667 14.933333-44.8-4.266667-59.733334L384 512z" fill="currentColor"></path></svg>',right:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M731.733333 480l-384-341.333333c-17.066667-14.933333-44.8-14.933333-59.733333 4.266666-14.933333 17.066667-14.933333 44.8 4.266667 59.733334L640 512 292.266667 821.333333c-17.066667 14.933333-19.2 42.666667-4.266667 59.733334 8.533333 8.533333 19.2 14.933333 32 14.933333 10.666667 0 19.2-4.266667 27.733333-10.666667l384-341.333333c8.533333-8.533333 14.933333-19.2 14.933334-32s-4.266667-23.466667-14.933334-32z" fill="currentColor"></path></svg>',zoomOut:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M945.066667 898.133333l-189.866667-189.866666c55.466667-64 87.466667-149.333333 87.466667-241.066667 0-204.8-168.533333-373.333333-373.333334-373.333333S96 264.533333 96 469.333333 264.533333 842.666667 469.333333 842.666667c91.733333 0 174.933333-34.133333 241.066667-87.466667l189.866667 189.866667c6.4 6.4 14.933333 8.533333 23.466666 8.533333s17.066667-2.133333 23.466667-8.533333c8.533333-12.8 8.533333-34.133333-2.133333-46.933334zM469.333333 778.666667C298.666667 778.666667 160 640 160 469.333333S298.666667 160 469.333333 160 778.666667 298.666667 778.666667 469.333333 640 778.666667 469.333333 778.666667z" fill="currentColor"></path><path d="M597.333333 437.333333H341.333333c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h256c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32z" fill="currentColor"></path></svg>',zoomIn:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M945.066667 898.133333l-189.866667-189.866666c55.466667-64 87.466667-149.333333 87.466667-241.066667 0-204.8-168.533333-373.333333-373.333334-373.333333S96 264.533333 96 469.333333 264.533333 842.666667 469.333333 842.666667c91.733333 0 174.933333-34.133333 241.066667-87.466667l189.866667 189.866667c6.4 6.4 14.933333 8.533333 23.466666 8.533333s17.066667-2.133333 23.466667-8.533333c8.533333-12.8 8.533333-34.133333-2.133333-46.933334zM469.333333 778.666667C298.666667 778.666667 160 640 160 469.333333S298.666667 160 469.333333 160 778.666667 298.666667 778.666667 469.333333 640 778.666667 469.333333 778.666667z" fill="currentColor"></path><path d="M597.333333 437.333333h-96V341.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v96H341.333333c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h96V597.333333c0 17.066667 14.933333 32 32 32s32-14.933333 32-32v-96H597.333333c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32z" fill="currentColor"></path></svg>',reset:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M149.333333 394.666667c17.066667 0 32-14.933333 32-32v-136.533334l187.733334 187.733334c6.4 6.4 14.933333 8.533333 23.466666 8.533333s17.066667-2.133333 23.466667-8.533333c12.8-12.8 12.8-32 0-44.8l-187.733333-187.733334H362.666667c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32H149.333333c-4.266667 0-8.533333 0-10.666666 2.133334-8.533333 4.266667-14.933333 10.666667-19.2 17.066666-2.133333 4.266667-2.133333 8.533333-2.133334 12.8v213.333334c0 17.066667 14.933333 32 32 32zM874.666667 629.333333c-17.066667 0-32 14.933333-32 32v136.533334L642.133333 597.333333c-12.8-12.8-32-12.8-44.8 0s-12.8 32 0 44.8l200.533334 200.533334H661.333333c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h213.333334c4.266667 0 8.533333 0 10.666666-2.133334 8.533333-4.266667 14.933333-8.533333 17.066667-17.066666 2.133333-4.266667 2.133333-8.533333 2.133333-10.666667V661.333333c2.133333-17.066667-12.8-32-29.866666-32zM381.866667 595.2l-200.533334 200.533333V661.333333c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v213.333334c0 4.266667 0 8.533333 2.133334 10.666666 4.266667 8.533333 8.533333 14.933333 17.066666 17.066667 4.266667 2.133333 8.533333 2.133333 10.666667 2.133333h213.333333c17.066667 0 32-14.933333 32-32s-14.933333-32-32-32h-136.533333l200.533333-200.533333c12.8-12.8 12.8-32 0-44.8s-29.866667-10.666667-42.666666 0zM904.533333 138.666667c0-2.133333 0-2.133333 0 0-4.266667-8.533333-10.666667-14.933333-17.066666-17.066667-4.266667-2.133333-8.533333-2.133333-10.666667-2.133333H661.333333c-17.066667 0-32 14.933333-32 32s14.933333 32 32 32h136.533334l-187.733334 187.733333c-12.8 12.8-12.8 32 0 44.8 6.4 6.4 14.933333 8.533333 23.466667 8.533333s17.066667-2.133333 23.466667-8.533333l187.733333-187.733333V362.666667c0 17.066667 14.933333 32 32 32s32-14.933333 32-32V149.333333c-2.133333-4.266667-2.133333-8.533333-4.266667-10.666666z" fill="currentColor"></path></svg>',rotate:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M992 158.912V371.2a12.8 12.8 0 0 1-12.8 12.8h-212.288a12.8 12.8 0 0 1-9.088-21.824L970.24 149.76a12.8 12.8 0 0 1 21.824 9.088z" fill="currentColor"></path><path d="M926.912 270.464A480 480 0 0 0 32 512a32 32 0 0 0 64 0 416 416 0 0 1 775.616-209.28 32 32 0 0 0 55.296-32.256zM44.48 621.312c5.248 22.4 12.032 44.224 20.352 65.536a32 32 0 1 0 59.584-23.36 412.544 412.544 0 0 1-17.6-56.704 32 32 0 0 0-62.336 14.528z m88.832 185.6c14.08 18.048 29.44 35.072 45.888 50.944a32 32 0 1 0 44.352-46.08 418.56 418.56 0 0 1-39.808-44.16 32 32 0 1 0-50.432 39.36z m158.08 131.52c20.352 10.496 41.408 19.584 63.04 27.136a32 32 0 0 0 21.056-60.48 413.376 413.376 0 0 1-54.592-23.488 32 32 0 0 0-29.44 56.832z m205.184 53.312l14.592 0.256c18.816 0 36.8-0.96 54.656-3.008a32 32 0 1 0-7.04-63.616c-10.368 1.216-20.8 1.92-31.36 2.368l-16.192 0.256-12.672-0.192a32 32 0 1 0-1.984 64z m202.752-37.696c21.12-8.96 41.472-19.392 61.056-31.232a32 32 0 1 0-33.152-54.72c-16.96 10.24-34.624 19.328-52.928 27.072a32 32 0 0 0 24.96 58.88z" fill="currentColor"></path><path d="M370.368 384c-32.64 0-59.712 9.92-81.792 30.208-22.016 19.84-32.576 44.8-32.576 75.904 0 30.144 9.152 54.72 28.032 73.728 19.264 19.392 45.44 29.312 77.568 29.312 17.024 0 32.128-3.456 45.44-9.472 13.824-6.912 25.728-16.832 34.944-30.208h1.856l0.448 5.632c0 29.76-6.912 54.784-19.776 74.624-13.76 20.672-31.68 31.488-54.144 31.488-33.088 0-53.312-15.104-59.712-44.864h-48.64c8.192 55.616 44.032 83.648 107.84 83.648 37.696 0 67.52-16 90.048-47.04 21.568-31.04 32.64-71.552 32.64-121.6 0-47.424-10.624-84.096-30.848-110.4C440.576 397.44 410.304 384 370.368 384z m1.792 38.784c19.328 0 35.392 6.08 47.744 18.112 11.968 11.648 18.368 27.648 18.368 47.872 0 19.84-5.952 36.288-17.92 48.32-11.904 12.096-28.416 18.112-48.64 18.112-20.672 0-36.736-6.016-48.192-18.112-12.416-11.648-18.368-27.136-18.368-46.976s5.952-35.84 18.368-48.32c11.904-12.928 28.48-19.008 48.64-19.008zM649.6 384c-38.592 0-68.48 15.104-89.6 45.696-19.2 28.032-28.864 65.984-28.864 114.304 0 47.872 9.6 85.824 28.928 114.304 21.12 30.144 50.944 45.696 89.536 45.696s68.416-15.552 89.536-45.696C758.336 629.76 768 591.36 768 544c0-47.872-9.6-85.824-28.928-114.304-21.12-30.592-50.944-45.696-89.6-45.696z m0 39.68c26.624 0 45.888 13.824 56.96 41.856 7.808 18.944 11.904 45.248 11.904 78.464 0 32.768-4.096 59.072-11.904 78.464-11.072 27.648-30.336 41.856-56.96 41.856-27.072 0-45.952-14.208-56.96-41.856-8.256-19.392-11.904-45.696-11.904-78.464 0-33.216 3.648-59.52 11.904-78.464 11.008-28.032 29.888-41.856 56.96-41.856z" fill="currentColor"></path></svg>',best:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M970.837333 919.850667l-205.696-205.653334A382.421333 382.421333 0 0 0 853.333333 469.333333a384 384 0 0 0-384-384 384 384 0 0 0-384 384 384 384 0 0 0 384 384 382.421333 382.421333 0 0 0 244.906667-88.192l205.653333 205.653334a36.053333 36.053333 0 0 0 50.986667 0 36.266667 36.266667 0 0 0-0.042667-50.944z m-380.117333-162.986667c-38.4 16.256-79.189333 24.448-121.386667 24.448a311.296 311.296 0 0 1-220.586666-91.392A311.296 311.296 0 0 1 157.312 469.333333 311.296 311.296 0 0 1 248.746667 248.746667 311.296 311.296 0 0 1 469.333333 157.354667a311.296 311.296 0 0 1 220.586667 91.392A311.296 311.296 0 0 1 781.354667 469.333333a311.296 311.296 0 0 1-91.392 220.586667 310.186667 310.186667 0 0 1-99.242667 66.901333z" fill="currentColor"></path><path d="M280.490667 597.333333v-35.541333h47.488V422.016h-40.021334v-27.178667c22.101333-4.181333 37.333333-9.856 51.370667-18.517333h32.554667v185.472h41.514666V597.333333H280.490667z m199.808-109.312c-15.530667 0-27.178667-12.245333-27.178667-28.373333 0-16.426667 11.648-28.672 27.178667-28.672 15.829333 0 27.477333 12.245333 27.477333 28.672 0 16.128-11.648 28.373333-27.477333 28.373333z m0 113.493334c-15.530667 0-27.178667-12.544-27.178667-28.672 0-16.128 11.648-28.672 27.178667-28.672 15.829333 0 27.477333 12.544 27.477333 28.672 0 16.128-11.648 28.672-27.477333 28.672zM553.472 597.333333v-35.541333h47.488V422.016h-40.021333v-27.178667c22.101333-4.181333 37.333333-9.856 51.370666-18.517333h32.554667v185.472h41.514667V597.333333h-132.906667z" fill="currentColor"></path></svg>',download:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M896 672c-17.066667 0-32 14.933333-32 32v128c0 6.4-4.266667 10.666667-10.666667 10.666667H170.666667c-6.4 0-10.666667-4.266667-10.666667-10.666667v-128c0-17.066667-14.933333-32-32-32s-32 14.933333-32 32v128c0 40.533333 34.133333 74.666667 74.666667 74.666667h682.666666c40.533333 0 74.666667-34.133333 74.666667-74.666667v-128c0-17.066667-14.933333-32-32-32z" fill="currentColor"></path><path d="M488.533333 727.466667c6.4 6.4 14.933333 8.533333 23.466667 8.533333s17.066667-2.133333 23.466667-8.533333l213.333333-213.333334c12.8-12.8 12.8-32 0-44.8-12.8-12.8-32-12.8-44.8 0l-157.866667 157.866667V170.666667c0-17.066667-14.933333-32-32-32s-34.133333 14.933333-34.133333 32v456.533333L322.133333 469.333333c-12.8-12.8-32-12.8-44.8 0-12.8 12.8-12.8 32 0 44.8l211.2 213.333334z" fill="currentColor"></path></svg>',modular:'<svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg"><path d="M405.333333 458.666667H149.333333c-29.866667 0-53.333333-23.466667-53.333333-53.333334V149.333333c0-29.866667 23.466667-53.333333 53.333333-53.333333h256c29.866667 0 53.333333 23.466667 53.333334 53.333333v256c0 29.866667-23.466667 53.333333-53.333334 53.333334z m-245.333333-64h234.666667v-234.666667h-234.666667v234.666667zM874.666667 458.666667H618.666667c-29.866667 0-53.333333-23.466667-53.333334-53.333334V149.333333c0-29.866667 23.466667-53.333333 53.333334-53.333333h256c29.866667 0 53.333333 23.466667 53.333333 53.333333v256c0 29.866667-23.466667 53.333333-53.333333 53.333334z m-245.333334-64h234.666667v-234.666667h-234.666667v234.666667zM874.666667 928H618.666667c-29.866667 0-53.333333-23.466667-53.333334-53.333333V618.666667c0-29.866667 23.466667-53.333333 53.333334-53.333334h256c29.866667 0 53.333333 23.466667 53.333333 53.333334v256c0 29.866667-23.466667 53.333333-53.333333 53.333333z m-245.333334-64h234.666667v-234.666667h-234.666667v234.666667zM405.333333 928H149.333333c-29.866667 0-53.333333-23.466667-53.333333-53.333333V618.666667c0-29.866667 23.466667-53.333333 53.333333-53.333334h256c29.866667 0 53.333333 23.466667 53.333334 53.333334v256c0 29.866667-23.466667 53.333333-53.333334 53.333333z m-245.333333-64h234.666667v-234.666667h-234.666667v234.666667z" fill="currentColor"></path></svg>'};class Jr{constructor(t,e){n(this,"el");n(this,"oTransformX",0);n(this,"oTransformY",0);n(this,"transformX");n(this,"transformY");n(this,"zoom");n(this,"rotate");n(this,"STEP",.25);n(this,"MIN_SCALE",.2);n(this,"MAX_SCALE",2.5);n(this,"TRANSFORM_X",0);n(this,"TRANSFORM_Y",0);n(this,"ZOOM",1);n(this,"ROTATE",0);n(this,"callback");this.el=t,this.transformX=(e==null?void 0:e.transformX)||this.TRANSFORM_X,this.transformY=(e==null?void 0:e.transformY)||this.TRANSFORM_Y,this.zoom=(e==null?void 0:e.zoom)||this.ZOOM,this.rotate=(e==null?void 0:e.rotate)||this.ROTATE,this.callback=e==null?void 0:e.callback,this.handleDefaultDraggable(),this.onDraggable(),this.onMouseWheel()}handleDefaultDraggable(){document.body.ondragstart=t=>(t.returnValue=!1,t.preventDefault(),!1)}onDraggable(){this.el.onmousedown=t=>{const e=t.clientX,i=t.clientY;document.onmousemove=r=>{const a=r.clientX-e,l=r.clientY-i;this.transformX=this.oTransformX+a,this.transformY=this.oTransformY+l,this.el.style.cursor="grabbing",this.setPosition()}},document.onmouseup=()=>{document.onmousemove=null,this.oTransformX=this.transformX,this.oTransformY=this.transformY,this.el.style.cursor="grab"}}onMouseWheel(){const t=this.throttle(this.setMouseWheel,100);this.el.onwheel=e=>{const i=e.deltaY||e.detail;t(i)}}throttle(t,e){let i=null;return(...r)=>{i||(i=setTimeout(()=>{i=null,t.apply(this,r)},e))}}setMouseWheel(t){if(t<0){if(this.zoom>=this.MAX_SCALE){this.el.style.cursor="not-allowed";return}this.el.style.cursor="zoom-in",this.setZoomIn(this.STEP)}else{if(this.zoom<=this.MIN_SCALE){this.el.style.cursor="not-allowed";return}this.el.style.cursor="zoom-out",this.setZoomOut(this.STEP)}this.setPosition()}setZoomIn(t=this.STEP){var e;this.zoom=Math.min(this.MAX_SCALE,this.zoom+t),this.setPosition(),(e=this.callback)==null||e.call(this,this.zoom)}setZoomOut(t=this.STEP){var e;this.zoom=Math.max(this.MIN_SCALE,this.zoom-t),this.setPosition(),(e=this.callback)==null||e.call(this,this.zoom)}setZoomBest(){var d;const t=this.rotate/.25%2===0,{clientWidth:e,clientHeight:i}=this.el,{clientWidth:r=0,clientHeight:a=0}=this.el.parentElement||{},l=(..._)=>[Math.min(..._),Math.max(..._)],[o,h]=l(e,i),[u,g]=l(r-32,a-32),m=+(r/a).toFixed(4),p=+(t?e/i:i/e).toFixed(4),c=m>1&&p>1?m>p?u/o:g/h:m<p?p>1?1:u/o:m>1?u/h:u/o;this.transformX=this.TRANSFORM_X,this.transformY=this.TRANSFORM_Y,this.zoom=Math.min(this.MAX_SCALE,c),this.setPosition(),(d=this.callback)==null||d.call(this,this.zoom)}setZoomOriginal(){this.reset(),this.setPosition()}setRotate(){this.rotate+=.25,this.setPosition()}reset(){var t;this.transformX=this.TRANSFORM_X,this.transformY=this.TRANSFORM_Y,this.oTransformX=this.transformX,this.oTransformY=this.transformY,this.zoom=this.ZOOM,(t=this.callback)==null||t.call(this,this.zoom)}setPosition(){this.el.style.transform=`translate(${this.transformX}px, ${this.transformY}px) scale(${this.zoom}) rotate(${this.rotate}turn)`}}const Qr=["disabled","innerHTML"],Kr=["disabled","innerHTML"],ta=["innerHTML"],ea=["disabled","innerHTML"],ia=["disabled","innerHTML"],sa=["innerHTML"],ra=["innerHTML"],aa=["innerHTML"],na=["innerHTML"],oa=["innerHTML"],la=["onClick"],ha=ie({__name:"image-preview",props:{url:{type:String,default:"",required:!0},previewUrlList:{type:Array,default:()=>[],required:!0},zIndex:{type:Number,required:!1},backDropZIndex:{type:Number,required:!1}},setup(s){const t=s,e=Wr("image-preview");let i=null;const r=Gt(0),a=Es(()=>t.previewUrlList[r.value]),l=Gt(1),o=t.zIndex?{zIndex:t.zIndex}:{},h=t.backDropZIndex?{zIndex:t.backDropZIndex}:{},u=()=>{const E=document.querySelector(`.${e.e("main-image")}`);i=new Jr(E,{callback:ut=>{l.value=ut}})},g=()=>{r.value=t.previewUrlList.findIndex(E=>E===t.url)},m=()=>{r.value=r.value<=0?t.previewUrlList.length-1:r.value-1,i==null||i.setZoomOriginal()},p=()=>{r.value=r.value>=t.previewUrlList.length-1?0:r.value+1,i==null||i.setZoomOriginal()},c=()=>Bt.close(),d=()=>i==null?void 0:i.setZoomIn(),_=()=>i==null?void 0:i.setZoomOut(),f=()=>i==null?void 0:i.setRotate(),b=()=>i==null?void 0:i.setZoomBest(),y=()=>i==null?void 0:i.setZoomOriginal(),B=E=>{E.defaultPrevented||(E.code==="Escape"?c():E.code==="ArrowLeft"?m():E.code==="ArrowRight"&&p())},I=()=>document.addEventListener("keydown",B,!1),S=()=>document.removeEventListener("keydown",B,!1),x=E=>{r.value=E},V=Gt(!1),Y=()=>{V.value=!V.value};return Ls(()=>{g(),u(),I()}),br(()=>{S()}),(E,ut)=>{var st,St;return pt(),ft(gi,null,[F("div",{class:rt(A(e).b()),style:ci(A(o))},[de(Xe,{class:rt(A(e).e("main-image")),src:A(a),alt:""},null,8,["class","src"]),F("div",{class:rt(A(e).e("toolbar"))},[F("div",{class:rt(A(e).e("toolbar-left"))},[F("button",{disabled:r.value===0,onClick:m,innerHTML:A(K).left},null,8,Qr),F("button",null,[F("span",null,ae(r.value+1)+"/"+ae(t.previewUrlList.length),1)]),F("button",{disabled:r.value===((st=t.previewUrlList)==null?void 0:st.length)-1,onClick:p,innerHTML:A(K).right},null,8,Kr),((St=t.previewUrlList)==null?void 0:St.length)>2?(pt(),ft("button",{key:0,onClick:Y},[F("i",{innerHTML:A(K).modular},null,8,ta)])):ui("",!0)],2),F("div",{class:rt(A(e).e("toolbar-middle"))},[F("button",{disabled:l.value>=2.5,onClick:d,innerHTML:A(K).zoomIn},null,8,ea),F("button",null,[F("span",null,ae(Math.round(l.value*100))+"%",1)]),F("button",{disabled:l.value<=.2,onClick:_,innerHTML:A(K).zoomOut},null,8,ia),F("button",{onClick:f,innerHTML:A(K).rotate},null,8,sa),F("button",{onClick:y,innerHTML:A(K).best},null,8,ra),F("button",{onClick:b,innerHTML:A(K).reset},null,8,aa),As(F("button",{innerHTML:A(K).download},null,8,na),[[A($r),{src:A(a)}]])],2),F("div",{class:rt(A(e).e("toolbar-right"))},[F("button",{onClick:c,innerHTML:A(K).close},null,8,oa)],2)],2),de(Ir,{name:"thumbnail"},{default:Pr(()=>[V.value?(pt(),ft("div",{key:0,class:rt(A(e).e("thumbnail"))},[(pt(!0),ft(gi,null,wr(t.previewUrlList,(hi,Ve)=>(pt(),ft("div",{key:hi,class:rt([A(e).e("thumbnail-item"),Ve===r.value?"active":""]),onClick:zo=>x(Ve)},[de(Xe,{src:hi},null,8,["src"]),F("span",null,ae(Ve+1),1)],10,la))),128))],2)):ui("",!0)]),_:1})],6),F("div",{class:rt(A(e).e("bg")),style:ci(A(h))},null,6)],64)}}});const ua=Ke(ha,[["__scopeId","data-v-57a592c3"]]),ga=s=>Tr(ua,s);class Bt{static open(t){this.$body=document.body,this.$div=document.createElement("div"),this.$div.setAttribute("id",this.$id),this.$overflow=this.$body.style.overflow,this.$body.appendChild(this.$div),ga(t).mount(this.$div),this.$body.style.setProperty("overflow","hidden","important")}static close(){var e,i;(e=this.$body)==null||e.style.setProperty("overflow",this.$overflow),this.$overflow="";const t=this.$div??document.getElementById(this.$id);t&&((i=this.$body)==null||i.removeChild(t)),this.$body=null,this.$div=null}}n(Bt,"$body",null),n(Bt,"$div",null),n(Bt,"$id","vite-press__image-preview"),n(Bt,"$overflow","");const ks=s=>{Bt.open({url:s.url,previewUrlList:s.previewUrlList,zIndex:s.zIndex,backDropZIndex:s.backDropZIndex})},_i=()=>{Bt.close()},Ns=s=>{let t=null;return s.scopeSelector&&(t=document.querySelector(s.scopeSelector)),[...(t||s).querySelectorAll("img")].map(i=>i.getAttribute("data-src")||i.getAttribute("src")||"")},Os=s=>{var i;s.stopPropagation();const t=s.currentTarget,e=s.target;if(((i=e==null?void 0:e.nodeName)==null?void 0:i.toLowerCase())==="img"){const r=Ns(t),a=e.getAttribute("src");ks({url:a,previewUrlList:r,zIndex:t==null?void 0:t.zIndex,backDropZIndex:t==null?void 0:t.backDropZIndex})}},Ee=s=>{s.addEventListener("click",Os)},ca=s=>{s.removeEventListener("click",Os)},da={mounted(s,t){if(!(t!=null&&t.value))return Ee(s);const{custom:e,disableDefault:i,scopeSelector:r}=t.value;s.scopeSelector=r,e&&(e.open=()=>{const a=Ns(s);ks({url:a==null?void 0:a[0],previewUrlList:a,zIndex:s==null?void 0:s.zIndex,backDropZIndex:s==null?void 0:s.backDropZIndex})},e.close=()=>_i()),!i&&Ee(s)},unmounted(){_i()},updated(s,t){var e,i;if(s.zIndex=(e=t.value)==null?void 0:e.zIndex,s.backDropZIndex=(i=t.value)==null?void 0:i.backDropZIndex,t.value){const{value:{disableDefault:r},oldValue:a}=t,{disableDefault:l}=a||{};r!==l&&(r?ca(s):Ee(s))}}},ma={class:"image-preview"},_a=ie({__name:"ImagePreview",props:{src:null},setup(s){const t=da;return(e,i)=>As((pt(),ft("div",ma,[de(Xe,{src:s.src},null,8,["src"])])),[[A(t),{scopeSelector:".VPDoc .main"}]])}});const pa=Ke(_a,[["__scopeId","data-v-0452ff21"]]);var He=(s=>(s[s.Max=2]="Max",s[s.Min=.8]="Min",s))(He||{}),me=(s=>(s[s.Left=-1]="Left",s[s.Right=1]="Right",s[s.Bottom=-1]="Bottom",s[s.Top=1]="Top",s))(me||{}),Ht=(s=>(s[s.Left=-2]="Left",s[s.Right=2]="Right",s[s.Bottom=-2]="Bottom",s[s.Top=2]="Top",s))(Ht||{}),Lt=(s=>(s.Idle="Idle",s.TapBody="TapBody",s.TapLeft="TapLeft",s.TapRight="TapRight",s.Tap="Tap",s))(Lt||{}),D=(s=>(s.Head="Head",s.Body="Body",s.Left="Left",s.Right="Right",s.Other="Other",s))(D||{}),lt=(s=>(s[s.None=0]="None",s[s.Idle=1]="Idle",s[s.Normal=2]="Normal",s[s.Force=3]="Force",s))(lt||{});const bt=globalThis.document||{},j={canvas:{width:280,height:360},scale:1,debug:!1,target:bt.body,source:{path:"",models:[]},cubismCorePath:"/live2d/core/live2dCubismCore.min.js"},fa=s=>{j.target=bt.body,Object.keys(s).forEach(t=>{j.hasOwnProperty(t)&&(j[t]=s[t])})},ve=class{constructor(t=0){n(this,"_ptr");n(this,"_size");n(this,"_capacity");t<1?(this._ptr=[],this._capacity=0,this._size=0):(this._ptr=new Array(t),this._capacity=t,this._size=0)}at(t){return this._ptr[t]}set(t,e){this._ptr[t]=e}get(t=0){const e=new Array;for(let i=t;i<this._size;i++)e.push(this._ptr[i]);return e}pushBack(t){this._size>=this._capacity&&this.prepareCapacity(this._capacity==0?ve.s_defaultSize:this._capacity*2),this._ptr[this._size++]=t}clear(){this._ptr.length=0,this._size=0}getSize(){return this._size}assign(t,e){this._size<t&&this.prepareCapacity(t);for(let i=0;i<t;i++)this._ptr[i]=e;this._size=t}resize(t,e=null){this.updateSize(t,e,!0)}updateSize(t,e=null,i=!0){if(this._size<t)if(this.prepareCapacity(t),i)for(let r=this._size;r<t;r++)typeof e=="function"?this._ptr[r]=JSON.parse(JSON.stringify(new e)):this._ptr[r]=e;else for(let r=this._size;r<t;r++)this._ptr[r]=e;else{const r=this._size-t;this._ptr.splice(this._size-r,r)}this._size=t}insert(t,e,i){let r=t._index;const a=e._index,l=i._index,o=l-a;this.prepareCapacity(this._size+o);const h=this._size-r;if(h>0)for(let u=0;u<h;u++)this._ptr.splice(r+u,0,null);for(let u=a;u<l;u++,r++)this._ptr[r]=e._vector._ptr[u];this._size=this._size+o}remove(t){return t<0||this._size<=t?!1:(this._ptr.splice(t,1),--this._size,!0)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._ptr.splice(e,1),--this._size,new _e(this,e))}prepareCapacity(t){t>this._capacity&&(this._capacity==0?(this._ptr=new Array(t),this._capacity=t):(this._ptr.length=t,this._capacity=t))}begin(){return this._size==0?this.end():new _e(this,0)}end(){return new _e(this,this._size)}getOffset(t){const e=new ve;return e._ptr=this.get(t),e._size=this.get(t).length,e._capacity=this.get(t).length,e}};let v=ve;n(v,"s_defaultSize",10);let _e=class Ge{constructor(t,e){n(this,"_index");n(this,"_vector");this._vector=t??null,this._index=e??0}set(t){return this._index=t._index,this._vector=t._vector,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new Ge(this._vector,this._index++)}decrement(){return new Ge(this._vector,this._index--)}ptr(){return this._vector._ptr[this._index]}substitution(t){return this._index=t._index,this._vector=t._vector,this}notEqual(t){return this._index!=t._index||this._vector!=t._vector}};var pi;(s=>{s.csmVector=v,s.iterator=_e})(pi||(pi={}));class Z{constructor(t){n(this,"s");this.s=t}append(t,e){return this.s+=e!==void 0?t.substr(0,e):t,this}expansion(t,e){for(let i=0;i<t;i++)this.append(e);return this}getBytes(){return encodeURIComponent(this.s).replace(/%../g,"x").length}getLength(){return this.s.length}isLess(t){return this.s<t.s}isGreat(t){return this.s>t.s}isEqual(t){return this.s==t}isEmpty(){return this.s.length==0}}var fi;(s=>{s.csmString=Z})(fi||(fi={}));class qt{constructor(t){n(this,"_id");if(typeof t=="string"){this._id=new Z(t);return}this._id=t}getString(){return this._id}isEqual(t){return typeof t=="string"?this._id.isEqual(t):t instanceof Z?this._id.isEqual(t.s):t instanceof qt?this._id.isEqual(t._id.s):!1}isNotEqual(t){return typeof t=="string"?!this._id.isEqual(t):t instanceof Z?!this._id.isEqual(t.s):t instanceof qt?!this._id.isEqual(t._id.s):!1}}var yi;(s=>{s.CubismId=qt})(yi||(yi={}));class zs{constructor(){n(this,"_ids");this._ids=new v}release(){for(let t=0;t<this._ids.getSize();++t)this._ids.set(t,void 0);this._ids=null}registerIds(t){for(let e=0;e<t.length;e++)this.registerId(t[e])}registerId(t){let e=null;if(typeof t=="string"){if((e=this.findId(t))!=null)return e;e=new qt(t),this._ids.pushBack(e)}else return this.registerId(t.s);return e}getId(t){return this.registerId(t)}isExist(t){return typeof t=="string"?this.findId(t)!=null:this.isExist(t.s)}findId(t){for(let e=0;e<this._ids.getSize();++e)if(this._ids.at(e).getString().isEqual(t))return this._ids.at(e);return null}}var xi;(s=>{s.CubismIdManager=zs})(xi||(xi={}));class k{constructor(){n(this,"_tr");this._tr=new Float32Array(16),this.loadIdentity()}static multiply(t,e,i){const r=new Float32Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),a=4;for(let l=0;l<a;++l)for(let o=0;o<a;++o)for(let h=0;h<a;++h)r[o+l*4]+=t[h+l*4]*e[o+h*4];for(let l=0;l<16;++l)i[l]=r[l]}loadIdentity(){const t=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);this.setMatrix(t)}setMatrix(t){for(let e=0;e<16;++e)this._tr[e]=t[e]}getArray(){return this._tr}getScaleX(){return this._tr[0]}getScaleY(){return this._tr[5]}getTranslateX(){return this._tr[12]}getTranslateY(){return this._tr[13]}transformX(t){return this._tr[0]*t+this._tr[12]}transformY(t){return this._tr[5]*t+this._tr[13]}invertTransformX(t){return(t-this._tr[12])/this._tr[0]}invertTransformY(t){return(t-this._tr[13])/this._tr[5]}translateRelative(t,e){const i=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,t,e,0,1]);k.multiply(i,this._tr,this._tr)}translate(t,e){this._tr[12]=t,this._tr[13]=e}translateX(t){this._tr[12]=t}translateY(t){this._tr[13]=t}scaleRelative(t,e){const i=new Float32Array([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);k.multiply(i,this._tr,this._tr)}scale(t,e){this._tr[0]=t,this._tr[5]=e}multiplyByMatrix(t){k.multiply(t.getArray(),this._tr,this._tr)}clone(){const t=new k;for(let e=0;e<this._tr.length;e++)t._tr[e]=this._tr[e];return t}}var Si;(s=>{s.CubismMatrix44=k})(Si||(Si={}));class se{constructor(){n(this,"_mvpMatrix4x4");n(this,"_modelColor");n(this,"_isCulling");n(this,"_isPremultipliedAlpha");n(this,"_anisotropy");n(this,"_model");n(this,"_useHighPrecisionMask");this._isCulling=!1,this._isPremultipliedAlpha=!1,this._anisotropy=0,this._model=null,this._modelColor=new ht,this._useHighPrecisionMask=!1,this._mvpMatrix4x4=new k,this._mvpMatrix4x4.loadIdentity()}static create(){return null}static delete(t){}initialize(t){this._model=t}drawModel(){this.getModel()!=null&&(this.saveProfile(),this.doDrawModel(),this.restoreProfile())}setMvpMatrix(t){this._mvpMatrix4x4.setMatrix(t.getArray())}getMvpMatrix(){return this._mvpMatrix4x4}setModelColor(t,e,i,r){t<0?t=0:t>1&&(t=1),e<0?e=0:e>1&&(e=1),i<0?i=0:i>1&&(i=1),r<0?r=0:r>1&&(r=1),this._modelColor.R=t,this._modelColor.G=e,this._modelColor.B=i,this._modelColor.A=r}getModelColor(){return JSON.parse(JSON.stringify(this._modelColor))}setIsPremultipliedAlpha(t){this._isPremultipliedAlpha=t}isPremultipliedAlpha(){return this._isPremultipliedAlpha}setIsCulling(t){this._isCulling=t}isCulling(){return this._isCulling}setAnisotropy(t){this._anisotropy=t}getAnisotropy(){return this._anisotropy}getModel(){return this._model}useHighPrecisionMask(t){this._useHighPrecisionMask=t}isUsingHighPrecisionMask(){return this._useHighPrecisionMask}}n(se,"staticRelease");var it=(s=>(s[s.CubismBlendMode_Normal=0]="CubismBlendMode_Normal",s[s.CubismBlendMode_Additive=1]="CubismBlendMode_Additive",s[s.CubismBlendMode_Multiplicative=2]="CubismBlendMode_Multiplicative",s))(it||{});class ht{constructor(){n(this,"R");n(this,"G");n(this,"B");n(this,"A");this.R=1,this.G=1,this.B=1,this.A=1}}var Ci;(s=>{s.CubismBlendMode=it,s.CubismRenderer=se,s.CubismTextureColor=ht})(Ci||(Ci={}));const ya=(s,t,e)=>{Us.print(s,"[CSM]"+t,e)},ne=(s,t,e)=>{ya(s,t+`
`,e)},et=s=>{console.assert(s)};let Zt,nt,yt,X;Zt=(s,...t)=>{ne(At.LogLevel_Debug,"[D]"+s,t)},nt=(s,...t)=>{ne(At.LogLevel_Info,"[I]"+s,t)},yt=(s,...t)=>{ne(At.LogLevel_Warning,"[W]"+s,t)},X=(s,...t)=>{ne(At.LogLevel_Error,"[E]"+s,t)};class Us{static print(t,e,i){if(t<R.getLoggingLevel())return;const r=R.coreLogFunction;if(!r)return;const a=e.replace(/\{(\d+)\}/g,(l,o)=>i[o]);r(a)}static dumpBytes(t,e,i){for(let r=0;r<i;r++)r%16==0&&r>0?this.print(t,`
`):r%8==0&&r>0&&this.print(t,"  "),this.print(t,"{0} ",[e[r]&255]);this.print(t,`
`)}constructor(){}}var Mi;(s=>{s.CubismDebug=Us})(Mi||(Mi={}));class js{constructor(t,e){n(this,"first");n(this,"second");this.first=t??null,this.second=e??null}}const Be=class{constructor(t){n(this,"_keyValues");n(this,"_dummyValue");n(this,"_size");t!=null?t<1?(this._keyValues=[],this._dummyValue=null,this._size=0):(this._keyValues=new Array(t),this._size=t):(this._keyValues=[],this._dummyValue=null,this._size=0)}release(){this.clear()}appendKey(t){this.prepareCapacity(this._size+1,!1),this._keyValues[this._size]=new js(t),this._size+=1}getValue(t){let e=-1;for(let i=0;i<this._size;i++)if(this._keyValues[i].first==t){e=i;break}return e>=0?this._keyValues[e].second:(this.appendKey(t),this._keyValues[this._size-1].second)}setValue(t,e){let i=-1;for(let r=0;r<this._size;r++)if(this._keyValues[r].first==t){i=r;break}i>=0?this._keyValues[i].second=e:(this.appendKey(t),this._keyValues[this._size-1].second=e)}isExist(t){for(let e=0;e<this._size;e++)if(this._keyValues[e].first==t)return!0;return!1}clear(){this._keyValues=void 0,this._keyValues=null,this._keyValues=[],this._size=0}getSize(){return this._size}prepareCapacity(t,e){t>this._keyValues.length&&(this._keyValues.length==0?(!e&&t<Be.DefaultSize&&(t=Be.DefaultSize),this._keyValues.length=t):(!e&&t<this._keyValues.length*2&&(t=this._keyValues.length*2),this._keyValues.length=t))}begin(){return new Pt(this,0)}end(){return new Pt(this,this._size)}erase(t){const e=t._index;return e<0||this._size<=e?t:(this._keyValues.splice(e,1),--this._size,new Pt(this,e))}dumpAsInt(){for(let t=0;t<this._size;t++)Zt("{0} ,",this._keyValues[t]),Zt(`
`)}};let H=Be;n(H,"DefaultSize",10);class Pt{constructor(t,e){n(this,"_index");n(this,"_map");this._map=t??new H,this._index=e??0}set(t){return this._index=t._index,this._map=t._map,this}preIncrement(){return++this._index,this}preDecrement(){return--this._index,this}increment(){return new Pt(this._map,this._index++)}decrement(){const t=new Pt(this._map,this._index);return this._map=t._map,this._index=t._index,this}ptr(){return this._map._keyValues[this._index]}notEqual(t){return this._index!=t._index||this._map!=t._map}}var vi;(s=>{s.csmMap=H,s.csmPair=js,s.iterator=Pt})(vi||(vi={}));class fe{static parseJsonObject(t,e){return Object.keys(t).forEach(i=>{typeof t[i]=="boolean"?e.put(i,new W(t[i])):typeof t[i]=="string"?e.put(i,new zt(t[i])):typeof t[i]=="number"?e.put(i,new xe(t[i])):t[i]instanceof Array?e.put(i,fe.parseJsonArray(t[i])):t[i]instanceof Object?e.put(i,fe.parseJsonObject(t[i],new Ft)):t[i]==null?e.put(i,new Dt):e.put(i,t[i])}),e}static parseJsonArray(t){const e=new ti;return Object.keys(t).forEach(i=>{const r=Number(i);if(typeof r=="number")typeof t[r]=="boolean"?e.add(new W(t[r])):typeof t[r]=="string"?e.add(new zt(t[r])):typeof t[r]=="number"?e.add(new xe(t[r])):t[i]instanceof Array?e.add(this.parseJsonArray(t[i])):t[i]instanceof Object?e.add(this.parseJsonObject(t[i],new Ft)):t[i]==null?e.add(new Dt):e.add(t[i]);else if(t[i]instanceof Array)e.add(this.parseJsonArray(t[i]));else if(t[i]instanceof Object)e.add(this.parseJsonObject(t[i],new Ft));else if(t[i]==null)e.add(new Dt);else for(let a=0;a<t[i].length;a++)e.add(t[i][a])}),e}}const ye="Error: type mismatch",xa="Error: index out of bounds";var z;let U=(z=class{constructor(){n(this,"_stringBuffer")}getRawString(t,e){return this.getString(t,e)}toInt(t=0){return t}toFloat(t=0){return t}toBoolean(t=!1){return t}getSize(){return 0}getArray(t=null){return t}getVector(t=new v){return t}getMap(t){return t}getValueByIndex(t){return z.errorValue.setErrorNotForClientCall(ye)}getValueByString(t){return z.nullValue.setErrorNotForClientCall(ye)}getKeys(){return z.s_dummyKeys}isError(){return!1}isNull(){return!1}isBool(){return!1}isFloat(){return!1}isString(){return!1}isArray(){return!1}isMap(){return!1}equals(t){return!1}isStatic(){return!1}setErrorNotForClientCall(t){return $t.errorValue}static staticInitializeNotForClientCall(){W.trueValue=new W(!0),W.falseValue=new W(!1),z.errorValue=new $t("ERROR",!0),z.nullValue=new Dt,z.s_dummyKeys=new v}static staticReleaseNotForClientCall(){W.trueValue=null,W.falseValue=null,z.errorValue=null,z.nullValue=null,z.s_dummyKeys=null}},n(z,"s_dummyKeys"),n(z,"errorValue"),n(z,"nullValue"),z);class N{constructor(t,e){n(this,"_parseCallback",fe.parseJsonObject);n(this,"_error");n(this,"_lineCount");n(this,"_root");this._error=null,this._lineCount=0,this._root=null,t!=null&&this.parseBytes(t,e,this._parseCallback)}static create(t,e){const i=new N;return i.parseBytes(t,e,i._parseCallback)?i:(N.delete(i),null)}static delete(t){}getRoot(){return this._root}static arrayBufferToString(t){const e=new Uint8Array(t);let i="";for(let r=0,a=e.length;r<a;++r)i+="%"+this.pad(e[r].toString(16));return i=decodeURIComponent(i),i}static pad(t){return t.length<2?"0"+t:t}parseBytes(t,e,i){const r=new Array(1),a=N.arrayBufferToString(t);if(i==null?this._root=this.parseValue(a,e,0,r):this._root=i(JSON.parse(a),new Ft),this._error){let l="\0";return l="Json parse error : @line "+(this._lineCount+1)+`
`,this._root=new zt(l),nt("{0}",this._root.getRawString()),!1}else if(this._root==null)return this._root=new $t(new Z(this._error),!1),!1;return!0}getParseError(){return this._error}checkEndOfFile(){return this._root.getArray()[1].equals("EOF")}parseValue(t,e,i,r){if(this._error)return null;let a=null,l=i,o;for(;l<e;l++)switch(t[l]){case"-":case".":case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":{const h=new Array(1);return o=Sa(t.slice(l),h),r[0]=t.indexOf(h[0]),new xe(o)}case'"':return new zt(this.parseString(t,e,l+1,r));case"[":return a=this.parseArray(t,e,l+1,r),a;case"{":return a=this.parseObject(t,e,l+1,r),a;case"n":return l+3<e?(a=new Dt,r[0]=l+4):this._error="parse null",a;case"t":return l+3<e?(a=W.trueValue,r[0]=l+4):this._error="parse true",a;case"f":return l+4<e?(a=W.falseValue,r[0]=l+5):this._error="illegal ',' position",a;case",":return this._error="illegal ',' position",null;case"]":return r[0]=l,null;case`
`:this._lineCount++}return this._error="illegal end of value",null}parseString(t,e,i,r){if(this._error)return null;let a=i,l,o;const h=new Z("");let u=i;for(;a<e;a++)switch(l=t[a],l){case'"':return r[0]=a+1,h.append(t.slice(u),a-u),h.s;case"//":if(a++,a-1>u&&h.append(t.slice(u),a-u),u=a+1,a<e)switch(o=t[a],o){case"\\":h.expansion(1,"\\");break;case'"':h.expansion(1,'"');break;case"/":h.expansion(1,"/");break;case"b":h.expansion(1,"\b");break;case"f":h.expansion(1,"\f");break;case"n":h.expansion(1,`
`);break;case"r":h.expansion(1,"\r");break;case"t":h.expansion(1,"	");break;case"u":this._error="parse string/unicord escape not supported";break}else this._error="parse string/escape error"}return this._error="parse string/illegal end",null}parseObject(t,e,i,r){if(this._error)return null;const a=new Ft;let l="",o=i,h="";const u=Array(1);let g=!1;for(;o<e;o++){t:for(;o<e;o++)switch(h=t[o],h){case'"':if(l=this.parseString(t,e,o+1,u),this._error)return null;o=u[0],g=!0;break t;case"}":return r[0]=o+1,a;case":":this._error="illegal ':' position";break;case`
`:this._lineCount++}if(!g)return this._error="key not found",null;g=!1;t:for(;o<e;o++)switch(h=t[o],h){case":":g=!0,o++;break t;case"}":this._error="illegal '}' position";break;case`
`:this._lineCount++}if(!g)return this._error="':' not found",null;const m=this.parseValue(t,e,o,u);if(this._error)return null;o=u[0],a.put(l,m);t:for(;o<e;o++)switch(h=t[o],h){case",":break t;case"}":return r[0]=o+1,a;case`
`:this._lineCount++}}return this._error="illegal end of perseObject",null}parseArray(t,e,i,r){if(this._error)return null;let a=new ti,l=i,o;const h=new Array(1);for(;l<e;l++){const u=this.parseValue(t,e,l,h);if(this._error)return null;l=h[0],u&&a.add(u);t:for(;l<e;l++)switch(o=t[l],o){case",":break t;case"]":return r[0]=l+1,a;case`
`:++this._lineCount}}return a=void 0,this._error="illegal end of parseObject",null}}class xe extends U{constructor(e){super();n(this,"_value");this._value=e}isFloat(){return!0}getString(e,i){const r="\0";return this._value=parseFloat(r),this._stringBuffer=r,this._stringBuffer}toInt(e=0){return parseInt(this._value.toString())}toFloat(e=0){return this._value}equals(e){return typeof e=="number"?Math.round(e)?!1:e==this._value:!1}}class W extends U{constructor(e){super();n(this,"_boolValue");this._boolValue=e}isBool(){return!0}toBoolean(e=!1){return this._boolValue}getString(e,i){return this._stringBuffer=this._boolValue?"true":"false",this._stringBuffer}equals(e){return typeof e=="boolean"?e==this._boolValue:!1}isStatic(){return!0}}n(W,"trueValue"),n(W,"falseValue");class zt extends U{constructor(t){super(),typeof t=="string"&&(this._stringBuffer=t),t instanceof Z&&(this._stringBuffer=t.s)}isString(){return!0}getString(t,e){return this._stringBuffer}equals(t){return typeof t=="string"?this._stringBuffer==t:t instanceof Z?this._stringBuffer==t.s:!1}}class $t extends zt{constructor(e,i){var t=(...args)=>{super(...args);n(this,"_isStatic")};t(e),this._isStatic=i}isStatic(){return this._isStatic}setErrorNotForClientCall(e){return this._stringBuffer=e,this}isError(){return!0}}class Dt extends U{isNull(){return!0}getString(t,e){return this._stringBuffer}isStatic(){return!0}setErrorNotForClientCall(t){return this._stringBuffer=t,$t.nullValue}constructor(){super(),this._stringBuffer="NullValue"}}class ti extends U{constructor(){super();n(this,"_array");this._array=new v}release(){for(let e=this._array.begin();e.notEqual(this._array.end());e.preIncrement()){let i=e.ptr();i&&!i.isStatic()&&(i=void 0,i=null)}}isArray(){return!0}getValueByIndex(e){return e<0||this._array.getSize()<=e?U.errorValue.setErrorNotForClientCall(xa):this._array.at(e)??U.nullValue}getValueByString(e){return U.errorValue.setErrorNotForClientCall(ye)}getString(e,i){const r=i+`[
`;for(let a=this._array.begin();a.notEqual(this._array.end());a.increment()){const l=a.ptr();this._stringBuffer+=i+""+l.getString(i+" ")+`
`}return this._stringBuffer=r+i+`]
`,this._stringBuffer}add(e){this._array.pushBack(e)}getVector(e=null){return this._array}getSize(){return this._array.getSize()}}class Ft extends U{constructor(){super();n(this,"_map");n(this,"_keys");this._map=new H}release(){const e=this._map.begin();for(;e.notEqual(this._map.end());){let i=e.ptr().second;i&&!i.isStatic()&&(i=void 0,i=null),e.preIncrement()}}isMap(){return!0}getValueByString(e){if(e instanceof Z)return this._map.getValue(e.s)??U.nullValue;for(let i=this._map.begin();i.notEqual(this._map.end());i.preIncrement())if(i.ptr().first==e)return i.ptr().second==null?U.nullValue:i.ptr().second;return U.nullValue}getValueByIndex(e){return U.errorValue.setErrorNotForClientCall(ye)}getString(e,i){this._stringBuffer=i+`{
`;const r=this._map.begin();for(;r.notEqual(this._map.end());){const a=r.ptr().first,l=r.ptr().second;this._stringBuffer+=i+" "+a+" : "+l.getString(i+"   ")+` 
`,r.preIncrement()}return this._stringBuffer+=i+`}
`,this._stringBuffer}getMap(e){return this._map}put(e,i){this._map.setValue(e,i)}getKeys(){if(!this._keys){this._keys=new v;const e=this._map.begin();for(;e.notEqual(this._map.end());){const i=e.ptr().first;this._keys.pushBack(i),e.preIncrement()}}return this._keys}getSize(){return this._keys.getSize()}}var Bi;(s=>{s.CubismJson=N,s.JsonArray=ti,s.JsonBoolean=W,s.JsonError=$t,s.JsonFloat=xe,s.JsonMap=Ft,s.JsonNullvalue=Dt,s.JsonString=zt,s.Value=U})(Bi||(Bi={}));function Sa(s,t){let e=0;for(let r=1;;r++){const a=s.slice(r-1,r);if(a=="e"||a=="-"||a=="E")continue;const l=s.substring(0,r),o=Number(l);if(isNaN(o))break;e=r}let i=parseFloat(s);return isNaN(i)&&(i=NaN),t[0]=s.slice(e),i}let $=!1,wt=!1,It=null,jt=null;const xt=Object.freeze({vertexOffset:0,vertexStep:2});function Ca(s){}class R{static startUp(t=null){if($)return nt("CubismFramework.startUp() is already done."),$;if(It=t,It!=null&&Live2DCubismCore.Logging.csmSetLogFunction(It.logFunction),$=!0,$){const e=Live2DCubismCore.Version.csmGetVersion(),i=(e&4278190080)>>24,r=(e&16711680)>>16,a=e&65535,l=e;nt("Live2D Cubism Core version: {0}.{1}.{2} ({3})",("00"+i).slice(-2),("00"+r).slice(-2),("0000"+a).slice(-4),l)}return nt("CubismFramework.startUp() is complete."),$}static cleanUp(){$=!1,wt=!1,It=null,jt=null}static initialize(t=0){if(et($),!$){yt("CubismFramework is not started.");return}if(wt){yt("CubismFramework.initialize() skipped, already initialized.");return}U.staticInitializeNotForClientCall(),jt=new zs,Live2DCubismCore.Memory.initializeAmountOfMemory(t),wt=!0,nt("CubismFramework.initialize() is complete.")}static dispose(){if(et($),!$){yt("CubismFramework is not started.");return}if(!wt){yt("CubismFramework.dispose() skipped, not initialized.");return}U.staticReleaseNotForClientCall(),jt.release(),jt=null,se.staticRelease(),wt=!1,nt("CubismFramework.dispose() is complete.")}static isStarted(){return $}static isInitialized(){return wt}static coreLogFunction(t){Live2DCubismCore.Logging.csmGetLogFunction()&&Live2DCubismCore.Logging.csmGetLogFunction()(t)}static getLoggingLevel(){return It!=null?It.loggingLevel:5}static getIdManager(){return jt}constructor(){}}class Ma{constructor(){n(this,"logFunction");n(this,"loggingLevel")}}var At=(s=>(s[s.LogLevel_Verbose=0]="LogLevel_Verbose",s[s.LogLevel_Debug=1]="LogLevel_Debug",s[s.LogLevel_Info=2]="LogLevel_Info",s[s.LogLevel_Warning=3]="LogLevel_Warning",s[s.LogLevel_Error=4]="LogLevel_Error",s[s.LogLevel_Off=5]="LogLevel_Off",s))(At||{}),bi;(s=>{s.Constant=xt,s.csmDelete=Ca,s.CubismFramework=R})(bi||(bi={}));function Ys(s,t){for(var e=0,i=s.length-1;i>=0;i--){var r=s[i];r==="."?s.splice(i,1):r===".."?(s.splice(i,1),e++):e&&(s.splice(i,1),e--)}if(t)for(;e--;e)s.unshift("..");return s}var va=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/,ei=function(s){return va.exec(s).slice(1)};function We(){for(var s="",t=!1,e=arguments.length-1;e>=-1&&!t;e--){var i=e>=0?arguments[e]:"/";if(typeof i!="string")throw new TypeError("Arguments to path.resolve must be strings");i&&(s=i+"/"+s,t=i.charAt(0)==="/")}return s=Ys(ii(s.split("/"),function(r){return!!r}),!t).join("/"),(t?"/":"")+s||"."}function Xs(s){var t=Hs(s),e=Va(s,-1)==="/";return s=Ys(ii(s.split("/"),function(i){return!!i}),!t).join("/"),!s&&!t&&(s="."),s&&e&&(s+="/"),(t?"/":"")+s}function Hs(s){return s.charAt(0)==="/"}function Ba(){var s=Array.prototype.slice.call(arguments,0);return Xs(ii(s,function(t,e){if(typeof t!="string")throw new TypeError("Arguments to path.join must be strings");return t}).join("/"))}function ba(s,t){s=We(s).substr(1),t=We(t).substr(1);function e(u){for(var g=0;g<u.length&&u[g]==="";g++);for(var m=u.length-1;m>=0&&u[m]==="";m--);return g>m?[]:u.slice(g,m-g+1)}for(var i=e(s.split("/")),r=e(t.split("/")),a=Math.min(i.length,r.length),l=a,o=0;o<a;o++)if(i[o]!==r[o]){l=o;break}for(var h=[],o=l;o<i.length;o++)h.push("..");return h=h.concat(r.slice(l)),h.join("/")}var Pa="/",wa=":";function Ia(s){var t=ei(s),e=t[0],i=t[1];return!e&&!i?".":(i&&(i=i.substr(0,i.length-1)),e+i)}function Ta(s,t){var e=ei(s)[2];return t&&e.substr(-1*t.length)===t&&(e=e.substr(0,e.length-t.length)),e}function Ra(s){return ei(s)[3]}var tt={extname:Ra,basename:Ta,dirname:Ia,sep:Pa,delimiter:wa,relative:ba,join:Ba,isAbsolute:Hs,normalize:Xs,resolve:We};function ii(s,t){if(s.filter)return s.filter(t);for(var e=[],i=0;i<s.length;i++)t(s[i],i,s)&&e.push(s[i]);return e}var Va="ab".substr(-1)==="b"?function(s,t,e){return s.substr(t,e)}:function(s,t,e){return t<0&&(t=s.length+t),s.substr(t,e)};const C=Object.freeze({HitAreaPrefix:"HitArea",HitAreaHead:"Head",HitAreaBody:"Body",PartsIdCore:"Parts01Core",PartsArmPrefix:"Parts01Arm_",PartsArmLPrefix:"Parts01ArmL_",PartsArmRPrefix:"Parts01ArmR_",ParamAngleX:"ParamAngleX",ParamAngleY:"ParamAngleY",ParamAngleZ:"ParamAngleZ",ParamEyeLOpen:"ParamEyeLOpen",ParamEyeLSmile:"ParamEyeLSmile",ParamEyeROpen:"ParamEyeROpen",ParamEyeRSmile:"ParamEyeRSmile",ParamEyeBallX:"ParamEyeBallX",ParamEyeBallY:"ParamEyeBallY",ParamEyeBallForm:"ParamEyeBallForm",ParamBrowLY:"ParamBrowLY",ParamBrowRY:"ParamBrowRY",ParamBrowLX:"ParamBrowLX",ParamBrowRX:"ParamBrowRX",ParamBrowLAngle:"ParamBrowLAngle",ParamBrowRAngle:"ParamBrowRAngle",ParamBrowLForm:"ParamBrowLForm",ParamBrowRForm:"ParamBrowRForm",ParamMouthForm:"ParamMouthForm",ParamMouthOpenY:"ParamMouthOpenY",ParamCheek:"ParamCheek",ParamBodyAngleX:"ParamBodyAngleX",ParamBodyAngleY:"ParamBodyAngleY",ParamBodyAngleZ:"ParamBodyAngleZ",ParamBreath:"ParamBreath",ParamArmLA:"ParamArmLA",ParamArmRA:"ParamArmRA",ParamArmLB:"ParamArmLB",ParamArmRB:"ParamArmRB",ParamHandL:"ParamHandL",ParamHandR:"ParamHandR",ParamHairFront:"ParamHairFront",ParamHairSide:"ParamHairSide",ParamHairBack:"ParamHairBack",ParamHairFluffy:"ParamHairFluffy",ParamShoulderY:"ParamShoulderY",ParamBustX:"ParamBustX",ParamBustY:"ParamBustY",ParamBaseX:"ParamBaseX",ParamBaseY:"ParamBaseY",ParamNONE:"NONE:"});var Pi;(s=>{s.HitAreaBody=C.HitAreaBody,s.HitAreaHead=C.HitAreaHead,s.HitAreaPrefix=C.HitAreaPrefix,s.ParamAngleX=C.ParamAngleX,s.ParamAngleY=C.ParamAngleY,s.ParamAngleZ=C.ParamAngleZ,s.ParamArmLA=C.ParamArmLA,s.ParamArmLB=C.ParamArmLB,s.ParamArmRA=C.ParamArmRA,s.ParamArmRB=C.ParamArmRB,s.ParamBaseX=C.ParamBaseX,s.ParamBaseY=C.ParamBaseY,s.ParamBodyAngleX=C.ParamBodyAngleX,s.ParamBodyAngleY=C.ParamBodyAngleY,s.ParamBodyAngleZ=C.ParamBodyAngleZ,s.ParamBreath=C.ParamBreath,s.ParamBrowLAngle=C.ParamBrowLAngle,s.ParamBrowLForm=C.ParamBrowLForm,s.ParamBrowLX=C.ParamBrowLX,s.ParamBrowLY=C.ParamBrowLY,s.ParamBrowRAngle=C.ParamBrowRAngle,s.ParamBrowRForm=C.ParamBrowRForm,s.ParamBrowRX=C.ParamBrowRX,s.ParamBrowRY=C.ParamBrowRY,s.ParamBustX=C.ParamBustX,s.ParamBustY=C.ParamBustY,s.ParamCheek=C.ParamCheek,s.ParamEyeBallForm=C.ParamEyeBallForm,s.ParamEyeBallX=C.ParamEyeBallX,s.ParamEyeBallY=C.ParamEyeBallY,s.ParamEyeLOpen=C.ParamEyeLOpen,s.ParamEyeLSmile=C.ParamEyeLSmile,s.ParamEyeROpen=C.ParamEyeROpen,s.ParamEyeRSmile=C.ParamEyeRSmile,s.ParamHairBack=C.ParamHairBack,s.ParamHairFluffy=C.ParamHairFluffy,s.ParamHairFront=C.ParamHairFront,s.ParamHairSide=C.ParamHairSide,s.ParamHandL=C.ParamHandL,s.ParamHandR=C.ParamHandR,s.ParamMouthForm=C.ParamMouthForm,s.ParamMouthOpenY=C.ParamMouthOpenY,s.ParamNONE=C.ParamNONE,s.ParamShoulderY=C.ParamShoulderY,s.PartsArmLPrefix=C.PartsArmLPrefix,s.PartsArmPrefix=C.PartsArmPrefix,s.PartsArmRPrefix=C.PartsArmRPrefix,s.PartsIdCore=C.PartsIdCore})(Pi||(Pi={}));class Gs{}var wi;(s=>{s.ICubismModelSetting=Gs})(wi||(wi={}));const gt="FileReferences",Ea="Groups",La="Layout",Aa="HitAreas",Da="Moc",Fa="Textures",ka="Physics",Na="Pose",Oa="Expressions",za="Motions",Ii="UserData",ct="Name",Ti="File",Ua="Id",oe="Ids",Ri="Sound",Vi="FadeInTime",Ei="FadeOutTime",Le="LipSync",Ae="EyeBlink";class Ws extends Gs{constructor(e,i){super();n(this,"_json");n(this,"_jsonValue");this._json=N.create(e,i),this._json&&(this._jsonValue=new v,this._jsonValue.pushBack(this._json.getRoot().getValueByString(Ea)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(gt).getValueByString(Da)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(gt).getValueByString(za)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(gt).getValueByString(Oa)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(gt).getValueByString(Fa)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(gt).getValueByString(ka)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(gt).getValueByString(Na)),this._jsonValue.pushBack(this._json.getRoot().getValueByString(Aa)))}release(){N.delete(this._json),this._jsonValue=null}GetJson(){return this._json}getModelFileName(){return this.isExistModelFile()?this._jsonValue.at(1).getRawString():""}getTextureCount(){return this.isExistTextureFiles()?this._jsonValue.at(4).getSize():0}getTextureDirectory(){const e=this._jsonValue.at(4).getValueByIndex(0).getRawString().split("/"),i=e.length-1;let r="";for(let a=0;a<i;a++)r+=e[a],a<i-1&&(r+="/");return r}getTextureFileName(e){return this._jsonValue.at(4).getValueByIndex(e).getRawString()}getHitAreasCount(){return this.isExistHitAreas()?this._jsonValue.at(7).getSize():0}getHitAreaId(e){return R.getIdManager().getId(this._jsonValue.at(7).getValueByIndex(e).getValueByString(Ua).getRawString())}getHitAreaName(e){return this._jsonValue.at(7).getValueByIndex(e).getValueByString(ct).getRawString()}getPhysicsFileName(){return this.isExistPhysicsFile()?this._jsonValue.at(5).getRawString():""}getPoseFileName(){return this.isExistPoseFile()?this._jsonValue.at(6).getRawString():""}getExpressionCount(){return this.isExistExpressionFile()?this._jsonValue.at(3).getSize():0}getExpressionName(e){return this._jsonValue.at(3).getValueByIndex(e).getValueByString(ct).getRawString()}getExpressionFileName(e){return this._jsonValue.at(3).getValueByIndex(e).getValueByString(Ti).getRawString()}getMotionGroupCount(){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().getSize():0}getMotionGroupName(e){return this.isExistMotionGroups()?this._jsonValue.at(2).getKeys().at(e):null}getMotionCount(e){return this.isExistMotionGroupName(e)?this._jsonValue.at(2).getValueByString(e).getSize():0}getMotionFileName(e,i){return this.isExistMotionGroupName(e)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(i).getValueByString(Ti).getRawString():""}getMotionSoundFileName(e,i){return this.isExistMotionSoundFile(e,i)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(i).getValueByString(Ri).getRawString():""}getMotionFadeInTimeValue(e,i){return this.isExistMotionFadeIn(e,i)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(i).getValueByString(Vi).toFloat():-1}getMotionFadeOutTimeValue(e,i){return this.isExistMotionFadeOut(e,i)?this._jsonValue.at(2).getValueByString(e).getValueByIndex(i).getValueByString(Ei).toFloat():-1}getUserDataFile(){return this.isExistUserDataFile()?this._json.getRoot().getValueByString(gt).getValueByString(Ii).getRawString():""}getLayoutMap(e){const i=this._json.getRoot().getValueByString(La).getMap();if(i==null)return!1;let r=!1;for(const a=i.begin();a.notEqual(i.end());a.preIncrement())e.setValue(a.ptr().first,a.ptr().second.toFloat()),r=!0;return r}getEyeBlinkParameterCount(){if(!this.isExistEyeBlinkParameters())return 0;let e=0;for(let i=0;i<this._jsonValue.at(0).getSize();i++){const r=this._jsonValue.at(0).getValueByIndex(i);if(!(r.isNull()||r.isError())&&r.getValueByString(ct).getRawString()==Ae){e=r.getValueByString(oe).getVector().getSize();break}}return e}getEyeBlinkParameterId(e){if(!this.isExistEyeBlinkParameters())return null;for(let i=0;i<this._jsonValue.at(0).getSize();i++){const r=this._jsonValue.at(0).getValueByIndex(i);if(!(r.isNull()||r.isError())&&r.getValueByString(ct).getRawString()==Ae)return R.getIdManager().getId(r.getValueByString(oe).getValueByIndex(e).getRawString())}return null}getLipSyncParameterCount(){if(!this.isExistLipSyncParameters())return 0;let e=0;for(let i=0;i<this._jsonValue.at(0).getSize();i++){const r=this._jsonValue.at(0).getValueByIndex(i);if(!(r.isNull()||r.isError())&&r.getValueByString(ct).getRawString()==Le){e=r.getValueByString(oe).getVector().getSize();break}}return e}getLipSyncParameterId(e){if(!this.isExistLipSyncParameters())return null;for(let i=0;i<this._jsonValue.at(0).getSize();i++){const r=this._jsonValue.at(0).getValueByIndex(i);if(!(r.isNull()||r.isError())&&r.getValueByString(ct).getRawString()==Le)return R.getIdManager().getId(r.getValueByString(oe).getValueByIndex(e).getRawString())}return null}isExistModelFile(){const e=this._jsonValue.at(1);return!e.isNull()&&!e.isError()}isExistTextureFiles(){const e=this._jsonValue.at(4);return!e.isNull()&&!e.isError()}isExistHitAreas(){const e=this._jsonValue.at(7);return!e.isNull()&&!e.isError()}isExistPhysicsFile(){const e=this._jsonValue.at(5);return!e.isNull()&&!e.isError()}isExistPoseFile(){const e=this._jsonValue.at(6);return!e.isNull()&&!e.isError()}isExistExpressionFile(){const e=this._jsonValue.at(3);return!e.isNull()&&!e.isError()}isExistMotionGroups(){const e=this._jsonValue.at(2);return!e.isNull()&&!e.isError()}isExistMotionGroupName(e){const i=this._jsonValue.at(2).getValueByString(e);return!i.isNull()&&!i.isError()}isExistMotionSoundFile(e,i){const r=this._jsonValue.at(2).getValueByString(e).getValueByIndex(i).getValueByString(Ri);return!r.isNull()&&!r.isError()}isExistMotionFadeIn(e,i){const r=this._jsonValue.at(2).getValueByString(e).getValueByIndex(i).getValueByString(Vi);return!r.isNull()&&!r.isError()}isExistMotionFadeOut(e,i){const r=this._jsonValue.at(2).getValueByString(e).getValueByIndex(i).getValueByString(Ei);return!r.isNull()&&!r.isError()}isExistUserDataFile(){const e=this._json.getRoot().getValueByString(gt).getValueByString(Ii);return!e.isNull()&&!e.isError()}isExistEyeBlinkParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let e=0;e<this._jsonValue.at(0).getSize();++e)if(this._jsonValue.at(0).getValueByIndex(e).getValueByString(ct).getRawString()==Ae)return!0;return!1}isExistLipSyncParameters(){if(this._jsonValue.at(0).isNull()||this._jsonValue.at(0).isError())return!1;for(let e=0;e<this._jsonValue.at(0).getSize();++e)if(this._jsonValue.at(0).getValueByIndex(e).getValueByString(ct).getRawString()==Le)return!0;return!1}}var Li;(s=>{s.CubismModelSettingJson=Ws})(Li||(Li={}));class re{constructor(){n(this,"_breathParameters");n(this,"_currentTime");this._currentTime=0}static create(){return new re}static delete(t){}setParameters(t){this._breathParameters=t}getParameters(){return this._breathParameters}updateParameters(t,e){this._currentTime+=e;const i=this._currentTime*2*3.14159;for(let r=0;r<this._breathParameters.getSize();++r){const a=this._breathParameters.at(r);t.addParameterValueById(a.parameterId,a.offset+a.peak*Math.sin(i/a.cycle),a.weight)}}}class Vt{constructor(t,e,i,r,a){n(this,"parameterId");n(this,"offset");n(this,"peak");n(this,"cycle");n(this,"weight");this.parameterId=t??null,this.offset=e??0,this.peak=i??0,this.cycle=r??0,this.weight=a??0}}var Ai;(s=>{s.BreathParameterData=Vt,s.CubismBreath=re})(Ai||(Ai={}));const be=class{constructor(t){n(this,"_blinkingState");n(this,"_parameterIds");n(this,"_nextBlinkingTime");n(this,"_stateStartTimeSeconds");n(this,"_blinkingIntervalSeconds");n(this,"_closingSeconds");n(this,"_closedSeconds");n(this,"_openingSeconds");n(this,"_userTimeSeconds");if(this._blinkingState=0,this._nextBlinkingTime=0,this._stateStartTimeSeconds=0,this._blinkingIntervalSeconds=4,this._closingSeconds=.1,this._closedSeconds=.05,this._openingSeconds=.15,this._userTimeSeconds=0,this._parameterIds=new v,t!=null)for(let e=0;e<t.getEyeBlinkParameterCount();++e)this._parameterIds.pushBack(t.getEyeBlinkParameterId(e))}static create(t=null){return new be(t)}static delete(t){}setBlinkingInterval(t){this._blinkingIntervalSeconds=t}setBlinkingSetting(t,e,i){this._closingSeconds=t,this._closedSeconds=e,this._openingSeconds=i}setParameterIds(t){this._parameterIds=t}getParameterIds(){return this._parameterIds}updateParameters(t,e){this._userTimeSeconds+=e;let i,r=0;switch(this._blinkingState){case 2:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closingSeconds,r>=1&&(r=1,this._blinkingState=3,this._stateStartTimeSeconds=this._userTimeSeconds),i=1-r;break;case 3:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._closedSeconds,r>=1&&(this._blinkingState=4,this._stateStartTimeSeconds=this._userTimeSeconds),i=0;break;case 4:r=(this._userTimeSeconds-this._stateStartTimeSeconds)/this._openingSeconds,r>=1&&(r=1,this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming()),i=r;break;case 1:this._nextBlinkingTime<this._userTimeSeconds&&(this._blinkingState=2,this._stateStartTimeSeconds=this._userTimeSeconds),i=1;break;case 0:default:this._blinkingState=1,this._nextBlinkingTime=this.determinNextBlinkingTiming(),i=1;break}be.CloseIfZero||(i=-i);for(let a=0;a<this._parameterIds.getSize();++a)t.setParameterValueById(this._parameterIds.at(a),i)}determinNextBlinkingTiming(){const t=Math.random();return this._userTimeSeconds+t*(2*this._blinkingIntervalSeconds-1)}};let kt=be;n(kt,"CloseIfZero",!0);var qs=(s=>(s[s.EyeState_First=0]="EyeState_First",s[s.EyeState_Interval=1]="EyeState_Interval",s[s.EyeState_Closing=2]="EyeState_Closing",s[s.EyeState_Closed=3]="EyeState_Closed",s[s.EyeState_Opening=4]="EyeState_Opening",s))(qs||{}),Di;(s=>{s.CubismEyeBlink=kt,s.EyeState=qs})(Di||(Di={}));const ja=.001,De=.5,Fi="FadeInTime",ki="Link",Ya="Groups",Xa="Id";class Jt{constructor(){n(this,"_partGroups");n(this,"_partGroupCounts");n(this,"_fadeTimeSeconds");n(this,"_lastModel");this._fadeTimeSeconds=De,this._lastModel=null,this._partGroups=new v,this._partGroupCounts=new v}static create(t,e){const i=new Jt,r=N.create(t,e),a=r.getRoot();a.getValueByString(Fi).isNull()||(i._fadeTimeSeconds=a.getValueByString(Fi).toFloat(De),i._fadeTimeSeconds<=0&&(i._fadeTimeSeconds=De));const l=a.getValueByString(Ya),o=l.getSize();for(let h=0;h<o;++h){const u=l.getValueByIndex(h),g=u.getSize();let m=0;for(let p=0;p<g;++p){const c=u.getValueByIndex(p),d=new Qt,_=R.getIdManager().getId(c.getValueByString(Xa).getRawString());if(d.partId=_,!c.getValueByString(ki).isNull()){const f=c.getValueByString(ki),b=f.getSize();for(let y=0;y<b;++y){const B=new Qt,I=R.getIdManager().getId(f.getValueByIndex(y).getString());B.partId=I,d.link.pushBack(B)}}i._partGroups.pushBack(d.clone()),++m}i._partGroupCounts.pushBack(m)}return N.delete(r),i}static delete(t){}updateParameters(t,e){t!=this._lastModel&&this.reset(t),this._lastModel=t,e<0&&(e=0);let i=0;for(let r=0;r<this._partGroupCounts.getSize();r++){const a=this._partGroupCounts.at(r);this.doFade(t,e,i,a),i+=a}this.copyPartOpacities(t)}reset(t){let e=0;for(let i=0;i<this._partGroupCounts.getSize();++i){const r=this._partGroupCounts.at(i);for(let a=e;a<e+r;++a){this._partGroups.at(a).initialize(t);const l=this._partGroups.at(a).partIndex,o=this._partGroups.at(a).parameterIndex;if(!(l<0)){t.setPartOpacityByIndex(l,a==e?1:0),t.setParameterValueByIndex(o,a==e?1:0);for(let h=0;h<this._partGroups.at(a).link.getSize();++h)this._partGroups.at(a).link.at(h).initialize(t)}}e+=r}}copyPartOpacities(t){for(let e=0;e<this._partGroups.getSize();++e){const i=this._partGroups.at(e);if(i.link.getSize()==0)continue;const r=this._partGroups.at(e).partIndex,a=t.getPartOpacityByIndex(r);for(let l=0;l<i.link.getSize();++l){const o=i.link.at(l).partIndex;o<0||t.setPartOpacityByIndex(o,a)}}}doFade(t,e,i,r){let a=-1,l=1;const o=.5,h=.15;for(let u=i;u<i+r;++u){const g=this._partGroups.at(u).partIndex,m=this._partGroups.at(u).parameterIndex;if(t.getParameterValueByIndex(m)>ja){if(a>=0)break;a=u,l=t.getPartOpacityByIndex(g),l+=e/this._fadeTimeSeconds,l>1&&(l=1)}}a<0&&(a=0,l=1);for(let u=i;u<i+r;++u){const g=this._partGroups.at(u).partIndex;if(a==u)t.setPartOpacityByIndex(g,l);else{let m=t.getPartOpacityByIndex(g),p;l<o?p=l*(o-1)/o+1:p=(1-l)*o/(1-o),(1-p)*(1-l)>h&&(p=1-h/(1-l)),m>p&&(m=p),t.setPartOpacityByIndex(g,m)}}}}class Qt{constructor(t){n(this,"partId");n(this,"parameterIndex");n(this,"partIndex");n(this,"link");if(this.parameterIndex=0,this.partIndex=0,this.link=new v,t!=null){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone())}}assignment(t){this.partId=t.partId;for(const e=t.link.begin();e.notEqual(t.link.end());e.preIncrement())this.link.pushBack(e.ptr().clone());return this}initialize(t){this.parameterIndex=t.getParameterIndex(this.partId),this.partIndex=t.getPartIndex(this.partId),t.setParameterValueByIndex(this.parameterIndex,1)}clone(){const t=new Qt;t.partId=this.partId,t.parameterIndex=this.parameterIndex,t.partIndex=this.partIndex,t.link=new v;for(let e=this.link.begin();e.notEqual(this.link.end());e.increment())t.link.pushBack(e.ptr().clone());return t}}var Ni;(s=>{s.CubismPose=Jt,s.PartData=Qt})(Ni||(Ni={}));class Zs extends k{constructor(e,i){super();n(this,"_width");n(this,"_height");this._width=e!==void 0?e:0,this._height=i!==void 0?i:0,this.setHeight(2)}setWidth(e){const i=e/this._width,r=i;this.scale(i,r)}setHeight(e){const i=e/this._height,r=i;this.scale(i,r)}setPosition(e,i){this.translate(e,i)}setCenterPosition(e,i){this.centerX(e),this.centerY(i)}top(e){this.setY(e)}bottom(e){const i=this._height*this.getScaleY();this.translateY(e-i)}left(e){this.setX(e)}right(e){const i=this._width*this.getScaleX();this.translateX(e-i)}centerX(e){const i=this._width*this.getScaleX();this.translateX(e-i/2)}setX(e){this.translateX(e)}centerY(e){const i=this._height*this.getScaleY();this.translateY(e-i/2)}setY(e){this.translateY(e)}setupFromLayout(e){const i="width",r="height",a="x",l="y",o="center_x",h="center_y",u="top",g="bottom",m="left",p="right";for(const c=e.begin();c.notEqual(e.end());c.preIncrement()){const d=c.ptr().first,_=c.ptr().second;d==i?this.setWidth(_):d==r&&this.setHeight(_)}for(const c=e.begin();c.notEqual(e.end());c.preIncrement()){const d=c.ptr().first,_=c.ptr().second;d==a?this.setX(_):d==l?this.setY(_):d==o?this.centerX(_):d==h?this.centerY(_):d==u?this.top(_):d==g?this.bottom(_):d==m?this.left(_):d==p&&this.right(_)}}}var Oi;(s=>{s.CubismModelMatrix=Zs})(Oi||(Oi={}));class M{constructor(t,e){this.x=t,this.y=e,this.x=t??0,this.y=e??0}add(t){const e=new M(0,0);return e.x=this.x+t.x,e.y=this.y+t.y,e}substract(t){const e=new M(0,0);return e.x=this.x-t.x,e.y=this.y-t.y,e}multiply(t){const e=new M(0,0);return e.x=this.x*t.x,e.y=this.y*t.y,e}multiplyByScaler(t){return this.multiply(new M(t,t))}division(t){const e=new M(0,0);return e.x=this.x/t.x,e.y=this.y/t.y,e}divisionByScalar(t){return this.division(new M(t,t))}getLength(){return Math.sqrt(this.x*this.x+this.y*this.y)}getDistanceWith(t){return Math.sqrt((this.x-t.x)*(this.x-t.x)+(this.y-t.y)*(this.y-t.y))}dot(t){return this.x*t.x+this.y*t.y}normalize(){const t=Math.pow(this.x*this.x+this.y*this.y,.5);this.x=this.x/t,this.y=this.y/t}isEqual(t){return this.x==t.x&&this.y==t.y}isNotEqual(t){return!this.isEqual(t)}}var zi;(s=>{s.CubismVector2=M})(zi||(zi={}));const Wt=class{static range(t,e,i){return t<e?t=e:t>i&&(t=i),t}static sin(t){return Math.sin(t)}static cos(t){return Math.cos(t)}static abs(t){return Math.abs(t)}static sqrt(t){return Math.sqrt(t)}static cbrt(t){if(t===0)return t;let e=t;const i=e<0;i&&(e=-e);let r;return e===1/0?r=1/0:(r=Math.exp(Math.log(e)/3),r=(e/(r*r)+2*r)/3),i?-r:r}static getEasingSine(t){return t<0?0:t>1?1:.5-.5*this.cos(t*Math.PI)}static max(t,e){return t>e?t:e}static min(t,e){return t>e?e:t}static degreesToRadian(t){return t/180*Math.PI}static radianToDegrees(t){return t*180/Math.PI}static directionToRadian(t,e){const i=Math.atan2(e.y,e.x),r=Math.atan2(t.y,t.x);let a=i-r;for(;a<-Math.PI;)a+=Math.PI*2;for(;a>Math.PI;)a-=Math.PI*2;return a}static directionToDegrees(t,e){const i=this.directionToRadian(t,e);let r=this.radianToDegrees(i);return e.x-t.x>0&&(r=-r),r}static radianToDirection(t){const e=new M;return e.x=this.sin(t),e.y=this.cos(t),e}static quadraticEquation(t,e,i){return this.abs(t)<Wt.Epsilon?this.abs(e)<Wt.Epsilon?-i:-i/e:-(e+this.sqrt(e*e-4*t*i))/(2*t)}static cardanoAlgorithmForBezier(t,e,i,r){if(this.sqrt(t)<Wt.Epsilon)return this.range(this.quadraticEquation(e,i,r),0,1);const a=e/t,l=i/t,o=r/t,h=(3*l-a*a)/3,u=h/3,g=(2*a*a*a-9*a*l+27*o)/27,m=g/2,p=m*m+u*u*u,c=.5,d=c+.01;if(p<0){const B=-h/3,I=B*B*B,S=this.sqrt(I),x=-g/(2*S),V=this.range(x,-1,1),Y=Math.acos(V),E=2*this.cbrt(S),ut=E*this.cos(Y/3)-a/3;if(this.abs(ut-c)<d)return this.range(ut,0,1);const st=E*this.cos((Y+2*Math.PI)/3)-a/3;if(this.abs(st-c)<d)return this.range(st,0,1);const St=E*this.cos((Y+4*Math.PI)/3)-a/3;return this.range(St,0,1)}if(p==0){let B;m<0?B=this.cbrt(-m):B=-this.cbrt(m);const I=2*B-a/3;if(this.abs(I-c)<d)return this.range(I,0,1);const S=-B-a/3;return this.range(S,0,1)}const _=this.sqrt(p),f=this.cbrt(_-m),b=this.cbrt(_+m),y=f-b-a/3;return this.range(y,0,1)}constructor(){}};let P=Wt;n(P,"Epsilon",1e-5);var Ui;(s=>{s.CubismMath=P})(Ui||(Ui={}));const Fe=30,ji=.01;class $s{constructor(){n(this,"_faceTargetX");n(this,"_faceTargetY");n(this,"_faceX");n(this,"_faceY");n(this,"_faceVX");n(this,"_faceVY");n(this,"_lastTimeSeconds");n(this,"_userTimeSeconds");this._faceTargetX=0,this._faceTargetY=0,this._faceX=0,this._faceY=0,this._faceVX=0,this._faceVY=0,this._lastTimeSeconds=0,this._userTimeSeconds=0}update(t){this._userTimeSeconds+=t;const e=40/10*1/Fe;if(this._lastTimeSeconds==0){this._lastTimeSeconds=this._userTimeSeconds;return}const i=(this._userTimeSeconds-this._lastTimeSeconds)*Fe;this._lastTimeSeconds=this._userTimeSeconds;const r=.15*Fe,a=i*e/r,l=this._faceTargetX-this._faceX,o=this._faceTargetY-this._faceY;if(P.abs(l)<=ji&&P.abs(o)<=ji)return;const h=P.sqrt(l*l+o*o),u=e*l/h,g=e*o/h;let m=u-this._faceVX,p=g-this._faceVY;const c=P.sqrt(m*m+p*p);(c<-a||c>a)&&(m*=a/c,p*=a/c),this._faceVX+=m,this._faceVY+=p;{const d=.5*(P.sqrt(a*a+16*a*h-8*a*h)-a),_=P.sqrt(this._faceVX*this._faceVX+this._faceVY*this._faceVY);_>d&&(this._faceVX*=d/_,this._faceVY*=d/_)}this._faceX+=this._faceVX,this._faceY+=this._faceVY}getX(){return this._faceX}getY(){return this._faceY}set(t,e){this._faceTargetX=t,this._faceTargetY=e}}var Yi;(s=>{s.CubismTargetPoint=$s})(Yi||(Yi={}));class Ut{constructor(){n(this,"setFinishedMotionHandler",t=>this._onFinishedMotion=t);n(this,"getFinishedMotionHandler",()=>this._onFinishedMotion);n(this,"_fadeInSeconds");n(this,"_fadeOutSeconds");n(this,"_weight");n(this,"_offsetSeconds");n(this,"_firedEventValues");n(this,"_onFinishedMotion");this._fadeInSeconds=-1,this._fadeOutSeconds=-1,this._weight=1,this._offsetSeconds=0,this._firedEventValues=new v}static delete(t){t.release(),t=null}release(){this._weight=0}updateParameters(t,e,i){if(!e.isAvailable()||e.isFinished())return;if(!e.isStarted()){e.setIsStarted(!0),e.setStartTime(i-this._offsetSeconds),e.setFadeInStartTime(i);const o=this.getDuration();e.getEndTime()<0&&e.setEndTime(o<=0?-1:e.getStartTime()+o)}let r=this._weight;const a=this._fadeInSeconds==0?1:P.getEasingSine((i-e.getFadeInStartTime())/this._fadeInSeconds),l=this._fadeOutSeconds==0||e.getEndTime()<0?1:P.getEasingSine((e.getEndTime()-i)/this._fadeOutSeconds);r=r*a*l,e.setState(i,r),et(0<=r&&r<=1),this.doUpdateParameters(t,i,r,e),e.getEndTime()>0&&e.getEndTime()<i&&e.setIsFinished(!0)}setFadeInTime(t){this._fadeInSeconds=t}setFadeOutTime(t){this._fadeOutSeconds=t}getFadeOutTime(){return this._fadeOutSeconds}getFadeInTime(){return this._fadeInSeconds}setWeight(t){this._weight=t}getWeight(){return this._weight}getDuration(){return-1}getLoopDuration(){return-1}setOffsetTime(t){this._offsetSeconds=t}getFiredEvent(t,e){return this._firedEventValues}}var Xi;(s=>{s.ACubismMotion=Ut})(Xi||(Xi={}));const Ha="FadeInTime",Ga="FadeOutTime",Hi="Parameters",Wa="Id",qa="Value",le="Blend",Za="Add",$a="Multiply",Ja="Overwrite",Gi=1;class we extends Ut{constructor(){super();n(this,"_parameters");this._parameters=new v}static create(e,i){const r=new we,a=N.create(e,i),l=a.getRoot();r.setFadeInTime(l.getValueByString(Ha).toFloat(Gi)),r.setFadeOutTime(l.getValueByString(Ga).toFloat(Gi));const o=l.getValueByString(Hi).getSize();r._parameters.prepareCapacity(o);for(let h=0;h<o;++h){const u=l.getValueByString(Hi).getValueByIndex(h),g=R.getIdManager().getId(u.getValueByString(Wa).getRawString()),m=u.getValueByString(qa).toFloat();let p;u.getValueByString(le).isNull()||u.getValueByString(le).getString()==Za?p=0:u.getValueByString(le).getString()==$a?p=1:u.getValueByString(le).getString()==Ja?p=2:p=0;const c=new Qs;c.parameterId=g,c.blendType=p,c.value=m,r._parameters.pushBack(c)}return N.delete(a),r}doUpdateParameters(e,i,r,a){for(let l=0;l<this._parameters.getSize();++l){const o=this._parameters.at(l);switch(o.blendType){case 0:{e.addParameterValueById(o.parameterId,o.value,r);break}case 1:{e.multiplyParameterValueById(o.parameterId,o.value,r);break}case 2:{e.setParameterValueById(o.parameterId,o.value,r);break}}}}}var Js=(s=>(s[s.ExpressionBlendType_Add=0]="ExpressionBlendType_Add",s[s.ExpressionBlendType_Multiply=1]="ExpressionBlendType_Multiply",s[s.ExpressionBlendType_Overwrite=2]="ExpressionBlendType_Overwrite",s))(Js||{});class Qs{constructor(){n(this,"parameterId");n(this,"blendType");n(this,"value")}}var Wi;(s=>{s.CubismExpressionMotion=we,s.ExpressionBlendType=Js,s.ExpressionParameter=Qs})(Wi||(Wi={}));var mt=(s=>(s[s.CubismMotionCurveTarget_Model=0]="CubismMotionCurveTarget_Model",s[s.CubismMotionCurveTarget_Parameter=1]="CubismMotionCurveTarget_Parameter",s[s.CubismMotionCurveTarget_PartOpacity=2]="CubismMotionCurveTarget_PartOpacity",s))(mt||{}),J=(s=>(s[s.CubismMotionSegmentType_Linear=0]="CubismMotionSegmentType_Linear",s[s.CubismMotionSegmentType_Bezier=1]="CubismMotionSegmentType_Bezier",s[s.CubismMotionSegmentType_Stepped=2]="CubismMotionSegmentType_Stepped",s[s.CubismMotionSegmentType_InverseStepped=3]="CubismMotionSegmentType_InverseStepped",s))(J||{});class si{constructor(){n(this,"time",0);n(this,"value",0)}}class Ks{constructor(){n(this,"evaluate");n(this,"basePointIndex");n(this,"segmentType");this.evaluate=null,this.basePointIndex=0,this.segmentType=0}}class tr{constructor(){n(this,"type");n(this,"id");n(this,"segmentCount");n(this,"baseSegmentIndex");n(this,"fadeInTime");n(this,"fadeOutTime");this.type=0,this.segmentCount=0,this.baseSegmentIndex=0,this.fadeInTime=0,this.fadeOutTime=0}}class er{constructor(){n(this,"fireTime",0);n(this,"value")}}class ir{constructor(){n(this,"duration");n(this,"loop");n(this,"curveCount");n(this,"eventCount");n(this,"fps");n(this,"curves");n(this,"segments");n(this,"points");n(this,"events");this.duration=0,this.loop=!1,this.curveCount=0,this.eventCount=0,this.fps=0,this.curves=new v,this.segments=new v,this.points=new v,this.events=new v}}var qi;(s=>{s.CubismMotionCurve=tr,s.CubismMotionCurveTarget=mt,s.CubismMotionData=ir,s.CubismMotionEvent=er,s.CubismMotionPoint=si,s.CubismMotionSegment=Ks,s.CubismMotionSegmentType=J})(qi||(qi={}));const G="Meta",Qa="Duration",Ka="Loop",tn="AreBeziersRestricted",en="CurveCount",sn="Fps",rn="TotalSegmentCount",an="TotalPointCount",dt="Curves",nn="Target",on="Id",he="FadeInTime",ue="FadeOutTime",Zi="Segments",$i="UserData",ln="UserDataCount",hn="TotalUserDataSize",un="Time",gn="Value";class sr{constructor(t,e){n(this,"_json");this._json=N.create(t,e)}release(){N.delete(this._json)}getMotionDuration(){return this._json.getRoot().getValueByString(G).getValueByString(Qa).toFloat()}isMotionLoop(){return this._json.getRoot().getValueByString(G).getValueByString(Ka).toBoolean()}getEvaluationOptionFlag(t){return t==0?this._json.getRoot().getValueByString(G).getValueByString(tn).toBoolean():!1}getMotionCurveCount(){return this._json.getRoot().getValueByString(G).getValueByString(en).toInt()}getMotionFps(){return this._json.getRoot().getValueByString(G).getValueByString(sn).toFloat()}getMotionTotalSegmentCount(){return this._json.getRoot().getValueByString(G).getValueByString(rn).toInt()}getMotionTotalPointCount(){return this._json.getRoot().getValueByString(G).getValueByString(an).toInt()}isExistMotionFadeInTime(){return!this._json.getRoot().getValueByString(G).getValueByString(he).isNull()}isExistMotionFadeOutTime(){return!this._json.getRoot().getValueByString(G).getValueByString(ue).isNull()}getMotionFadeInTime(){return this._json.getRoot().getValueByString(G).getValueByString(he).toFloat()}getMotionFadeOutTime(){return this._json.getRoot().getValueByString(G).getValueByString(ue).toFloat()}getMotionCurveTarget(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(nn).getRawString()}getMotionCurveId(t){return R.getIdManager().getId(this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(on).getRawString())}isExistMotionCurveFadeInTime(t){return!this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(he).isNull()}isExistMotionCurveFadeOutTime(t){return!this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(ue).isNull()}getMotionCurveFadeInTime(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(he).toFloat()}getMotionCurveFadeOutTime(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(ue).toFloat()}getMotionCurveSegmentCount(t){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(Zi).getVector().getSize()}getMotionCurveSegment(t,e){return this._json.getRoot().getValueByString(dt).getValueByIndex(t).getValueByString(Zi).getValueByIndex(e).toFloat()}getEventCount(){return this._json.getRoot().getValueByString(G).getValueByString(ln).toInt()}getTotalEventValueSize(){return this._json.getRoot().getValueByString(G).getValueByString(hn).toInt()}getEventTime(t){return this._json.getRoot().getValueByString($i).getValueByIndex(t).getValueByString(un).toFloat()}getEventValue(t){return new Z(this._json.getRoot().getValueByString($i).getValueByIndex(t).getValueByString(gn).getRawString())}}var rr=(s=>(s[s.EvaluationOptionFlag_AreBeziersRistricted=0]="EvaluationOptionFlag_AreBeziersRistricted",s))(rr||{}),Ji;(s=>{s.CubismMotionJson=sr})(Ji||(Ji={}));const cn="EyeBlink",dn="LipSync",mn="Model",_n="Parameter",pn="PartOpacity",fn=!1;function q(s,t,e){const i=new si;return i.time=s.time+(t.time-s.time)*e,i.value=s.value+(t.value-s.value)*e,i}function yn(s,t){let e=(t-s[0].time)/(s[1].time-s[0].time);return e<0&&(e=0),s[0].value+(s[1].value-s[0].value)*e}function xn(s,t){let e=(t-s[0].time)/(s[3].time-s[0].time);e<0&&(e=0);const i=q(s[0],s[1],e),r=q(s[1],s[2],e),a=q(s[2],s[3],e),l=q(i,r,e),o=q(r,a,e);return q(l,o,e).value}function Sn(s,t){const e=t,i=s[0].time,r=s[3].time,a=s[1].time,l=s[2].time,o=r-3*l+3*a-i,h=3*l-6*a+3*i,u=3*a-3*i,g=i-e,m=P.cardanoAlgorithmForBezier(o,h,u,g),p=q(s[0],s[1],m),c=q(s[1],s[2],m),d=q(s[2],s[3],m),_=q(p,c,m),f=q(c,d,m);return q(_,f,m).value}function Cn(s,t){return s[0].value}function Mn(s,t){return s[1].value}function ke(s,t,e){const i=s.curves.at(t);let r=-1;const a=i.baseSegmentIndex+i.segmentCount;let l=0;for(let h=i.baseSegmentIndex;h<a;++h)if(l=s.segments.at(h).basePointIndex+(s.segments.at(h).segmentType==J.CubismMotionSegmentType_Bezier?3:1),s.points.at(l).time>e){r=h;break}if(r==-1)return s.points.at(l).value;const o=s.segments.at(r);return o.evaluate(s.points.get(o.basePointIndex),e)}class Ie extends Ut{constructor(){super();n(this,"_sourceFrameRate");n(this,"_loopDurationSeconds");n(this,"_isLoop");n(this,"_isLoopFadeIn");n(this,"_lastWeight");n(this,"_motionData");n(this,"_eyeBlinkParameterIds");n(this,"_lipSyncParameterIds");n(this,"_modelCurveIdEyeBlink");n(this,"_modelCurveIdLipSync");this._sourceFrameRate=30,this._loopDurationSeconds=-1,this._isLoop=!1,this._isLoopFadeIn=!0,this._lastWeight=0,this._motionData=null,this._modelCurveIdEyeBlink=null,this._modelCurveIdLipSync=null,this._eyeBlinkParameterIds=null,this._lipSyncParameterIds=null}static create(e,i,r){const a=new Ie;return a.parse(e,i),a._sourceFrameRate=a._motionData.fps,a._loopDurationSeconds=a._motionData.duration,a._onFinishedMotion=r,a}doUpdateParameters(e,i,r,a){this._modelCurveIdEyeBlink==null&&(this._modelCurveIdEyeBlink=R.getIdManager().getId(cn)),this._modelCurveIdLipSync==null&&(this._modelCurveIdLipSync=R.getIdManager().getId(dn));let l=i-a.getStartTime();l<0&&(l=0);let o=Number.MAX_VALUE,h=Number.MAX_VALUE;const u=64;let g=0,m=0;this._eyeBlinkParameterIds.getSize()>u&&Zt("too many eye blink targets : {0}",this._eyeBlinkParameterIds.getSize()),this._lipSyncParameterIds.getSize()>u&&Zt("too many lip sync targets : {0}",this._lipSyncParameterIds.getSize());const p=this._fadeInSeconds<=0?1:P.getEasingSine((i-a.getFadeInStartTime())/this._fadeInSeconds),c=this._fadeOutSeconds<=0||a.getEndTime()<0?1:P.getEasingSine((a.getEndTime()-i)/this._fadeOutSeconds);let d,_,f,b=l;if(this._isLoop)for(;b>this._motionData.duration;)b-=this._motionData.duration;const y=this._motionData.curves;for(_=0;_<this._motionData.curveCount&&y.at(_).type==mt.CubismMotionCurveTarget_Model;++_)d=ke(this._motionData,_,b),y.at(_).id==this._modelCurveIdEyeBlink?h=d:y.at(_).id==this._modelCurveIdLipSync&&(o=d);for(;_<this._motionData.curveCount&&y.at(_).type==mt.CubismMotionCurveTarget_Parameter;++_){if(f=e.getParameterIndex(y.at(_).id),f==-1)continue;const B=e.getParameterValueByIndex(f);if(d=ke(this._motionData,_,b),h!=Number.MAX_VALUE){for(let S=0;S<this._eyeBlinkParameterIds.getSize()&&S<u;++S)if(this._eyeBlinkParameterIds.at(S)==y.at(_).id){d*=h,m|=1<<S;break}}if(o!=Number.MAX_VALUE){for(let S=0;S<this._lipSyncParameterIds.getSize()&&S<u;++S)if(this._lipSyncParameterIds.at(S)==y.at(_).id){d+=o,g|=1<<S;break}}let I;if(y.at(_).fadeInTime<0&&y.at(_).fadeOutTime<0)I=B+(d-B)*r;else{let S,x;y.at(_).fadeInTime<0?S=p:S=y.at(_).fadeInTime==0?1:P.getEasingSine((i-a.getFadeInStartTime())/y.at(_).fadeInTime),y.at(_).fadeOutTime<0?x=c:x=y.at(_).fadeOutTime==0||a.getEndTime()<0?1:P.getEasingSine((a.getEndTime()-i)/y.at(_).fadeOutTime);const V=this._weight*S*x;I=B+(d-B)*V}e.setParameterValueByIndex(f,I,1)}{if(h!=Number.MAX_VALUE)for(let B=0;B<this._eyeBlinkParameterIds.getSize()&&B<u;++B){const I=e.getParameterValueById(this._eyeBlinkParameterIds.at(B));if(m>>B&1)continue;const S=I+(h-I)*r;e.setParameterValueById(this._eyeBlinkParameterIds.at(B),S)}if(o!=Number.MAX_VALUE)for(let B=0;B<this._lipSyncParameterIds.getSize()&&B<u;++B){const I=e.getParameterValueById(this._lipSyncParameterIds.at(B));if(g>>B&1)continue;const S=I+(o-I)*r;e.setParameterValueById(this._lipSyncParameterIds.at(B),S)}}for(;_<this._motionData.curveCount&&y.at(_).type==mt.CubismMotionCurveTarget_PartOpacity;++_)f=e.getParameterIndex(y.at(_).id),f!=-1&&(d=ke(this._motionData,_,b),e.setParameterValueByIndex(f,d));l>=this._motionData.duration&&(this._isLoop?(a.setStartTime(i),this._isLoopFadeIn&&a.setFadeInStartTime(i)):(this._onFinishedMotion&&this._onFinishedMotion(this),a.setIsFinished(!0))),this._lastWeight=r}setIsLoop(e){this._isLoop=e}isLoop(){return this._isLoop}setIsLoopFadeIn(e){this._isLoopFadeIn=e}isLoopFadeIn(){return this._isLoopFadeIn}getDuration(){return this._isLoop?-1:this._loopDurationSeconds}getLoopDuration(){return this._loopDurationSeconds}setParameterFadeInTime(e,i){const r=this._motionData.curves;for(let a=0;a<this._motionData.curveCount;++a)if(e==r.at(a).id){r.at(a).fadeInTime=i;return}}setParameterFadeOutTime(e,i){const r=this._motionData.curves;for(let a=0;a<this._motionData.curveCount;++a)if(e==r.at(a).id){r.at(a).fadeOutTime=i;return}}getParameterFadeInTime(e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(e==i.at(r).id)return i.at(r).fadeInTime;return-1}getParameterFadeOutTime(e){const i=this._motionData.curves;for(let r=0;r<this._motionData.curveCount;++r)if(e==i.at(r).id)return i.at(r).fadeOutTime;return-1}setEffectIds(e,i){this._eyeBlinkParameterIds=e,this._lipSyncParameterIds=i}release(){this._motionData=void 0,this._motionData=null}parse(e,i){this._motionData=new ir;let r=new sr(e,i);this._motionData.duration=r.getMotionDuration(),this._motionData.loop=r.isMotionLoop(),this._motionData.curveCount=r.getMotionCurveCount(),this._motionData.fps=r.getMotionFps(),this._motionData.eventCount=r.getEventCount();const a=r.getEvaluationOptionFlag(rr.EvaluationOptionFlag_AreBeziersRistricted);r.isExistMotionFadeInTime()?this._fadeInSeconds=r.getMotionFadeInTime()<0?1:r.getMotionFadeInTime():this._fadeInSeconds=1,r.isExistMotionFadeOutTime()?this._fadeOutSeconds=r.getMotionFadeOutTime()<0?1:r.getMotionFadeOutTime():this._fadeOutSeconds=1,this._motionData.curves.updateSize(this._motionData.curveCount,tr,!0),this._motionData.segments.updateSize(r.getMotionTotalSegmentCount(),Ks,!0),this._motionData.points.updateSize(r.getMotionTotalPointCount(),si,!0),this._motionData.events.updateSize(this._motionData.eventCount,er,!0);let l=0,o=0;for(let h=0;h<this._motionData.curveCount;++h){r.getMotionCurveTarget(h)==mn?this._motionData.curves.at(h).type=mt.CubismMotionCurveTarget_Model:r.getMotionCurveTarget(h)==_n?this._motionData.curves.at(h).type=mt.CubismMotionCurveTarget_Parameter:r.getMotionCurveTarget(h)==pn?this._motionData.curves.at(h).type=mt.CubismMotionCurveTarget_PartOpacity:yt('Warning : Unable to get segment type from Curve! The number of "CurveCount" may be incorrect!'),this._motionData.curves.at(h).id=r.getMotionCurveId(h),this._motionData.curves.at(h).baseSegmentIndex=o,this._motionData.curves.at(h).fadeInTime=r.isExistMotionCurveFadeInTime(h)?r.getMotionCurveFadeInTime(h):-1,this._motionData.curves.at(h).fadeOutTime=r.isExistMotionCurveFadeOutTime(h)?r.getMotionCurveFadeOutTime(h):-1;for(let u=0;u<r.getMotionCurveSegmentCount(h);){switch(u==0?(this._motionData.segments.at(o).basePointIndex=l,this._motionData.points.at(l).time=r.getMotionCurveSegment(h,u),this._motionData.points.at(l).value=r.getMotionCurveSegment(h,u+1),l+=1,u+=2):this._motionData.segments.at(o).basePointIndex=l-1,r.getMotionCurveSegment(h,u)){case J.CubismMotionSegmentType_Linear:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_Linear,this._motionData.segments.at(o).evaluate=yn,this._motionData.points.at(l).time=r.getMotionCurveSegment(h,u+1),this._motionData.points.at(l).value=r.getMotionCurveSegment(h,u+2),l+=1,u+=3;break}case J.CubismMotionSegmentType_Bezier:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_Bezier,a||fn?this._motionData.segments.at(o).evaluate=xn:this._motionData.segments.at(o).evaluate=Sn,this._motionData.points.at(l).time=r.getMotionCurveSegment(h,u+1),this._motionData.points.at(l).value=r.getMotionCurveSegment(h,u+2),this._motionData.points.at(l+1).time=r.getMotionCurveSegment(h,u+3),this._motionData.points.at(l+1).value=r.getMotionCurveSegment(h,u+4),this._motionData.points.at(l+2).time=r.getMotionCurveSegment(h,u+5),this._motionData.points.at(l+2).value=r.getMotionCurveSegment(h,u+6),l+=3,u+=7;break}case J.CubismMotionSegmentType_Stepped:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_Stepped,this._motionData.segments.at(o).evaluate=Cn,this._motionData.points.at(l).time=r.getMotionCurveSegment(h,u+1),this._motionData.points.at(l).value=r.getMotionCurveSegment(h,u+2),l+=1,u+=3;break}case J.CubismMotionSegmentType_InverseStepped:{this._motionData.segments.at(o).segmentType=J.CubismMotionSegmentType_InverseStepped,this._motionData.segments.at(o).evaluate=Mn,this._motionData.points.at(l).time=r.getMotionCurveSegment(h,u+1),this._motionData.points.at(l).value=r.getMotionCurveSegment(h,u+2),l+=1,u+=3;break}default:{et(0);break}}++this._motionData.curves.at(h).segmentCount,++o}}for(let h=0;h<r.getEventCount();++h)this._motionData.events.at(h).fireTime=r.getEventTime(h),this._motionData.events.at(h).value=r.getEventValue(h);r.release(),r=void 0,r=null}getFiredEvent(e,i){this._firedEventValues.updateSize(0);for(let r=0;r<this._motionData.eventCount;++r)this._motionData.events.at(r).fireTime>e&&this._motionData.events.at(r).fireTime<=i&&this._firedEventValues.pushBack(new Z(this._motionData.events.at(r).value.s));return this._firedEventValues}}var Qi;(s=>{s.CubismMotion=Ie})(Qi||(Qi={}));class ar{constructor(){n(this,"_autoDelete");n(this,"_motion");n(this,"_available");n(this,"_finished");n(this,"_started");n(this,"_startTimeSeconds");n(this,"_fadeInStartTimeSeconds");n(this,"_endTimeSeconds");n(this,"_stateTimeSeconds");n(this,"_stateWeight");n(this,"_lastEventCheckSeconds");n(this,"_fadeOutSeconds");n(this,"_isTriggeredFadeOut");n(this,"_motionQueueEntryHandle");this._autoDelete=!1,this._motion=null,this._available=!0,this._finished=!1,this._started=!1,this._startTimeSeconds=-1,this._fadeInStartTimeSeconds=0,this._endTimeSeconds=-1,this._stateTimeSeconds=0,this._stateWeight=0,this._lastEventCheckSeconds=0,this._motionQueueEntryHandle=this,this._fadeOutSeconds=0,this._isTriggeredFadeOut=!1}release(){this._autoDelete&&this._motion&&Ut.delete(this._motion)}setFadeOut(t){this._fadeOutSeconds=t,this._isTriggeredFadeOut=!0}startFadeOut(t,e){const i=e+t;this._isTriggeredFadeOut=!0,(this._endTimeSeconds<0||i<this._endTimeSeconds)&&(this._endTimeSeconds=i)}isFinished(){return this._finished}isStarted(){return this._started}getStartTime(){return this._startTimeSeconds}getFadeInStartTime(){return this._fadeInStartTimeSeconds}getEndTime(){return this._endTimeSeconds}setStartTime(t){this._startTimeSeconds=t}setFadeInStartTime(t){this._fadeInStartTimeSeconds=t}setEndTime(t){this._endTimeSeconds=t}setIsFinished(t){this._finished=t}setIsStarted(t){this._started=t}isAvailable(){return this._available}setIsAvailable(t){this._available=t}setState(t,e){this._stateTimeSeconds=t,this._stateWeight=e}getStateTime(){return this._stateTimeSeconds}getStateWeight(){return this._stateWeight}getLastCheckEventSeconds(){return this._lastEventCheckSeconds}setLastCheckEventSeconds(t){this._lastEventCheckSeconds=t}isTriggeredFadeOut(){return this._isTriggeredFadeOut}getFadeOutSeconds(){return this._fadeOutSeconds}}var Ki;(s=>{s.CubismMotionQueueEntry=ar})(Ki||(Ki={}));class nr{constructor(){n(this,"_userTimeSeconds");n(this,"_motions");n(this,"_eventCallBack");n(this,"_eventCustomData");this._userTimeSeconds=0,this._eventCallBack=null,this._eventCustomData=null,this._motions=new v}release(){for(let t=0;t<this._motions.getSize();++t)this._motions.at(t)&&(this._motions.at(t).release(),this._motions.set(t,null));this._motions=null}startMotion(t,e,i){if(t==null)return vt;let r=null;for(let a=0;a<this._motions.getSize();++a)r=this._motions.at(a),r==null||r.setFadeOut(r._motion.getFadeOutTime());return r=new ar,r._autoDelete=e,r._motion=t,this._motions.pushBack(r),r._motionQueueEntryHandle}isFinished(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}if(e._motion==null){e.release(),e=null,t=this._motions.erase(t);continue}if(e.isFinished())t.preIncrement();else return!1}return!0}isFinishedByHandle(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.increment()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t&&!i.isFinished())return!1}return!0}stopAllMotions(){for(let t=this._motions.begin();t.notEqual(this._motions.end());){let e=t.ptr();if(e==null){t=this._motions.erase(t);continue}e.release(),e=null,t=this._motions.erase(t)}}getCubismMotionQueueEntry(t){for(let e=this._motions.begin();e.notEqual(this._motions.end());e.preIncrement()){const i=e.ptr();if(i!=null&&i._motionQueueEntryHandle==t)return i}return null}setEventCallback(t,e=null){this._eventCallBack=t,this._eventCustomData=e}doUpdateMotion(t,e){let i=!1;for(let r=this._motions.begin();r.notEqual(this._motions.end());){let a=r.ptr();if(a==null){r=this._motions.erase(r);continue}const l=a._motion;if(l==null){a.release(),a=null,r=this._motions.erase(r);continue}l.updateParameters(t,a,e),i=!0;const o=l.getFiredEvent(a.getLastCheckEventSeconds()-a.getStartTime(),e-a.getStartTime());for(let h=0;h<o.getSize();++h)this._eventCallBack(this,o.at(h),this._eventCustomData);a.setLastCheckEventSeconds(e),a.isFinished()?(a.release(),a=null,r=this._motions.erase(r)):(a.isTriggeredFadeOut()&&a.startFadeOut(a.getFadeOutSeconds(),e),r.preIncrement())}return i}}const vt=-1;var ts;(s=>{s.CubismMotionQueueManager=nr,s.InvalidMotionQueueEntryHandleValue=vt})(ts||(ts={}));class Kt extends nr{constructor(){super();n(this,"_currentPriority");n(this,"_reservePriority");this._currentPriority=0,this._reservePriority=0}getCurrentPriority(){return this._currentPriority}getReservePriority(){return this._reservePriority}setReservePriority(e){this._reservePriority=e}startMotionPriority(e,i,r){return r==this._reservePriority&&(this._reservePriority=0),this._currentPriority=r,super.startMotion(e,i,this._userTimeSeconds)}updateMotion(e,i){this._userTimeSeconds+=i;const r=super.doUpdateMotion(e,this._userTimeSeconds);return this.isFinished()&&(this._currentPriority=0),r}reserveMotion(e){return e<=this._reservePriority||e<=this._currentPriority?!1:(this._reservePriority=e,!0)}}var es;(s=>{s.CubismMotionManager=Kt})(es||(es={}));var Se=(s=>(s[s.CubismPhysicsTargetType_Parameter=0]="CubismPhysicsTargetType_Parameter",s))(Se||{}),_t=(s=>(s[s.CubismPhysicsSource_X=0]="CubismPhysicsSource_X",s[s.CubismPhysicsSource_Y=1]="CubismPhysicsSource_Y",s[s.CubismPhysicsSource_Angle=2]="CubismPhysicsSource_Angle",s))(_t||{});class vn{constructor(){n(this,"gravity");n(this,"wind");this.gravity=new M(0,0),this.wind=new M(0,0)}}class ri{constructor(){n(this,"id");n(this,"targetType")}}class qe{constructor(){n(this,"minimum");n(this,"maximum");n(this,"defalut")}}class or{constructor(){n(this,"initialPosition");n(this,"mobility");n(this,"delay");n(this,"acceleration");n(this,"radius");n(this,"position");n(this,"lastPosition");n(this,"lastGravity");n(this,"force");n(this,"velocity");this.initialPosition=new M(0,0),this.position=new M(0,0),this.lastPosition=new M(0,0),this.lastGravity=new M(0,0),this.force=new M(0,0),this.velocity=new M(0,0)}}class lr{constructor(){n(this,"inputCount");n(this,"outputCount");n(this,"particleCount");n(this,"baseInputIndex");n(this,"baseOutputIndex");n(this,"baseParticleIndex");n(this,"normalizationPosition");n(this,"normalizationAngle");this.normalizationPosition=new qe,this.normalizationAngle=new qe}}class hr{constructor(){n(this,"source");n(this,"sourceParameterIndex");n(this,"weight");n(this,"type");n(this,"reflect");n(this,"getNormalizedParameterValue");this.source=new ri}}class ur{constructor(){n(this,"destination");n(this,"destinationParameterIndex");n(this,"vertexIndex");n(this,"translationScale");n(this,"angleScale");n(this,"weight");n(this,"type");n(this,"reflect");n(this,"valueBelowMinimum");n(this,"valueExceededMaximum");n(this,"getValue");n(this,"getScale");this.destination=new ri,this.translationScale=new M(0,0)}}class gr{constructor(){n(this,"subRigCount");n(this,"settings");n(this,"inputs");n(this,"outputs");n(this,"particles");n(this,"gravity");n(this,"wind");n(this,"fps");this.settings=new v,this.inputs=new v,this.outputs=new v,this.particles=new v,this.gravity=new M(0,0),this.wind=new M(0,0),this.fps=0}}var is;(s=>{s.CubismPhysicsInput=hr,s.CubismPhysicsNormalization=qe,s.CubismPhysicsOutput=ur,s.CubismPhysicsParameter=ri,s.CubismPhysicsParticle=or,s.CubismPhysicsRig=gr,s.CubismPhysicsSource=_t,s.CubismPhysicsSubRig=lr,s.CubismPhysicsTargetType=Se,s.PhysicsJsonEffectiveForces=vn})(is||(is={}));const Yt="Position",Ne="X",Oe="Y",ze="Angle",ss="Type",rs="Id",at="Meta",ge="EffectiveForces",Bn="TotalInputCount",bn="TotalOutputCount",Pn="PhysicsSettingCount",as="Gravity",ns="Wind",wn="VertexCount",In="Fps",L="PhysicsSettings",Tt="Normalization",os="Minimum",ls="Maximum",hs="Default",us="Reflect",gs="Weight",Xt="Input",Tn="Source",Ct="Output",Rn="Scale",Vn="VertexIndex",En="Destination",Mt="Vertices",Ln="Mobility",An="Delay",Dn="Radius",Fn="Acceleration";class cr{constructor(t,e){n(this,"_json");this._json=N.create(t,e)}release(){N.delete(this._json)}getGravity(){const t=new M(0,0);return t.x=this._json.getRoot().getValueByString(at).getValueByString(ge).getValueByString(as).getValueByString(Ne).toFloat(),t.y=this._json.getRoot().getValueByString(at).getValueByString(ge).getValueByString(as).getValueByString(Oe).toFloat(),t}getWind(){const t=new M(0,0);return t.x=this._json.getRoot().getValueByString(at).getValueByString(ge).getValueByString(ns).getValueByString(Ne).toFloat(),t.y=this._json.getRoot().getValueByString(at).getValueByString(ge).getValueByString(ns).getValueByString(Oe).toFloat(),t}getFps(){return this._json.getRoot().getValueByString(at).getValueByString(In).toFloat(0)}getSubRigCount(){return this._json.getRoot().getValueByString(at).getValueByString(Pn).toInt()}getTotalInputCount(){return this._json.getRoot().getValueByString(at).getValueByString(Bn).toInt()}getTotalOutputCount(){return this._json.getRoot().getValueByString(at).getValueByString(bn).toInt()}getVertexCount(){return this._json.getRoot().getValueByString(at).getValueByString(wn).toInt()}getNormalizationPositionMinimumValue(t){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Tt).getValueByString(Yt).getValueByString(os).toFloat()}getNormalizationPositionMaximumValue(t){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Tt).getValueByString(Yt).getValueByString(ls).toFloat()}getNormalizationPositionDefaultValue(t){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Tt).getValueByString(Yt).getValueByString(hs).toFloat()}getNormalizationAngleMinimumValue(t){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Tt).getValueByString(ze).getValueByString(os).toFloat()}getNormalizationAngleMaximumValue(t){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Tt).getValueByString(ze).getValueByString(ls).toFloat()}getNormalizationAngleDefaultValue(t){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Tt).getValueByString(ze).getValueByString(hs).toFloat()}getInputCount(t){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Xt).getVector().getSize()}getInputWeight(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Xt).getValueByIndex(e).getValueByString(gs).toFloat()}getInputReflect(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Xt).getValueByIndex(e).getValueByString(us).toBoolean()}getInputType(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Xt).getValueByIndex(e).getValueByString(ss).getRawString()}getInputSourceId(t,e){return R.getIdManager().getId(this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Xt).getValueByIndex(e).getValueByString(Tn).getValueByString(rs).getRawString())}getOutputCount(t){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Ct).getVector().getSize()}getOutputVertexIndex(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Ct).getValueByIndex(e).getValueByString(Vn).toInt()}getOutputAngleScale(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Ct).getValueByIndex(e).getValueByString(Rn).toFloat()}getOutputWeight(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Ct).getValueByIndex(e).getValueByString(gs).toFloat()}getOutputDestinationId(t,e){return R.getIdManager().getId(this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Ct).getValueByIndex(e).getValueByString(En).getValueByString(rs).getRawString())}getOutputType(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Ct).getValueByIndex(e).getValueByString(ss).getRawString()}getOutputReflect(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Ct).getValueByIndex(e).getValueByString(us).toBoolean()}getParticleCount(t){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Mt).getVector().getSize()}getParticleMobility(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Mt).getValueByIndex(e).getValueByString(Ln).toFloat()}getParticleDelay(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Mt).getValueByIndex(e).getValueByString(An).toFloat()}getParticleAcceleration(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Mt).getValueByIndex(e).getValueByString(Fn).toFloat()}getParticleRadius(t,e){return this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Mt).getValueByIndex(e).getValueByString(Dn).toFloat()}getParticlePosition(t,e){const i=new M(0,0);return i.x=this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Mt).getValueByIndex(e).getValueByString(Yt).getValueByString(Ne).toFloat(),i.y=this._json.getRoot().getValueByString(L).getValueByIndex(t).getValueByString(Mt).getValueByIndex(e).getValueByString(Yt).getValueByString(Oe).toFloat(),i}}var cs;(s=>{s.CubismPhysicsJson=cr})(cs||(cs={}));const ds="X",ms="Y",_s="Angle",kn=5,Ze=100,ps=.001,Nn=5;class te{constructor(){n(this,"_physicsRig");n(this,"_options");n(this,"_currentRigOutputs");n(this,"_previousRigOutputs");n(this,"_currentRemainTime");n(this,"_parameterCaches");n(this,"_parameterInputCaches");this._physicsRig=null,this._options=new dr,this._options.gravity.y=-1,this._options.gravity.x=0,this._options.wind.x=0,this._options.wind.y=0,this._currentRigOutputs=new v,this._previousRigOutputs=new v,this._currentRemainTime=0,this._parameterCaches=null,this._parameterInputCaches=null}static create(t,e){const i=new te;return i.parse(t,e),i._physicsRig.gravity.y=0,i}static delete(t){t!=null&&(t.release(),t=null)}parse(t,e){this._physicsRig=new gr;let i=new cr(t,e);this._physicsRig.gravity=i.getGravity(),this._physicsRig.wind=i.getWind(),this._physicsRig.subRigCount=i.getSubRigCount(),this._physicsRig.fps=i.getFps(),this._physicsRig.settings.updateSize(this._physicsRig.subRigCount,lr,!0),this._physicsRig.inputs.updateSize(i.getTotalInputCount(),hr,!0),this._physicsRig.outputs.updateSize(i.getTotalOutputCount(),ur,!0),this._physicsRig.particles.updateSize(i.getVertexCount(),or,!0),this._currentRigOutputs.clear(),this._previousRigOutputs.clear();let r=0,a=0,l=0;for(let o=0;o<this._physicsRig.settings.getSize();++o){this._physicsRig.settings.at(o).normalizationPosition.minimum=i.getNormalizationPositionMinimumValue(o),this._physicsRig.settings.at(o).normalizationPosition.maximum=i.getNormalizationPositionMaximumValue(o),this._physicsRig.settings.at(o).normalizationPosition.defalut=i.getNormalizationPositionDefaultValue(o),this._physicsRig.settings.at(o).normalizationAngle.minimum=i.getNormalizationAngleMinimumValue(o),this._physicsRig.settings.at(o).normalizationAngle.maximum=i.getNormalizationAngleMaximumValue(o),this._physicsRig.settings.at(o).normalizationAngle.defalut=i.getNormalizationAngleDefaultValue(o),this._physicsRig.settings.at(o).inputCount=i.getInputCount(o),this._physicsRig.settings.at(o).baseInputIndex=r;for(let g=0;g<this._physicsRig.settings.at(o).inputCount;++g)this._physicsRig.inputs.at(r+g).sourceParameterIndex=-1,this._physicsRig.inputs.at(r+g).weight=i.getInputWeight(o,g),this._physicsRig.inputs.at(r+g).reflect=i.getInputReflect(o,g),i.getInputType(o,g)==ds?(this._physicsRig.inputs.at(r+g).type=_t.CubismPhysicsSource_X,this._physicsRig.inputs.at(r+g).getNormalizedParameterValue=zn):i.getInputType(o,g)==ms?(this._physicsRig.inputs.at(r+g).type=_t.CubismPhysicsSource_Y,this._physicsRig.inputs.at(r+g).getNormalizedParameterValue=Un):i.getInputType(o,g)==_s&&(this._physicsRig.inputs.at(r+g).type=_t.CubismPhysicsSource_Angle,this._physicsRig.inputs.at(r+g).getNormalizedParameterValue=jn),this._physicsRig.inputs.at(r+g).source.targetType=Se.CubismPhysicsTargetType_Parameter,this._physicsRig.inputs.at(r+g).source.id=i.getInputSourceId(o,g);r+=this._physicsRig.settings.at(o).inputCount,this._physicsRig.settings.at(o).outputCount=i.getOutputCount(o),this._physicsRig.settings.at(o).baseOutputIndex=a;const h=new fs;h.outputs.resize(this._physicsRig.settings.at(o).outputCount);const u=new fs;u.outputs.resize(this._physicsRig.settings.at(o).outputCount);for(let g=0;g<this._physicsRig.settings.at(o).outputCount;++g)h.outputs[g]=0,u.outputs[g]=0,this._physicsRig.outputs.at(a+g).destinationParameterIndex=-1,this._physicsRig.outputs.at(a+g).vertexIndex=i.getOutputVertexIndex(o,g),this._physicsRig.outputs.at(a+g).angleScale=i.getOutputAngleScale(o,g),this._physicsRig.outputs.at(a+g).weight=i.getOutputWeight(o,g),this._physicsRig.outputs.at(a+g).destination.targetType=Se.CubismPhysicsTargetType_Parameter,this._physicsRig.outputs.at(a+g).destination.id=i.getOutputDestinationId(o,g),i.getOutputType(o,g)==ds?(this._physicsRig.outputs.at(a+g).type=_t.CubismPhysicsSource_X,this._physicsRig.outputs.at(a+g).getValue=Yn,this._physicsRig.outputs.at(a+g).getScale=qn):i.getOutputType(o,g)==ms?(this._physicsRig.outputs.at(a+g).type=_t.CubismPhysicsSource_Y,this._physicsRig.outputs.at(a+g).getValue=Xn,this._physicsRig.outputs.at(a+g).getScale=Zn):i.getOutputType(o,g)==_s&&(this._physicsRig.outputs.at(a+g).type=_t.CubismPhysicsSource_Angle,this._physicsRig.outputs.at(a+g).getValue=Hn,this._physicsRig.outputs.at(a+g).getScale=$n),this._physicsRig.outputs.at(a+g).reflect=i.getOutputReflect(o,g);this._currentRigOutputs.pushBack(h),this._previousRigOutputs.pushBack(u),a+=this._physicsRig.settings.at(o).outputCount,this._physicsRig.settings.at(o).particleCount=i.getParticleCount(o),this._physicsRig.settings.at(o).baseParticleIndex=l;for(let g=0;g<this._physicsRig.settings.at(o).particleCount;++g)this._physicsRig.particles.at(l+g).mobility=i.getParticleMobility(o,g),this._physicsRig.particles.at(l+g).delay=i.getParticleDelay(o,g),this._physicsRig.particles.at(l+g).acceleration=i.getParticleAcceleration(o,g),this._physicsRig.particles.at(l+g).radius=i.getParticleRadius(o,g),this._physicsRig.particles.at(l+g).position=i.getParticlePosition(o,g);l+=this._physicsRig.settings.at(o).particleCount}this.initialize(),i.release(),i=void 0,i=null}stabilization(t){var _,f;let e,i,r,a;const l=new M;let o,h,u,g,m,p,c,d;m=t.getModel().parameters.values,p=t.getModel().parameters.maximumValues,c=t.getModel().parameters.minimumValues,d=t.getModel().parameters.defaultValues,(((_=this._parameterCaches)==null?void 0:_.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((f=this._parameterInputCaches)==null?void 0:f.length)??0)<t.getParameterCount()&&(this._parameterInputCaches=new Float32Array(t.getParameterCount()));for(let b=0;b<t.getParameterCount();++b)this._parameterCaches[b]=m[b],this._parameterInputCaches[b]=m[b];for(let b=0;b<this._physicsRig.subRigCount;++b){e={angle:0},l.x=0,l.y=0,o=this._physicsRig.settings.at(b),h=this._physicsRig.inputs.get(o.baseInputIndex),u=this._physicsRig.outputs.get(o.baseOutputIndex),g=this._physicsRig.particles.get(o.baseParticleIndex);for(let y=0;y<o.inputCount;++y)i=h[y].weight/Ze,h[y].sourceParameterIndex==-1&&(h[y].sourceParameterIndex=t.getParameterIndex(h[y].source.id)),h[y].getNormalizedParameterValue(l,e,m[h[y].sourceParameterIndex],c[h[y].sourceParameterIndex],p[h[y].sourceParameterIndex],d[h[y].sourceParameterIndex],o.normalizationPosition,o.normalizationAngle,h[y].reflect,i),this._parameterCaches[h[y].sourceParameterIndex]=m[h[y].sourceParameterIndex];r=P.degreesToRadian(-e.angle),l.x=l.x*P.cos(r)-l.y*P.sin(r),l.y=l.x*P.sin(r)+l.y*P.cos(r),Qn(g,o.particleCount,l,e.angle,this._options.wind,ps*o.normalizationPosition.maximum);for(let y=0;y<o.outputCount;++y){const B=u[y].vertexIndex;if(u[y].destinationParameterIndex==-1&&(u[y].destinationParameterIndex=t.getParameterIndex(u[y].destination.id)),B<1||B>=o.particleCount)continue;let I=new M;I=g[B].position.substract(g[B-1].position),a=u[y].getValue(I,g,B,u[y].reflect,this._options.gravity),this._currentRigOutputs.at(b).outputs[y]=a,this._previousRigOutputs.at(b).outputs[y]=a;const S=u[y].destinationParameterIndex,x=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(m.subarray(S))):m.slice(S);Ue(x,c[S],p[S],a,u[y]);for(let V=S,Y=0;V<this._parameterCaches.length;V++,Y++)m[V]=this._parameterCaches[V]=x[Y]}}}evaluate(t,e){var y,B;let i,r,a,l;const o=new M;let h,u,g,m;if(0>=e)return;let p,c,d,_,f;if(this._currentRemainTime+=e,this._currentRemainTime>Nn&&(this._currentRemainTime=0),p=t.getModel().parameters.values,c=t.getModel().parameters.maximumValues,d=t.getModel().parameters.minimumValues,_=t.getModel().parameters.defaultValues,(((y=this._parameterCaches)==null?void 0:y.length)??0)<t.getParameterCount()&&(this._parameterCaches=new Float32Array(t.getParameterCount())),(((B=this._parameterInputCaches)==null?void 0:B.length)??0)<t.getParameterCount()){this._parameterInputCaches=new Float32Array(t.getParameterCount());for(let I=0;I<t.getParameterCount();++I)this._parameterInputCaches[I]=p[I]}for(this._physicsRig.fps>0?f=1/this._physicsRig.fps:f=e;this._currentRemainTime>=f;){for(let S=0;S<this._physicsRig.subRigCount;++S){h=this._physicsRig.settings.at(S),g=this._physicsRig.outputs.get(h.baseOutputIndex);for(let x=0;x<h.outputCount;++x)this._previousRigOutputs.at(S).outputs[x]=this._currentRigOutputs.at(S).outputs[x]}const I=f/this._currentRemainTime;for(let S=0;S<t.getParameterCount();++S)this._parameterCaches[S]=this._parameterInputCaches[S]*(1-I)+p[S]*I,this._parameterInputCaches[S]=this._parameterCaches[S];for(let S=0;S<this._physicsRig.subRigCount;++S){i={angle:0},o.x=0,o.y=0,h=this._physicsRig.settings.at(S),u=this._physicsRig.inputs.get(h.baseInputIndex),g=this._physicsRig.outputs.get(h.baseOutputIndex),m=this._physicsRig.particles.get(h.baseParticleIndex);for(let x=0;x<h.inputCount;++x)r=u[x].weight/Ze,u[x].sourceParameterIndex==-1&&(u[x].sourceParameterIndex=t.getParameterIndex(u[x].source.id)),u[x].getNormalizedParameterValue(o,i,this._parameterCaches[u[x].sourceParameterIndex],d[u[x].sourceParameterIndex],c[u[x].sourceParameterIndex],_[u[x].sourceParameterIndex],h.normalizationPosition,h.normalizationAngle,u[x].reflect,r);a=P.degreesToRadian(-i.angle),o.x=o.x*P.cos(a)-o.y*P.sin(a),o.y=o.x*P.sin(a)+o.y*P.cos(a),Jn(m,h.particleCount,o,i.angle,this._options.wind,ps*h.normalizationPosition.maximum,f,kn);for(let x=0;x<h.outputCount;++x){const V=g[x].vertexIndex;if(g[x].destinationParameterIndex==-1&&(g[x].destinationParameterIndex=t.getParameterIndex(g[x].destination.id)),V<1||V>=h.particleCount)continue;const Y=new M;Y.x=m[V].position.x-m[V-1].position.x,Y.y=m[V].position.y-m[V-1].position.y,l=g[x].getValue(Y,m,V,g[x].reflect,this._options.gravity),this._currentRigOutputs.at(S).outputs[x]=l;const E=g[x].destinationParameterIndex,ut=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(this._parameterCaches.subarray(E))):this._parameterCaches.slice(E);Ue(ut,d[E],c[E],l,g[x]);for(let st=E,St=0;st<this._parameterCaches.length;st++,St++)this._parameterCaches[st]=ut[St]}}this._currentRemainTime-=f}const b=this._currentRemainTime/f;this.interpolate(t,b)}interpolate(t,e){let i,r,a,l,o;a=t.getModel().parameters.values,l=t.getModel().parameters.maximumValues,o=t.getModel().parameters.minimumValues;for(let h=0;h<this._physicsRig.subRigCount;++h){r=this._physicsRig.settings.at(h),i=this._physicsRig.outputs.get(r.baseOutputIndex);for(let u=0;u<r.outputCount;++u){if(i[u].destinationParameterIndex==-1)continue;const g=i[u].destinationParameterIndex,m=!Float32Array.prototype.slice&&"subarray"in Float32Array.prototype?JSON.parse(JSON.stringify(a.subarray(g))):a.slice(g);Ue(m,o[g],l[g],this._previousRigOutputs.at(h).outputs[u]*(1-e)+this._currentRigOutputs.at(h).outputs[u]*e,i[u]);for(let p=g,c=0;p<a.length;p++,c++)a[p]=m[c]}}}setOptions(t){this._options=t}getOption(){return this._options}release(){this._physicsRig=void 0,this._physicsRig=null}initialize(){let t,e,i;for(let r=0;r<this._physicsRig.subRigCount;++r){e=this._physicsRig.settings.at(r),t=this._physicsRig.particles.get(e.baseParticleIndex),t[0].initialPosition=new M(0,0),t[0].lastPosition=new M(t[0].initialPosition.x,t[0].initialPosition.y),t[0].lastGravity=new M(0,-1),t[0].lastGravity.y*=-1,t[0].velocity=new M(0,0),t[0].force=new M(0,0);for(let a=1;a<e.particleCount;++a)i=new M(0,0),i.y=t[a].radius,t[a].initialPosition=new M(t[a-1].initialPosition.x+i.x,t[a-1].initialPosition.y+i.y),t[a].position=new M(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastPosition=new M(t[a].initialPosition.x,t[a].initialPosition.y),t[a].lastGravity=new M(0,-1),t[a].lastGravity.y*=-1,t[a].velocity=new M(0,0),t[a].force=new M(0,0)}}}class dr{constructor(){n(this,"gravity");n(this,"wind");this.gravity=new M(0,0),this.wind=new M(0,0)}}class fs{constructor(){n(this,"outputs");this.outputs=new v(0)}}function On(s){let t=0;return s>0?t=1:s<0&&(t=-1),t}function zn(s,t,e,i,r,a,l,o,h,u){s.x+=ai(e,i,r,a,l.minimum,l.maximum,l.defalut,h)*u}function Un(s,t,e,i,r,a,l,o,h,u){s.y+=ai(e,i,r,a,l.minimum,l.maximum,l.defalut,h)*u}function jn(s,t,e,i,r,a,l,o,h,u){t.angle+=ai(e,i,r,a,o.minimum,o.maximum,o.defalut,h)*u}function Yn(s,t,e,i,r){let a=s.x;return i&&(a*=-1),a}function Xn(s,t,e,i,r){let a=s.y;return i&&(a*=-1),a}function Hn(s,t,e,i,r){let a;return e>=2?r=t[e-1].position.substract(t[e-2].position):r=r.multiplyByScaler(-1),a=P.directionToRadian(r,s),i&&(a*=-1),a}function Gn(s,t){const e=P.max(s,t),i=P.min(s,t);return P.abs(e-i)}function Wn(s,t){return P.min(s,t)+Gn(s,t)/2}function qn(s,t){return JSON.parse(JSON.stringify(s.x))}function Zn(s,t){return JSON.parse(JSON.stringify(s.y))}function $n(s,t){return JSON.parse(JSON.stringify(t))}function Jn(s,t,e,i,r,a,l,o){let h,u,g,m,p=new M(0,0),c=new M(0,0),d=new M(0,0),_=new M(0,0);s[0].position=new M(e.x,e.y),h=P.degreesToRadian(i),m=P.radianToDirection(h),m.normalize();for(let f=1;f<t;++f)s[f].force=m.multiplyByScaler(s[f].acceleration).add(r),s[f].lastPosition=new M(s[f].position.x,s[f].position.y),u=s[f].delay*l*30,p=s[f].position.substract(s[f-1].position),g=P.directionToRadian(s[f].lastGravity,m)/o,p.x=P.cos(g)*p.x-p.y*P.sin(g),p.y=P.sin(g)*p.x+p.y*P.cos(g),s[f].position=s[f-1].position.add(p),c=s[f].velocity.multiplyByScaler(u),d=s[f].force.multiplyByScaler(u).multiplyByScaler(u),s[f].position=s[f].position.add(c).add(d),_=s[f].position.substract(s[f-1].position),_.normalize(),s[f].position=s[f-1].position.add(_.multiplyByScaler(s[f].radius)),P.abs(s[f].position.x)<a&&(s[f].position.x=0),u!=0&&(s[f].velocity=s[f].position.substract(s[f].lastPosition),s[f].velocity=s[f].velocity.divisionByScalar(u),s[f].velocity=s[f].velocity.multiplyByScaler(s[f].mobility)),s[f].force=new M(0,0),s[f].lastGravity=new M(m.x,m.y)}function Qn(s,t,e,i,r,a){let l,o,h=new M(0,0);s[0].position=new M(e.x,e.y),l=P.degreesToRadian(i),o=P.radianToDirection(l),o.normalize();for(let u=1;u<t;++u)s[u].force=o.multiplyByScaler(s[u].acceleration).add(r),s[u].lastPosition=new M(s[u].position.x,s[u].position.y),s[u].velocity=new M(0,0),h=s[u].force,h.normalize(),h=h.multiplyByScaler(s[u].radius),s[u].position=s[u-1].position.add(h),P.abs(s[u].position.x)<a&&(s[u].position.x=0),s[u].force=new M(0,0),s[u].lastGravity=new M(o.x,o.y)}function Ue(s,t,e,i,r){let a,l,o;a=r.getScale(r.translationScale,r.angleScale),l=i*a,l<t?(l<r.valueBelowMinimum&&(r.valueBelowMinimum=l),l=t):l>e&&(l>r.valueExceededMaximum&&(r.valueExceededMaximum=l),l=e),o=r.weight/Ze,o>=1||(l=s[0]*(1-o)+l*o),s[0]=l}function ai(s,t,e,i,r,a,l,o){let h=0;const u=P.max(e,t);u<s&&(s=u);const g=P.min(e,t);g>s&&(s=g);const m=P.min(r,a),p=P.max(r,a),c=l,d=Wn(g,u),_=s-d;switch(On(_)){case 1:{const f=p-c,b=u-d;b!=0&&(h=_*(f/b),h+=c);break}case-1:{const f=m-c,b=g-d;b!=0&&(h=_*(f/b),h+=c);break}case 0:{h=c;break}}return o?h:h*-1}var ys;(s=>{s.CubismPhysics=te,s.Options=dr})(ys||(ys={}));class Ce{constructor(t,e,i,r){n(this,"x");n(this,"y");n(this,"width");n(this,"height");this.x=t,this.y=e,this.width=i,this.height=r}getCenterX(){return this.x+.5*this.width}getCenterY(){return this.y+.5*this.height}getRight(){return this.x+this.width}getBottom(){return this.y+this.height}setRect(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}expand(t,e){this.x-=t,this.y-=e,this.width+=t*2,this.height+=e*2}}var xs;(s=>{s.csmRect=Ce})(xs||(xs={}));const ce=4,Kn=36,to=32,eo=10;let Rt,ot,Me;class $e{constructor(){n(this,"_currentMaskRenderTexture");n(this,"_maskRenderTextures");n(this,"_maskColorBuffers");n(this,"_currentFrameNo");n(this,"_channelColors");n(this,"_maskTexture");n(this,"_clippingContextListForMask");n(this,"_clippingContextListForDraw");n(this,"_clippingMaskBufferSize");n(this,"_renderTextureCount");n(this,"_tmpMatrix");n(this,"_tmpMatrixForMask");n(this,"_tmpMatrixForDraw");n(this,"_tmpBoundsOnModel");n(this,"_clearedFrameBufferflags");n(this,"gl");this._currentMaskRenderTexture=null,this._maskColorBuffers=null,this._currentFrameNo=0,this._renderTextureCount=0,this._clippingMaskBufferSize=256,this._clippingContextListForMask=new v,this._clippingContextListForDraw=new v,this._channelColors=new v,this._tmpBoundsOnModel=new Ce,this._tmpMatrix=new k,this._tmpMatrixForMask=new k,this._tmpMatrixForDraw=new k,this._maskTexture=null;let t=new ht;t.R=1,t.G=0,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new ht,t.R=0,t.G=1,t.B=0,t.A=0,this._channelColors.pushBack(t),t=new ht,t.R=0,t.G=0,t.B=1,t.A=0,this._channelColors.pushBack(t),t=new ht,t.R=0,t.G=0,t.B=0,t.A=1,this._channelColors.pushBack(t)}getChannelFlagAsColor(t){return this._channelColors.at(t)}getMaskRenderTexture(){if(this._maskTexture&&this._maskTexture.textures!=null)this._maskTexture.frameNo=this._currentFrameNo;else{this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=new v,this._maskColorBuffers!=null&&this._maskColorBuffers.clear(),this._maskColorBuffers=new v;const t=this._clippingMaskBufferSize;for(let e=0;e<this._renderTextureCount;e++)this._maskColorBuffers.pushBack(this.gl.createTexture()),this.gl.bindTexture(this.gl.TEXTURE_2D,this._maskColorBuffers.at(e)),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,t,t,0,this.gl.RGBA,this.gl.UNSIGNED_BYTE,null),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR),this.gl.bindTexture(this.gl.TEXTURE_2D,null),this._maskRenderTextures.pushBack(this.gl.createFramebuffer()),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._maskRenderTextures.at(e)),this.gl.framebufferTexture2D(this.gl.FRAMEBUFFER,this.gl.COLOR_ATTACHMENT0,this.gl.TEXTURE_2D,this._maskColorBuffers.at(e),0);this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Me),this._maskTexture=new mr(this._currentFrameNo,this._maskRenderTextures)}return this._maskTexture.textures}setGL(t){this.gl=t}calcClippedDrawTotalBounds(t,e){let i=Number.MAX_VALUE,r=Number.MAX_VALUE,a=Number.MIN_VALUE,l=Number.MIN_VALUE;const o=e._clippedDrawableIndexList.length;for(let h=0;h<o;h++){const u=e._clippedDrawableIndexList[h],g=t.getDrawableVertexCount(u),m=t.getDrawableVertices(u);let p=Number.MAX_VALUE,c=Number.MAX_VALUE,d=-Number.MAX_VALUE,_=-Number.MAX_VALUE;const f=g*xt.vertexStep;for(let b=xt.vertexOffset;b<f;b+=xt.vertexStep){const y=m[b],B=m[b+1];y<p&&(p=y),y>d&&(d=y),B<c&&(c=B),B>_&&(_=B)}if(p!=Number.MAX_VALUE)if(p<i&&(i=p),c<r&&(r=c),d>a&&(a=d),_>l&&(l=_),i==Number.MAX_VALUE)e._allClippedDrawRect.x=0,e._allClippedDrawRect.y=0,e._allClippedDrawRect.width=0,e._allClippedDrawRect.height=0,e._isUsing=!1;else{e._isUsing=!0;const b=a-i,y=l-r;e._allClippedDrawRect.x=i,e._allClippedDrawRect.y=r,e._allClippedDrawRect.width=b,e._allClippedDrawRect.height=y}}}release(){for(let t=0;t<this._clippingContextListForMask.getSize();t++)this._clippingContextListForMask.at(t)&&(this._clippingContextListForMask.at(t).release(),this._clippingContextListForMask.set(t,void 0)),this._clippingContextListForMask.set(t,null);this._clippingContextListForMask=null;for(let t=0;t<this._clippingContextListForDraw.getSize();t++)this._clippingContextListForDraw.set(t,null);if(this._clippingContextListForDraw=null,this._maskTexture){for(let t=0;t<this._maskTexture.textures.getSize();t++)this.gl.deleteFramebuffer(this._maskTexture.textures.at(t));this._maskTexture.textures.clear(),this._maskTexture.textures=null,this._maskTexture=null}for(let t=0;t<this._channelColors.getSize();t++)this._channelColors.set(t,null);if(this._channelColors=null,this._maskColorBuffers!=null){for(let t=0;t<this._maskColorBuffers.getSize();t++)this.gl.deleteTexture(this._maskColorBuffers.at(t));this._maskColorBuffers.clear()}this._maskColorBuffers=null,this._maskRenderTextures!=null&&this._maskRenderTextures.clear(),this._maskRenderTextures=null,this._clearedFrameBufferflags!=null&&this._clearedFrameBufferflags.clear(),this._clearedFrameBufferflags=null}initialize(t,e,i,r,a){a%1!=0&&(yt("The number of render textures must be specified as an integer. The decimal point is rounded down and corrected to an integer."),a=~~a),a<1&&yt("The number of render textures must be an integer greater than or equal to 1. Set the number of render textures to 1."),this._renderTextureCount=a<1?1:a,this._clearedFrameBufferflags=new v(this._renderTextureCount);for(let l=0;l<e;l++){if(r[l]<=0){this._clippingContextListForDraw.pushBack(null);continue}let o=this.findSameClip(i[l],r[l]);o==null&&(o=new _r(this,i[l],r[l]),this._clippingContextListForMask.pushBack(o)),o.addClippedDrawable(l),this._clippingContextListForDraw.pushBack(o)}}setupClippingContext(t,e){this._currentFrameNo++;let i=0;for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r);this.calcClippedDrawTotalBounds(t,a),a._isUsing&&i++}if(i>0){this.setupLayoutBounds(e.isUsingHighPrecisionMask()?0:i),e.isUsingHighPrecisionMask()||(this.gl.viewport(0,0,this._clippingMaskBufferSize,this._clippingMaskBufferSize),this._currentMaskRenderTexture=this.getMaskRenderTexture().at(0),e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),this._clearedFrameBufferflags.getSize()!=this._renderTextureCount&&(this._clearedFrameBufferflags.clear(),this._clearedFrameBufferflags=new v(this._renderTextureCount));for(let r=0;r<this._clearedFrameBufferflags.getSize();r++)this._clearedFrameBufferflags[r]=!1;for(let r=0;r<this._clippingContextListForMask.getSize();r++){const a=this._clippingContextListForMask.at(r),l=a._allClippedDrawRect,o=a._layoutBounds,h=.05;let u=0,g=0;const m=this.getMaskRenderTexture().at(a._bufferIndex);if(this._currentMaskRenderTexture!=m&&!e.isUsingHighPrecisionMask()&&(this._currentMaskRenderTexture=m,e.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this._currentMaskRenderTexture)),e.isUsingHighPrecisionMask()){const p=t.getPixelsPerUnit(),c=a.getClippingManager()._clippingMaskBufferSize,d=o.width*c,_=o.height*c;this._tmpBoundsOnModel.setRect(l),this._tmpBoundsOnModel.width*p>d?(this._tmpBoundsOnModel.expand(l.width*h,0),u=o.width/this._tmpBoundsOnModel.width):u=p/d,this._tmpBoundsOnModel.height*p>_?(this._tmpBoundsOnModel.expand(0,l.height*h),g=o.height/this._tmpBoundsOnModel.height):g=p/_}else this._tmpBoundsOnModel.setRect(l),this._tmpBoundsOnModel.expand(l.width*h,l.height*h),u=o.width/this._tmpBoundsOnModel.width,g=o.height/this._tmpBoundsOnModel.height;if(this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(-1,-1),this._tmpMatrix.scaleRelative(2,2),this._tmpMatrix.translateRelative(o.x,o.y),this._tmpMatrix.scaleRelative(u,g),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForMask.setMatrix(this._tmpMatrix.getArray()),this._tmpMatrix.loadIdentity(),this._tmpMatrix.translateRelative(o.x,o.y),this._tmpMatrix.scaleRelative(u,g),this._tmpMatrix.translateRelative(-this._tmpBoundsOnModel.x,-this._tmpBoundsOnModel.y),this._tmpMatrixForDraw.setMatrix(this._tmpMatrix.getArray()),a._matrixForMask.setMatrix(this._tmpMatrixForMask.getArray()),a._matrixForDraw.setMatrix(this._tmpMatrixForDraw.getArray()),!e.isUsingHighPrecisionMask()){const p=a._clippingIdCount;for(let c=0;c<p;c++){const d=a._clippingIdList[c];t.getDrawableDynamicFlagVertexPositionsDidChange(d)&&(e.setIsCulling(t.getDrawableCulling(d)!=!1),this._clearedFrameBufferflags[a._bufferIndex]||(this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this._clearedFrameBufferflags[a._bufferIndex]=!0),e.setClippingContextBufferForMask(a),e.drawMesh(t.getDrawableTextureIndex(d),t.getDrawableVertexIndexCount(d),t.getDrawableVertexCount(d),t.getDrawableVertexIndices(d),t.getDrawableVertices(d),t.getDrawableVertexUvs(d),t.getMultiplyColor(d),t.getScreenColor(d),t.getDrawableOpacity(d),it.CubismBlendMode_Normal,!1))}}}e.isUsingHighPrecisionMask()||(this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Me),e.setClippingContextBufferForMask(null),this.gl.viewport(ot[0],ot[1],ot[2],ot[3]))}}findSameClip(t,e){for(let i=0;i<this._clippingContextListForMask.getSize();i++){const r=this._clippingContextListForMask.at(i),a=r._clippingIdCount;if(a!=e)continue;let l=0;for(let o=0;o<a;o++){const h=r._clippingIdList[o];for(let u=0;u<a;u++)if(t[u]==h){l++;break}}if(l==a)return r}return null}setupLayoutBounds(t){const e=this._renderTextureCount<=1?Kn:to*this._renderTextureCount;if(t<=0||t>e){t>e&&X(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let u=0;u<this._clippingContextListForMask.getSize();u++){const g=this._clippingContextListForMask.at(u);g._layoutChannelNo=0,g._layoutBounds.x=0,g._layoutBounds.y=0,g._layoutBounds.width=1,g._layoutBounds.height=1,g._bufferIndex=0}return}const i=this._renderTextureCount<=1?9:8;let r=t/this._renderTextureCount,a=t%this._renderTextureCount;r=~~r,a=~~a;let l=r/ce,o=r%ce;l=~~l,o=~~o;let h=0;for(let u=0;u<this._renderTextureCount;u++)for(let g=0;g<ce;g++){let m=l+(g<o?1:0);const p=o+1>=ce?0:o+1;if(m<i&&g==p&&(m+=u<a?1:0),m!=0)if(m==1){const c=this._clippingContextListForMask.at(h++);c._layoutChannelNo=g,c._layoutBounds.x=0,c._layoutBounds.y=0,c._layoutBounds.width=1,c._layoutBounds.height=1,c._bufferIndex=u}else if(m==2)for(let c=0;c<m;c++){let d=c%2;d=~~d;const _=this._clippingContextListForMask.at(h++);_._layoutChannelNo=g,_._layoutBounds.x=d*.5,_._layoutBounds.y=0,_._layoutBounds.width=.5,_._layoutBounds.height=1,_._bufferIndex=u}else if(m<=4)for(let c=0;c<m;c++){let d=c%2,_=c/2;d=~~d,_=~~_;const f=this._clippingContextListForMask.at(h++);f._layoutChannelNo=g,f._layoutBounds.x=d*.5,f._layoutBounds.y=_*.5,f._layoutBounds.width=.5,f._layoutBounds.height=.5,f._bufferIndex=u}else if(m<=i)for(let c=0;c<m;c++){let d=c%3,_=c/3;d=~~d,_=~~_;const f=this._clippingContextListForMask.at(h++);f._layoutChannelNo=g,f._layoutBounds.x=d/3,f._layoutBounds.y=_/3,f._layoutBounds.width=1/3,f._layoutBounds.height=1/3,f._bufferIndex=u}else{X(`not supported mask count : {0}
[Details] render texture count : {1}, mask count : {2}`,t-e,this._renderTextureCount,t);for(let c=0;c<m;c++){const d=this._clippingContextListForMask.at(h++);d._layoutChannelNo=0,d._layoutBounds.x=0,d._layoutBounds.y=0,d._layoutBounds.width=1,d._layoutBounds.height=1,d._bufferIndex=0}}}}getColorBuffer(){return this._maskColorBuffers}getClippingContextListForDraw(){return this._clippingContextListForDraw}getClippingMaskCount(){return this._clippingContextListForMask.getSize()}setClippingMaskBufferSize(t){this._clippingMaskBufferSize=t}getClippingMaskBufferSize(){return this._clippingMaskBufferSize}getRenderTextureCount(){return this._renderTextureCount}}class mr{constructor(t,e){n(this,"frameNo");n(this,"textures");this.frameNo=t,this.textures=e}}class _r{constructor(t,e,i){n(this,"_isUsing");n(this,"_clippingIdList");n(this,"_clippingIdCount");n(this,"_layoutChannelNo");n(this,"_layoutBounds");n(this,"_allClippedDrawRect");n(this,"_matrixForMask");n(this,"_matrixForDraw");n(this,"_clippedDrawableIndexList");n(this,"_bufferIndex");n(this,"_owner");this._owner=t,this._clippingIdList=e,this._clippingIdCount=i,this._allClippedDrawRect=new Ce,this._layoutBounds=new Ce,this._clippedDrawableIndexList=[],this._matrixForMask=new k,this._matrixForDraw=new k,this._bufferIndex=0}release(){this._layoutBounds!=null&&(this._layoutBounds=null),this._allClippedDrawRect!=null&&(this._allClippedDrawRect=null),this._clippedDrawableIndexList!=null&&(this._clippedDrawableIndexList=null)}addClippedDrawable(t){this._clippedDrawableIndexList.push(t)}getClippingManager(){return this._owner}setGl(t){this._owner.setGL(t)}}class io{constructor(){n(this,"_lastArrayBufferBinding");n(this,"_lastElementArrayBufferBinding");n(this,"_lastProgram");n(this,"_lastActiveTexture");n(this,"_lastTexture0Binding2D");n(this,"_lastTexture1Binding2D");n(this,"_lastVertexAttribArrayEnabled");n(this,"_lastScissorTest");n(this,"_lastBlend");n(this,"_lastStencilTest");n(this,"_lastDepthTest");n(this,"_lastCullFace");n(this,"_lastFrontFace");n(this,"_lastColorMask");n(this,"_lastBlending");n(this,"_lastFBO");n(this,"_lastViewport");n(this,"gl");this._lastVertexAttribArrayEnabled=new Array(4),this._lastColorMask=new Array(4),this._lastBlending=new Array(4),this._lastViewport=new Array(4)}setGlEnable(t,e){e?this.gl.enable(t):this.gl.disable(t)}setGlEnableVertexAttribArray(t,e){e?this.gl.enableVertexAttribArray(t):this.gl.disableVertexAttribArray(t)}save(){if(this.gl==null){X(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._lastArrayBufferBinding=this.gl.getParameter(this.gl.ARRAY_BUFFER_BINDING),this._lastElementArrayBufferBinding=this.gl.getParameter(this.gl.ELEMENT_ARRAY_BUFFER_BINDING),this._lastProgram=this.gl.getParameter(this.gl.CURRENT_PROGRAM),this._lastActiveTexture=this.gl.getParameter(this.gl.ACTIVE_TEXTURE),this.gl.activeTexture(this.gl.TEXTURE1),this._lastTexture1Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this.gl.activeTexture(this.gl.TEXTURE0),this._lastTexture0Binding2D=this.gl.getParameter(this.gl.TEXTURE_BINDING_2D),this._lastVertexAttribArrayEnabled[0]=this.gl.getVertexAttrib(0,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[1]=this.gl.getVertexAttrib(1,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[2]=this.gl.getVertexAttrib(2,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastVertexAttribArrayEnabled[3]=this.gl.getVertexAttrib(3,this.gl.VERTEX_ATTRIB_ARRAY_ENABLED),this._lastScissorTest=this.gl.isEnabled(this.gl.SCISSOR_TEST),this._lastStencilTest=this.gl.isEnabled(this.gl.STENCIL_TEST),this._lastDepthTest=this.gl.isEnabled(this.gl.DEPTH_TEST),this._lastCullFace=this.gl.isEnabled(this.gl.CULL_FACE),this._lastBlend=this.gl.isEnabled(this.gl.BLEND),this._lastFrontFace=this.gl.getParameter(this.gl.FRONT_FACE),this._lastColorMask=this.gl.getParameter(this.gl.COLOR_WRITEMASK),this._lastBlending[0]=this.gl.getParameter(this.gl.BLEND_SRC_RGB),this._lastBlending[1]=this.gl.getParameter(this.gl.BLEND_DST_RGB),this._lastBlending[2]=this.gl.getParameter(this.gl.BLEND_SRC_ALPHA),this._lastBlending[3]=this.gl.getParameter(this.gl.BLEND_DST_ALPHA),this._lastFBO=this.gl.getParameter(this.gl.FRAMEBUFFER_BINDING),this._lastViewport=this.gl.getParameter(this.gl.VIEWPORT)}restore(){if(this.gl==null){X(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this.gl.useProgram(this._lastProgram),this.setGlEnableVertexAttribArray(0,this._lastVertexAttribArrayEnabled[0]),this.setGlEnableVertexAttribArray(1,this._lastVertexAttribArrayEnabled[1]),this.setGlEnableVertexAttribArray(2,this._lastVertexAttribArrayEnabled[2]),this.setGlEnableVertexAttribArray(3,this._lastVertexAttribArrayEnabled[3]),this.setGlEnable(this.gl.SCISSOR_TEST,this._lastScissorTest),this.setGlEnable(this.gl.STENCIL_TEST,this._lastStencilTest),this.setGlEnable(this.gl.DEPTH_TEST,this._lastDepthTest),this.setGlEnable(this.gl.CULL_FACE,this._lastCullFace),this.setGlEnable(this.gl.BLEND,this._lastBlend),this.gl.frontFace(this._lastFrontFace),this.gl.colorMask(this._lastColorMask[0],this._lastColorMask[1],this._lastColorMask[2],this._lastColorMask[3]),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this._lastArrayBufferBinding),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,this._lastElementArrayBufferBinding),this.gl.activeTexture(this.gl.TEXTURE1),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture1Binding2D),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,this._lastTexture0Binding2D),this.gl.activeTexture(this._lastActiveTexture),this.gl.blendFuncSeparate(this._lastBlending[0],this._lastBlending[1],this._lastBlending[2],this._lastBlending[3])}setGl(t){this.gl=t}}class Nt{constructor(){n(this,"_shaderSets");n(this,"gl");this._shaderSets=new v}static getInstance(){return Rt==null&&(Rt=new Nt),Rt}static deleteInstance(){Rt&&(Rt.release(),Rt=null)}release(){this.releaseShaderProgram()}setupShaderProgram(t,e,i,r,a,l,o,h,u,g,m,p,c,d,_){c||X("NoPremultipliedAlpha is not allowed"),this._shaderSets.getSize()==0&&this.generateShaders();let f,b,y,B;if(t.getClippingContextBufferForMask()!=null){const I=this._shaderSets.at(0);this.gl.useProgram(I.shaderProgram),this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(I.samplerTexture0Location,0),o.vertex==null&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(I.attributePositionLocation),this.gl.vertexAttribPointer(I.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),o.uv==null&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(I.attributeTexCoordLocation),this.gl.vertexAttribPointer(I.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0);const S=t.getClippingContextBufferForMask()._layoutChannelNo,x=t.getClippingContextBufferForMask().getClippingManager().getChannelFlagAsColor(S);this.gl.uniform4f(I.uniformChannelFlagLocation,x.R,x.G,x.B,x.A),this.gl.uniformMatrix4fv(I.uniformClipMatrixLocation,!1,t.getClippingContextBufferForMask()._matrixForMask.getArray());const V=t.getClippingContextBufferForMask()._layoutBounds;this.gl.uniform4f(I.uniformBaseColorLocation,V.x*2-1,V.y*2-1,V.getRight()*2-1,V.getBottom()*2-1),this.gl.uniform4f(I.uniformMultiplyColorLocation,m.R,m.G,m.B,m.A),this.gl.uniform4f(I.uniformScreenColorLocation,p.R,p.G,p.B,p.A),f=this.gl.ZERO,b=this.gl.ONE_MINUS_SRC_COLOR,y=this.gl.ZERO,B=this.gl.ONE_MINUS_SRC_ALPHA}else{const I=t.getClippingContextBufferForDraw()!=null,S=I?_?2:1:0;let x=new Je;switch(u){case it.CubismBlendMode_Normal:default:x=this._shaderSets.at(1+S),f=this.gl.ONE,b=this.gl.ONE_MINUS_SRC_ALPHA,y=this.gl.ONE,B=this.gl.ONE_MINUS_SRC_ALPHA;break;case it.CubismBlendMode_Additive:x=this._shaderSets.at(4+S),f=this.gl.ONE,b=this.gl.ONE,y=this.gl.ZERO,B=this.gl.ONE;break;case it.CubismBlendMode_Multiplicative:x=this._shaderSets.at(7+S),f=this.gl.DST_COLOR,b=this.gl.ONE_MINUS_SRC_ALPHA,y=this.gl.ZERO,B=this.gl.ONE;break}if(this.gl.useProgram(x.shaderProgram),o.vertex==null&&(o.vertex=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.vertex),this.gl.bufferData(this.gl.ARRAY_BUFFER,r,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(x.attributePositionLocation),this.gl.vertexAttribPointer(x.attributePositionLocation,2,this.gl.FLOAT,!1,0,0),o.uv==null&&(o.uv=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,o.uv),this.gl.bufferData(this.gl.ARRAY_BUFFER,l,this.gl.DYNAMIC_DRAW),this.gl.enableVertexAttribArray(x.attributeTexCoordLocation),this.gl.vertexAttribPointer(x.attributeTexCoordLocation,2,this.gl.FLOAT,!1,0,0),I){this.gl.activeTexture(this.gl.TEXTURE1);const V=t.getClippingContextBufferForDraw().getClippingManager().getColorBuffer().at(t.getClippingContextBufferForDraw()._bufferIndex);this.gl.bindTexture(this.gl.TEXTURE_2D,V),this.gl.uniform1i(x.samplerTexture1Location,1),this.gl.uniformMatrix4fv(x.uniformClipMatrixLocation,!1,t.getClippingContextBufferForDraw()._matrixForDraw.getArray());const Y=t.getClippingContextBufferForDraw()._layoutChannelNo,E=t.getClippingContextBufferForDraw().getClippingManager().getChannelFlagAsColor(Y);this.gl.uniform4f(x.uniformChannelFlagLocation,E.R,E.G,E.B,E.A)}this.gl.activeTexture(this.gl.TEXTURE0),this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.uniform1i(x.samplerTexture0Location,0),this.gl.uniformMatrix4fv(x.uniformMatrixLocation,!1,d.getArray()),this.gl.uniform4f(x.uniformBaseColorLocation,g.R,g.G,g.B,g.A),this.gl.uniform4f(x.uniformMultiplyColorLocation,m.R,m.G,m.B,m.A),this.gl.uniform4f(x.uniformScreenColorLocation,p.R,p.G,p.B,p.A)}o.index==null&&(o.index=this.gl.createBuffer()),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,o.index),this.gl.bufferData(this.gl.ELEMENT_ARRAY_BUFFER,a,this.gl.DYNAMIC_DRAW),this.gl.blendFuncSeparate(f,b,y,B)}releaseShaderProgram(){for(let t=0;t<this._shaderSets.getSize();t++)this.gl.deleteProgram(this._shaderSets.at(t).shaderProgram),this._shaderSets.at(t).shaderProgram=0,this._shaderSets.set(t,void 0),this._shaderSets.set(t,null)}generateShaders(){for(let t=0;t<eo;t++)this._shaderSets.pushBack(new Je);this._shaderSets.at(0).shaderProgram=this.loadShaderProgram(so,ro),this._shaderSets.at(1).shaderProgram=this.loadShaderProgram(ao,no),this._shaderSets.at(2).shaderProgram=this.loadShaderProgram(Ss,oo),this._shaderSets.at(3).shaderProgram=this.loadShaderProgram(Ss,lo),this._shaderSets.at(4).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(5).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(6).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(7).shaderProgram=this._shaderSets.at(1).shaderProgram,this._shaderSets.at(8).shaderProgram=this._shaderSets.at(2).shaderProgram,this._shaderSets.at(9).shaderProgram=this._shaderSets.at(3).shaderProgram,this._shaderSets.at(0).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_position"),this._shaderSets.at(0).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(0).shaderProgram,"a_texCoord"),this._shaderSets.at(0).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"s_texture0"),this._shaderSets.at(0).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_clipMatrix"),this._shaderSets.at(0).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_channelFlag"),this._shaderSets.at(0).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_baseColor"),this._shaderSets.at(0).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_multiplyColor"),this._shaderSets.at(0).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(0).shaderProgram,"u_screenColor"),this._shaderSets.at(1).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_position"),this._shaderSets.at(1).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(1).shaderProgram,"a_texCoord"),this._shaderSets.at(1).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"s_texture0"),this._shaderSets.at(1).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_matrix"),this._shaderSets.at(1).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_baseColor"),this._shaderSets.at(1).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_multiplyColor"),this._shaderSets.at(1).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(1).shaderProgram,"u_screenColor"),this._shaderSets.at(2).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_position"),this._shaderSets.at(2).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(2).shaderProgram,"a_texCoord"),this._shaderSets.at(2).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture0"),this._shaderSets.at(2).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"s_texture1"),this._shaderSets.at(2).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_matrix"),this._shaderSets.at(2).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_clipMatrix"),this._shaderSets.at(2).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_channelFlag"),this._shaderSets.at(2).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_baseColor"),this._shaderSets.at(2).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_multiplyColor"),this._shaderSets.at(2).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(2).shaderProgram,"u_screenColor"),this._shaderSets.at(3).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_position"),this._shaderSets.at(3).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(3).shaderProgram,"a_texCoord"),this._shaderSets.at(3).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture0"),this._shaderSets.at(3).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"s_texture1"),this._shaderSets.at(3).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_matrix"),this._shaderSets.at(3).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_clipMatrix"),this._shaderSets.at(3).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_channelFlag"),this._shaderSets.at(3).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_baseColor"),this._shaderSets.at(3).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_multiplyColor"),this._shaderSets.at(3).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(3).shaderProgram,"u_screenColor"),this._shaderSets.at(4).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_position"),this._shaderSets.at(4).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(4).shaderProgram,"a_texCoord"),this._shaderSets.at(4).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"s_texture0"),this._shaderSets.at(4).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_matrix"),this._shaderSets.at(4).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_baseColor"),this._shaderSets.at(4).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_multiplyColor"),this._shaderSets.at(4).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(4).shaderProgram,"u_screenColor"),this._shaderSets.at(5).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_position"),this._shaderSets.at(5).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(5).shaderProgram,"a_texCoord"),this._shaderSets.at(5).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture0"),this._shaderSets.at(5).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"s_texture1"),this._shaderSets.at(5).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_matrix"),this._shaderSets.at(5).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_clipMatrix"),this._shaderSets.at(5).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_channelFlag"),this._shaderSets.at(5).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_baseColor"),this._shaderSets.at(5).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_multiplyColor"),this._shaderSets.at(5).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(5).shaderProgram,"u_screenColor"),this._shaderSets.at(6).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_position"),this._shaderSets.at(6).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(6).shaderProgram,"a_texCoord"),this._shaderSets.at(6).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture0"),this._shaderSets.at(6).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"s_texture1"),this._shaderSets.at(6).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_matrix"),this._shaderSets.at(6).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_clipMatrix"),this._shaderSets.at(6).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_channelFlag"),this._shaderSets.at(6).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_baseColor"),this._shaderSets.at(6).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_multiplyColor"),this._shaderSets.at(6).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(6).shaderProgram,"u_screenColor"),this._shaderSets.at(7).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_position"),this._shaderSets.at(7).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(7).shaderProgram,"a_texCoord"),this._shaderSets.at(7).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"s_texture0"),this._shaderSets.at(7).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_matrix"),this._shaderSets.at(7).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_baseColor"),this._shaderSets.at(7).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_multiplyColor"),this._shaderSets.at(7).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(7).shaderProgram,"u_screenColor"),this._shaderSets.at(8).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_position"),this._shaderSets.at(8).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(8).shaderProgram,"a_texCoord"),this._shaderSets.at(8).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture0"),this._shaderSets.at(8).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"s_texture1"),this._shaderSets.at(8).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_matrix"),this._shaderSets.at(8).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_clipMatrix"),this._shaderSets.at(8).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_channelFlag"),this._shaderSets.at(8).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_baseColor"),this._shaderSets.at(8).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_multiplyColor"),this._shaderSets.at(8).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(8).shaderProgram,"u_screenColor"),this._shaderSets.at(9).attributePositionLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_position"),this._shaderSets.at(9).attributeTexCoordLocation=this.gl.getAttribLocation(this._shaderSets.at(9).shaderProgram,"a_texCoord"),this._shaderSets.at(9).samplerTexture0Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture0"),this._shaderSets.at(9).samplerTexture1Location=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"s_texture1"),this._shaderSets.at(9).uniformMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_matrix"),this._shaderSets.at(9).uniformClipMatrixLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_clipMatrix"),this._shaderSets.at(9).uniformChannelFlagLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_channelFlag"),this._shaderSets.at(9).uniformBaseColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_baseColor"),this._shaderSets.at(9).uniformMultiplyColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_multiplyColor"),this._shaderSets.at(9).uniformScreenColorLocation=this.gl.getUniformLocation(this._shaderSets.at(9).shaderProgram,"u_screenColor")}loadShaderProgram(t,e){let i=this.gl.createProgram(),r=this.compileShaderSource(this.gl.VERTEX_SHADER,t);if(!r)return X("Vertex shader compile error!"),0;let a=this.compileShaderSource(this.gl.FRAGMENT_SHADER,e);return a?(this.gl.attachShader(i,r),this.gl.attachShader(i,a),this.gl.linkProgram(i),this.gl.getProgramParameter(i,this.gl.LINK_STATUS)?(this.gl.deleteShader(r),this.gl.deleteShader(a),i):(X("Failed to link program: {0}",i),this.gl.deleteShader(r),r=0,this.gl.deleteShader(a),a=0,i&&(this.gl.deleteProgram(i),i=0),0)):(X("Vertex shader compile error!"),0)}compileShaderSource(t,e){const i=e,r=this.gl.createShader(t);if(this.gl.shaderSource(r,i),this.gl.compileShader(r),!r){const a=this.gl.getShaderInfoLog(r);X("Shader compile log: {0} ",a)}return this.gl.getShaderParameter(r,this.gl.COMPILE_STATUS)?r:(this.gl.deleteShader(r),null)}setGl(t){this.gl=t}}class Je{constructor(){n(this,"shaderProgram");n(this,"attributePositionLocation");n(this,"attributeTexCoordLocation");n(this,"uniformMatrixLocation");n(this,"uniformClipMatrixLocation");n(this,"samplerTexture0Location");n(this,"samplerTexture1Location");n(this,"uniformBaseColorLocation");n(this,"uniformChannelFlagLocation");n(this,"uniformMultiplyColorLocation");n(this,"uniformScreenColorLocation")}}var pr=(s=>(s[s.ShaderNames_SetupMask=0]="ShaderNames_SetupMask",s[s.ShaderNames_NormalPremultipliedAlpha=1]="ShaderNames_NormalPremultipliedAlpha",s[s.ShaderNames_NormalMaskedPremultipliedAlpha=2]="ShaderNames_NormalMaskedPremultipliedAlpha",s[s.ShaderNames_NomralMaskedInvertedPremultipliedAlpha=3]="ShaderNames_NomralMaskedInvertedPremultipliedAlpha",s[s.ShaderNames_AddPremultipliedAlpha=4]="ShaderNames_AddPremultipliedAlpha",s[s.ShaderNames_AddMaskedPremultipliedAlpha=5]="ShaderNames_AddMaskedPremultipliedAlpha",s[s.ShaderNames_AddMaskedPremultipliedAlphaInverted=6]="ShaderNames_AddMaskedPremultipliedAlphaInverted",s[s.ShaderNames_MultPremultipliedAlpha=7]="ShaderNames_MultPremultipliedAlpha",s[s.ShaderNames_MultMaskedPremultipliedAlpha=8]="ShaderNames_MultMaskedPremultipliedAlpha",s[s.ShaderNames_MultMaskedPremultipliedAlphaInverted=9]="ShaderNames_MultMaskedPremultipliedAlphaInverted",s))(pr||{});const so="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_myPos;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_clipMatrix * a_position;   v_myPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",ro="precision mediump float;varying vec2       v_texCoord;varying vec4       v_myPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;void main(){   float isInside =        step(u_baseColor.x, v_myPos.x/v_myPos.w)       * step(u_baseColor.y, v_myPos.y/v_myPos.w)       * step(v_myPos.x/v_myPos.w, u_baseColor.z)       * step(v_myPos.y/v_myPos.w, u_baseColor.w);   gl_FragColor = u_channelFlag * texture2D(s_texture0, v_texCoord).a * isInside;}",ao="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;uniform mat4       u_matrix;void main(){   gl_Position = u_matrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",Ss="attribute vec4     a_position;attribute vec2     a_texCoord;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform mat4       u_matrix;uniform mat4       u_clipMatrix;void main(){   gl_Position = u_matrix * a_position;   v_clipPos = u_clipMatrix * a_position;   v_texCoord = a_texCoord;   v_texCoord.y = 1.0 - v_texCoord.y;}",no="precision mediump float;varying vec2       v_texCoord;uniform vec4       u_baseColor;uniform sampler2D  s_texture0;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 color = texColor * u_baseColor;   gl_FragColor = vec4(color.rgb, color.a);}",oo="precision mediump float;varying vec2       v_texCoord;varying vec4       v_clipPos;uniform vec4       u_baseColor;uniform vec4       u_channelFlag;uniform sampler2D  s_texture0;uniform sampler2D  s_texture1;uniform vec4       u_multiplyColor;uniform vec4       u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * maskVal;   gl_FragColor = col_formask;}",lo="precision mediump float;varying vec2      v_texCoord;varying vec4      v_clipPos;uniform sampler2D s_texture0;uniform sampler2D s_texture1;uniform vec4      u_channelFlag;uniform vec4      u_baseColor;uniform vec4      u_multiplyColor;uniform vec4      u_screenColor;void main(){   vec4 texColor = texture2D(s_texture0, v_texCoord);   texColor.rgb = texColor.rgb * u_multiplyColor.rgb;   texColor.rgb = (texColor.rgb + u_screenColor.rgb * texColor.a) - (texColor.rgb * u_screenColor.rgb);   vec4 col_formask = texColor * u_baseColor;   vec4 clipMask = (1.0 - texture2D(s_texture1, v_clipPos.xy / v_clipPos.w)) * u_channelFlag;   float maskVal = clipMask.r + clipMask.g + clipMask.b + clipMask.a;   col_formask = col_formask * (1.0 - maskVal);   gl_FragColor = col_formask;}";class ni extends se{constructor(){super();n(this,"_textures");n(this,"_sortedDrawableIndexList");n(this,"_clippingManager");n(this,"_clippingContextBufferForMask");n(this,"_clippingContextBufferForDraw");n(this,"_rendererProfile");n(this,"firstDraw");n(this,"_bufferData");n(this,"_extension");n(this,"gl");this._clippingContextBufferForMask=null,this._clippingContextBufferForDraw=null,this._rendererProfile=new io,this.firstDraw=!0,this._textures=new H,this._sortedDrawableIndexList=new v,this._bufferData={vertex:WebGLBuffer=null,uv:WebGLBuffer=null,index:WebGLBuffer=null},this._textures.prepareCapacity(32,!0)}initialize(e,i=1){e.isUsingMasking()&&(this._clippingManager=new $e,this._clippingManager.initialize(e,e.getDrawableCount(),e.getDrawableMasks(),e.getDrawableMaskCounts(),i)),this._sortedDrawableIndexList.resize(e.getDrawableCount(),0),super.initialize(e)}bindTexture(e,i){this._textures.setValue(e,i)}getBindedTextures(){return this._textures}setClippingMaskBufferSize(e){if(!this._model.isUsingMasking())return;const i=this._clippingManager.getRenderTextureCount();this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null,this._clippingManager=new $e,this._clippingManager.setClippingMaskBufferSize(e),this._clippingManager.initialize(this.getModel(),this.getModel().getDrawableCount(),this.getModel().getDrawableMasks(),this.getModel().getDrawableMaskCounts(),i)}getClippingMaskBufferSize(){return this._model.isUsingMasking()?this._clippingManager.getClippingMaskBufferSize():-1}getRenderTextureCount(){return this._model.isUsingMasking()?this._clippingManager.getRenderTextureCount():-1}release(){this._clippingManager&&(this._clippingManager.release(),this._clippingManager=void 0,this._clippingManager=null),this.gl!=null&&(this.gl.deleteBuffer(this._bufferData.vertex),this._bufferData.vertex=null,this.gl.deleteBuffer(this._bufferData.uv),this._bufferData.uv=null,this.gl.deleteBuffer(this._bufferData.index),this._bufferData.index=null,this._bufferData=null,this._textures=null)}doDrawModel(){if(this.gl==null){X(`'gl' is null. WebGLRenderingContext is required.
Please call 'CubimRenderer_WebGL.startUp' function.`);return}this._clippingManager!=null&&(this.preDraw(),this._clippingManager.setupClippingContext(this.getModel(),this)),this.preDraw();const e=this.getModel().getDrawableCount(),i=this.getModel().getDrawableRenderOrders();for(let r=0;r<e;++r){const a=i[r];this._sortedDrawableIndexList.set(a,r)}for(let r=0;r<e;++r){const a=this._sortedDrawableIndexList.at(r);if(!this.getModel().getDrawableDynamicFlagIsVisible(a))continue;const l=this._clippingManager!=null?this._clippingManager.getClippingContextListForDraw().at(a):null;if(l!=null&&this.isUsingHighPrecisionMask()){l._isUsing&&(this.gl.viewport(0,0,this._clippingManager.getClippingMaskBufferSize(),this._clippingManager.getClippingMaskBufferSize()),this.preDraw(),this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,l.getClippingManager().getMaskRenderTexture().at(l._bufferIndex)),this.gl.clearColor(1,1,1,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT));{const o=l._clippingIdCount;for(let h=0;h<o;h++){const u=l._clippingIdList[h];this._model.getDrawableDynamicFlagVertexPositionsDidChange(u)&&(this.setIsCulling(this._model.getDrawableCulling(u)!=!1),this.setClippingContextBufferForMask(l),this.drawMesh(this.getModel().getDrawableTextureIndex(u),this.getModel().getDrawableVertexIndexCount(u),this.getModel().getDrawableVertexCount(u),this.getModel().getDrawableVertexIndices(u),this.getModel().getDrawableVertices(u),this.getModel().getDrawableVertexUvs(u),this.getModel().getMultiplyColor(u),this.getModel().getScreenColor(u),this.getModel().getDrawableOpacity(u),it.CubismBlendMode_Normal,!1))}}this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,Me),this.setClippingContextBufferForMask(null),this.gl.viewport(ot[0],ot[1],ot[2],ot[3]),this.preDraw()}this.setClippingContextBufferForDraw(l),this.setIsCulling(this.getModel().getDrawableCulling(a)),this.drawMesh(this.getModel().getDrawableTextureIndex(a),this.getModel().getDrawableVertexIndexCount(a),this.getModel().getDrawableVertexCount(a),this.getModel().getDrawableVertexIndices(a),this.getModel().getDrawableVertices(a),this.getModel().getDrawableVertexUvs(a),this.getModel().getMultiplyColor(a),this.getModel().getScreenColor(a),this.getModel().getDrawableOpacity(a),this.getModel().getDrawableBlendMode(a),this.getModel().getDrawableInvertedMaskBit(a))}}drawMesh(e,i,r,a,l,o,h,u,g,m,p){this.isCulling()?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this.gl.frontFace(this.gl.CCW);const c=this.getModelColor();this.getClippingContextBufferForMask()==null&&(c.A*=g,this.isPremultipliedAlpha()&&(c.R*=c.A,c.G*=c.A,c.B*=c.A));let d;this._textures.getValue(e)!=null?d=this._textures.getValue(e):d=null,Nt.getInstance().setupShaderProgram(this,d,r,l,a,o,this._bufferData,g,m,c,h,u,this.isPremultipliedAlpha(),this.getMvpMatrix(),p),this.gl.drawElements(this.gl.TRIANGLES,i,this.gl.UNSIGNED_SHORT,0),this.gl.useProgram(null),this.setClippingContextBufferForDraw(null),this.setClippingContextBufferForMask(null)}saveProfile(){this._rendererProfile.save()}restoreProfile(){this._rendererProfile.restore()}static doStaticRelease(){Nt.deleteInstance()}setRenderState(e,i){Me=e,ot=i}preDraw(){if(this.firstDraw&&(this.firstDraw=!1),this.gl.disable(this.gl.SCISSOR_TEST),this.gl.disable(this.gl.STENCIL_TEST),this.gl.disable(this.gl.DEPTH_TEST),this.gl.frontFace(this.gl.CW),this.gl.enable(this.gl.BLEND),this.gl.colorMask(!0,!0,!0,!0),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.gl.bindBuffer(this.gl.ELEMENT_ARRAY_BUFFER,null),this.getAnisotropy()>0&&this._extension)for(let e=0;e<this._textures.getSize();++e)this.gl.bindTexture(this.gl.TEXTURE_2D,this._textures.getValue(e)),this.gl.texParameterf(this.gl.TEXTURE_2D,this._extension.TEXTURE_MAX_ANISOTROPY_EXT,this.getAnisotropy())}setClippingContextBufferForMask(e){this._clippingContextBufferForMask=e}getClippingContextBufferForMask(){return this._clippingContextBufferForMask}setClippingContextBufferForDraw(e){this._clippingContextBufferForDraw=e}getClippingContextBufferForDraw(){return this._clippingContextBufferForDraw}startUp(e){this.gl=e,this._clippingManager&&this._clippingManager.setGL(e),Nt.getInstance().setGl(e),this._rendererProfile.setGl(e),this._extension=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")}}se.staticRelease=()=>{ni.doStaticRelease()};var Cs;(s=>{s.CubismClippingContext=_r,s.CubismClippingManager_WebGL=$e,s.CubismRenderTextureResource=mr,s.CubismRenderer_WebGL=ni,s.CubismShaderSet=Je,s.CubismShader_WebGL=Nt,s.ShaderNames=pr})(Cs||(Cs={}));class Ms{constructor(){n(this,"isOverwritten",!1);n(this,"Color",new ht)}}class vs{constructor(t=!1,e=!1){n(this,"isOverwritten");n(this,"isCulling");t=this.isOverwritten,e=this.isCulling}}class fr{constructor(t){n(this,"_notExistPartOpacities");n(this,"_notExistPartId");n(this,"_notExistParameterValues");n(this,"_notExistParameterId");n(this,"_savedParameters");n(this,"_isOverwrittenModelMultiplyColors");n(this,"_isOverwrittenModelScreenColors");n(this,"_userMultiplyColors");n(this,"_userScreenColors");n(this,"_model");n(this,"_parameterValues");n(this,"_parameterMaximumValues");n(this,"_parameterMinimumValues");n(this,"_partOpacities");n(this,"_parameterIds");n(this,"_partIds");n(this,"_drawableIds");n(this,"_isOverwrittenCullings");n(this,"_userCullings");this._model=t,this._parameterValues=null,this._parameterMaximumValues=null,this._parameterMinimumValues=null,this._partOpacities=null,this._savedParameters=new v,this._parameterIds=new v,this._drawableIds=new v,this._partIds=new v,this._isOverwrittenModelMultiplyColors=!1,this._isOverwrittenModelScreenColors=!1,this._isOverwrittenCullings=!1,this._userMultiplyColors=null,this._userScreenColors=null,this._notExistPartId=new H,this._notExistParameterId=new H,this._notExistParameterValues=new H,this._notExistPartOpacities=new H}update(){this._model.update(),this._model.drawables.resetDynamicFlags()}getPixelsPerUnit(){return this._model==null?0:this._model.canvasinfo.PixelsPerUnit}getCanvasWidth(){return this._model==null?0:this._model.canvasinfo.CanvasWidth/this._model.canvasinfo.PixelsPerUnit}getCanvasHeight(){return this._model==null?0:this._model.canvasinfo.CanvasHeight/this._model.canvasinfo.PixelsPerUnit}saveParameters(){const t=this._model.parameters.count,e=this._savedParameters.getSize();for(let i=0;i<t;++i)i<e?this._savedParameters.set(i,this._parameterValues[i]):this._savedParameters.pushBack(this._parameterValues[i])}getMultiplyColor(t){return this.getOverwriteFlagForModelMultiplyColors()||this.getOverwriteFlagForDrawableMultiplyColors(t)?this._userMultiplyColors.at(t).Color:this.getDrawableMultiplyColor(t)}getScreenColor(t){return this.getOverwriteFlagForModelScreenColors()||this.getOverwriteFlagForDrawableScreenColors(t)?this._userScreenColors.at(t).Color:this.getDrawableScreenColor(t)}setMultiplyColorByTextureColor(t,e){this.setMultiplyColorByRGBA(t,e.R,e.G,e.B,e.A)}setMultiplyColorByRGBA(t,e,i,r,a=1){this._userMultiplyColors.at(t).Color.R=e,this._userMultiplyColors.at(t).Color.G=i,this._userMultiplyColors.at(t).Color.B=r,this._userMultiplyColors.at(t).Color.A=a}setScreenColorByTextureColor(t,e){this.setScreenColorByRGBA(t,e.R,e.G,e.B,e.A)}setScreenColorByRGBA(t,e,i,r,a=1){this._userScreenColors.at(t).Color.R=e,this._userScreenColors.at(t).Color.G=i,this._userScreenColors.at(t).Color.B=r,this._userScreenColors.at(t).Color.A=a}getOverwriteFlagForModelMultiplyColors(){return this._isOverwrittenModelMultiplyColors}getOverwriteFlagForModelScreenColors(){return this._isOverwrittenModelScreenColors}setOverwriteFlagForModelMultiplyColors(t){this._isOverwrittenModelMultiplyColors=t}setOverwriteFlagForModelScreenColors(t){this._isOverwrittenModelScreenColors=t}getOverwriteFlagForDrawableMultiplyColors(t){return this._userMultiplyColors.at(t).isOverwritten}getOverwriteFlagForDrawableScreenColors(t){return this._userMultiplyColors.at(t).isOverwritten}setOverwriteFlagForDrawableMultiplyColors(t,e){this._userMultiplyColors.at(t).isOverwritten=e}setOverwriteFlagForDrawableScreenColors(t,e){this._userScreenColors.at(t).isOverwritten=e}getDrawableCulling(t){if(this.getOverwriteFlagForModelCullings()||this.getOverwriteFlagForDrawableCullings(t))return this._userCullings.at(t).isCulling;const e=this._model.drawables.constantFlags;return!Live2DCubismCore.Utils.hasIsDoubleSidedBit(e[t])}setDrawableCulling(t,e){this._userCullings.at(t).isCulling=e}getOverwriteFlagForModelCullings(){return this._isOverwrittenCullings}setOverwriteFlagForModelCullings(t){this._isOverwrittenCullings=t}getOverwriteFlagForDrawableCullings(t){return this._userCullings.at(t).isOverwritten}setOverwriteFlagForDrawableCullings(t,e){this._userCullings.at(t).isOverwritten=e}getModel(){return this._model}getPartIndex(t){let e;const i=this._model.parts.count;for(e=0;e<i;++e)if(t==this._partIds.at(e))return e;return this._notExistPartId.isExist(t)?this._notExistPartId.getValue(t):(e=i+this._notExistPartId.getSize(),this._notExistPartId.setValue(t,e),this._notExistPartOpacities.appendKey(e),e)}getPartCount(){return this._model.parts.count}setPartOpacityByIndex(t,e){if(this._notExistPartOpacities.isExist(t)){this._notExistPartOpacities.setValue(t,e);return}et(0<=t&&t<this.getPartCount()),this._partOpacities[t]=e}setPartOpacityById(t,e){const i=this.getPartIndex(t);i<0||this.setPartOpacityByIndex(i,e)}getPartOpacityByIndex(t){return this._notExistPartOpacities.isExist(t)?this._notExistPartOpacities.getValue(t):(et(0<=t&&t<this.getPartCount()),this._partOpacities[t])}getPartOpacityById(t){const e=this.getPartIndex(t);return e<0?0:this.getPartOpacityByIndex(e)}getParameterIndex(t){let e;const i=this._model.parameters.count;for(e=0;e<i;++e)if(t==this._parameterIds.at(e))return e;return this._notExistParameterId.isExist(t)?this._notExistParameterId.getValue(t):(e=this._model.parameters.count+this._notExistParameterId.getSize(),this._notExistParameterId.setValue(t,e),this._notExistParameterValues.appendKey(e),e)}getParameterCount(){return this._model.parameters.count}getParameterType(t){return this._model.parameters.types[t]}getParameterMaximumValue(t){return this._model.parameters.maximumValues[t]}getParameterMinimumValue(t){return this._model.parameters.minimumValues[t]}getParameterDefaultValue(t){return this._model.parameters.defaultValues[t]}getParameterValueByIndex(t){return this._notExistParameterValues.isExist(t)?this._notExistParameterValues.getValue(t):(et(0<=t&&t<this.getParameterCount()),this._parameterValues[t])}getParameterValueById(t){const e=this.getParameterIndex(t);return this.getParameterValueByIndex(e)}setParameterValueByIndex(t,e,i=1){if(this._notExistParameterValues.isExist(t)){this._notExistParameterValues.setValue(t,i==1?e:this._notExistParameterValues.getValue(t)*(1-i)+e*i);return}et(0<=t&&t<this.getParameterCount()),this._model.parameters.maximumValues[t]<e&&(e=this._model.parameters.maximumValues[t]),this._model.parameters.minimumValues[t]>e&&(e=this._model.parameters.minimumValues[t]),this._parameterValues[t]=i==1?e:this._parameterValues[t]=this._parameterValues[t]*(1-i)+e*i}setParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.setParameterValueByIndex(r,e,i)}addParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)+e*i)}addParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.addParameterValueByIndex(r,e,i)}multiplyParameterValueById(t,e,i=1){const r=this.getParameterIndex(t);this.multiplyParameterValueByIndex(r,e,i)}multiplyParameterValueByIndex(t,e,i=1){this.setParameterValueByIndex(t,this.getParameterValueByIndex(t)*(1+(e-1)*i))}getDrawableIndex(t){const e=this._model.drawables.count;for(let i=0;i<e;++i)if(this._drawableIds.at(i)==t)return i;return-1}getDrawableCount(){return this._model.drawables.count}getDrawableId(t){const e=this._model.drawables.ids;return R.getIdManager().getId(e[t])}getDrawableRenderOrders(){return this._model.drawables.renderOrders}getDrawableTextureIndices(t){return this.getDrawableTextureIndex(t)}getDrawableTextureIndex(t){return this._model.drawables.textureIndices[t]}getDrawableDynamicFlagVertexPositionsDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVertexPositionsDidChangeBit(e[t])}getDrawableVertexIndexCount(t){return this._model.drawables.indexCounts[t]}getDrawableVertexCount(t){return this._model.drawables.vertexCounts[t]}getDrawableVertices(t){return this.getDrawableVertexPositions(t)}getDrawableVertexIndices(t){return this._model.drawables.indices[t]}getDrawableVertexPositions(t){return this._model.drawables.vertexPositions[t]}getDrawableVertexUvs(t){return this._model.drawables.vertexUvs[t]}getDrawableOpacity(t){return this._model.drawables.opacities[t]}getDrawableMultiplyColor(t){const e=this._model.drawables.multiplyColors,i=t*4,r=new ht;return r.R=e[i],r.G=e[i+1],r.B=e[i+2],r.A=e[i+3],r}getDrawableScreenColor(t){const e=this._model.drawables.screenColors,i=t*4,r=new ht;return r.R=e[i],r.G=e[i+1],r.B=e[i+2],r.A=e[i+3],r}getDrawableParentPartIndex(t){return this._model.drawables.parentPartIndices[t]}getDrawableBlendMode(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasBlendAdditiveBit(e[t])?it.CubismBlendMode_Additive:Live2DCubismCore.Utils.hasBlendMultiplicativeBit(e[t])?it.CubismBlendMode_Multiplicative:it.CubismBlendMode_Normal}getDrawableInvertedMaskBit(t){const e=this._model.drawables.constantFlags;return Live2DCubismCore.Utils.hasIsInvertedMaskBit(e[t])}getDrawableMasks(){return this._model.drawables.masks}getDrawableMaskCounts(){return this._model.drawables.maskCounts}isUsingMasking(){for(let t=0;t<this._model.drawables.count;++t)if(!(this._model.drawables.maskCounts[t]<=0))return!0;return!1}getDrawableDynamicFlagIsVisible(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasIsVisibleBit(e[t])}getDrawableDynamicFlagVisibilityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasVisibilityDidChangeBit(e[t])}getDrawableDynamicFlagOpacityDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasOpacityDidChangeBit(e[t])}getDrawableDynamicFlagRenderOrderDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasRenderOrderDidChangeBit(e[t])}getDrawableDynamicFlagBlendColorDidChange(t){const e=this._model.drawables.dynamicFlags;return Live2DCubismCore.Utils.hasBlendColorDidChangeBit(e[t])}loadParameters(){let t=this._model.parameters.count;const e=this._savedParameters.getSize();t>e&&(t=e);for(let i=0;i<t;++i)this._parameterValues[i]=this._savedParameters.at(i)}initialize(){et(this._model),this._parameterValues=this._model.parameters.values,this._partOpacities=this._model.parts.opacities,this._parameterMaximumValues=this._model.parameters.maximumValues,this._parameterMinimumValues=this._model.parameters.minimumValues;{const t=this._model.parameters.ids,e=this._model.parameters.count;this._parameterIds.prepareCapacity(e);for(let i=0;i<e;++i)this._parameterIds.pushBack(R.getIdManager().getId(t[i]))}{const t=this._model.parts.ids,e=this._model.parts.count;this._partIds.prepareCapacity(e);for(let i=0;i<e;++i)this._partIds.pushBack(R.getIdManager().getId(t[i]))}{const t=this._model.drawables.ids,e=this._model.drawables.count;this._userMultiplyColors=new v,this._userMultiplyColors.updateSize(e,Ms,!0),this._userScreenColors=new v,this._userScreenColors.updateSize(e,Ms,!0),this._userCullings=new v,this._userCullings.updateSize(e,vs,!0);const i=new vs(!1,!1);this._drawableIds.prepareCapacity(e);for(let r=0;r<e;++r)this._drawableIds.pushBack(R.getIdManager().getId(t[r])),this.setMultiplyColorByRGBA(r,1,1,1,1),this.setScreenColorByRGBA(r,0,0,0,1),this._userCullings.pushBack(i)}}release(){this._model.release(),this._model=null}}var Bs;(s=>{s.CubismModel=fr})(Bs||(Bs={}));class Te{constructor(t){n(this,"_moc");n(this,"_modelCount");n(this,"_mocVersion");this._moc=t,this._modelCount=0,this._mocVersion=0}static create(t){let e=null;const i=Live2DCubismCore.Moc.fromArrayBuffer(t);return i&&(e=new Te(i),e._mocVersion=Live2DCubismCore.Version.csmGetMocVersion(i,t)),e}static delete(t){t._moc._release(),t._moc=null,t=null}createModel(){let t=null;const e=Live2DCubismCore.Model.fromMoc(this._moc);return e&&(t=new fr(e),t.initialize(),++this._modelCount),t}deleteModel(t){t!=null&&(t.release(),t=null,--this._modelCount)}release(){et(this._modelCount==0),this._moc._release(),this._moc=null}getLatestMocVersion(){return Live2DCubismCore.Version.csmGetLatestMocVersion()}getMocVersion(){return this._mocVersion}static hasMocConsistency(t){return Live2DCubismCore.Moc.prototype.hasMocConsistency(t)===1}}var bs;(s=>{s.CubismMoc=Te})(bs||(bs={}));const Ps="Meta",ho="UserDataCount",uo="TotalUserDataSize",je="UserData",go="Target",co="Id",mo="Value";class yr{constructor(t,e){n(this,"_json");this._json=N.create(t,e)}release(){N.delete(this._json)}getUserDataCount(){return this._json.getRoot().getValueByString(Ps).getValueByString(ho).toInt()}getTotalUserDataSize(){return this._json.getRoot().getValueByString(Ps).getValueByString(uo).toInt()}getUserDataTargetType(t){return this._json.getRoot().getValueByString(je).getValueByIndex(t).getValueByString(go).getRawString()}getUserDataId(t){return R.getIdManager().getId(this._json.getRoot().getValueByString(je).getValueByIndex(t).getValueByString(co).getRawString())}getUserDataValue(t){return this._json.getRoot().getValueByString(je).getValueByIndex(t).getValueByString(mo).getRawString()}}var ws;(s=>{s.CubismModelUserDataJson=yr})(ws||(ws={}));const _o="ArtMesh";class xr{constructor(){n(this,"targetType");n(this,"targetId");n(this,"value")}}class ee{constructor(){n(this,"_userDataNodes");n(this,"_artMeshUserDataNode");this._userDataNodes=new v,this._artMeshUserDataNode=new v}static create(t,e){const i=new ee;return i.parseUserData(t,e),i}static delete(t){t!=null&&(t.release(),t=null)}getArtMeshUserDatas(){return this._artMeshUserDataNode}parseUserData(t,e){let i=new yr(t,e);const r=R.getIdManager().getId(_o),a=i.getUserDataCount();for(let l=0;l<a;l++){const o=new xr;o.targetId=i.getUserDataId(l),o.targetType=R.getIdManager().getId(i.getUserDataTargetType(l)),o.value=new Z(i.getUserDataValue(l)),this._userDataNodes.pushBack(o),o.targetType==r&&this._artMeshUserDataNode.pushBack(o)}i.release(),i=void 0}release(){for(let t=0;t<this._userDataNodes.getSize();++t)this._userDataNodes.set(t,null);this._userDataNodes=null}}var Is;(s=>{s.CubismModelUserData=ee,s.CubismModelUserDataNode=xr})(Is||(Is={}));class Re{constructor(){n(this,"loadMotion",(t,e,i,r)=>Ie.create(t,e,r));n(this,"_moc");n(this,"_model");n(this,"_motionManager");n(this,"_expressionManager");n(this,"_eyeBlink");n(this,"_breath");n(this,"_modelMatrix");n(this,"_pose");n(this,"_dragManager");n(this,"_physics");n(this,"_modelUserData");n(this,"_initialized");n(this,"_updating");n(this,"_opacity");n(this,"_lipsync");n(this,"_lastLipSyncValue");n(this,"_dragX");n(this,"_dragY");n(this,"_accelerationX");n(this,"_accelerationY");n(this,"_accelerationZ");n(this,"_debugMode");n(this,"_renderer");this._moc=null,this._model=null,this._motionManager=null,this._expressionManager=null,this._eyeBlink=null,this._breath=null,this._modelMatrix=null,this._pose=null,this._dragManager=null,this._physics=null,this._modelUserData=null,this._initialized=!1,this._updating=!1,this._opacity=1,this._lipsync=!0,this._lastLipSyncValue=0,this._dragX=0,this._dragY=0,this._accelerationX=0,this._accelerationY=0,this._accelerationZ=0,this._debugMode=!1,this._renderer=null,this._motionManager=new Kt,this._motionManager.setEventCallback(Re.cubismDefaultMotionEventCallback,this),this._expressionManager=new Kt,this._dragManager=new $s}isInitialized(){return this._initialized}setInitialized(t){this._initialized=t}isUpdating(){return this._updating}setUpdating(t){this._updating=t}setDragging(t,e){this._dragManager.set(t,e)}setAcceleration(t,e,i){this._accelerationX=t,this._accelerationY=e,this._accelerationZ=i}getModelMatrix(){return this._modelMatrix}setOpacity(t){this._opacity=t}getOpacity(){return this._opacity}loadModel(t){if(this._moc=Te.create(t),this._moc==null){X("Failed to CubismMoc.create().");return}if(this._model=this._moc.createModel(),this._model==null){X("Failed to CreateModel().");return}this._model.saveParameters(),this._modelMatrix=new Zs(this._model.getCanvasWidth(),this._model.getCanvasHeight())}loadExpression(t,e,i){return we.create(t,e)}loadPose(t,e){this._pose=Jt.create(t,e)}loadUserData(t,e){this._modelUserData=ee.create(t,e)}loadPhysics(t,e){this._physics=te.create(t,e)}isHit(t,e,i){const r=this._model.getDrawableIndex(t);if(r<0)return!1;const a=this._model.getDrawableVertexCount(r),l=this._model.getDrawableVertices(r);let o=l[0],h=l[0],u=l[1],g=l[1];for(let c=1;c<a;++c){const d=l[xt.vertexOffset+c*xt.vertexStep],_=l[xt.vertexOffset+c*xt.vertexStep+1];d<o&&(o=d),d>h&&(h=d),_<u&&(u=_),_>g&&(g=_)}const m=this._modelMatrix.invertTransformX(e),p=this._modelMatrix.invertTransformY(i);return o<=m&&m<=h&&u<=p&&p<=g}getModel(){return this._model}getRenderer(){return this._renderer}createRenderer(t=1){this._renderer&&this.deleteRenderer(),this._renderer=new ni,this._renderer.initialize(this._model,t)}deleteRenderer(){this._renderer!=null&&(this._renderer.release(),this._renderer=null)}motionEventFired(t){nt("{0}",t.s)}static cubismDefaultMotionEventCallback(t,e,i){const r=i;r==null||r.motionEventFired(e)}release(){this._motionManager!=null&&(this._motionManager.release(),this._motionManager=null),this._expressionManager!=null&&(this._expressionManager.release(),this._expressionManager=null),this._moc!=null&&(this._moc.deleteModel(this._model),this._moc.release(),this._moc=null),this._modelMatrix=null,Jt.delete(this._pose),kt.delete(this._eyeBlink),re.delete(this._breath),this._dragManager=null,te.delete(this._physics),ee.delete(this._modelUserData),this.deleteRenderer()}}var Ts;(s=>{s.CubismUserModel=Re})(Ts||(Ts={}));class T{static loadFileAsBytes(t,e){fetch(t).then(i=>i.arrayBuffer()).then(i=>e(i,i.byteLength))}static getDeltaTime(){return this._deltaTime}static updateTime(){this._currentFrame=Date.now(),this._deltaTime=(this._currentFrame-this._lastFrame)/1e3,this._lastFrame=this._currentFrame}static printMessage(t){j.debug&&console.log(t)}}n(T,"_currentFrame",0),n(T,"_lastFrame",0),n(T,"_deltaTime",0);const oi=class{constructor(){n(this,"pcmData");n(this,"userTimeSeconds");n(this,"lastRms");n(this,"sampleOffset");n(this,"wavFileInfo");n(this,"byteReader");n(this,"audio");n(this,"audioPlayPromise");n(this,"loadFileToBytes",t=>{this.byteReader._fileByte=t,this.byteReader._fileDataView=new DataView(this.byteReader._fileByte),this.byteReader._fileSize=this.byteReader._fileByte.byteLength,this.byteReader._readOffset=0});this.pcmData=null,this.userTimeSeconds=0,this.lastRms=0,this.sampleOffset=0,this.wavFileInfo=new po,this.byteReader=new fo,this.audio=new Audio}static getInstance(){return this._instance==null&&(this._instance=new oi),this._instance}static releaseInstance(){this._instance!=null&&(this._instance=void 0),this._instance=null}update(t){let e,i;if(this.pcmData==null||this.sampleOffset>=this.wavFileInfo._samplesPerChannel)return this.lastRms=0,!1;this.userTimeSeconds+=t,e=Math.floor(this.userTimeSeconds*this.wavFileInfo._samplingRate),e>this.wavFileInfo._samplesPerChannel&&(e=this.wavFileInfo._samplesPerChannel),i=0;for(let r=0;r<this.wavFileInfo._numberOfChannels;r++)for(let a=this.sampleOffset;a<e;a++){const l=this.pcmData[r][a];i+=l*l}return i=Math.sqrt(i/(this.wavFileInfo._numberOfChannels*(e-this.sampleOffset))),this.lastRms=i,this.sampleOffset=e,!0}async start(t){return this.sampleOffset=0,this.userTimeSeconds=0,this.lastRms=0,this.playWavFile(t),await this.loadWavFile(t)}getRms(){return this.lastRms}async loadWavFile(t){let e=!1;this.pcmData!=null&&this.releasePcmData();const i=async()=>fetch(t).then(r=>r.arrayBuffer());if(this.loadFileToBytes(await i()),this.byteReader._fileSize<4)return!1;this.wavFileInfo._fileName=t;try{if(!this.byteReader.getCheckSignature("RIFF"))throw e=!1,new Error('Cannot find Signeture "RIFF".');if(this.byteReader.get32LittleEndian(),!this.byteReader.getCheckSignature("WAVE"))throw e=!1,new Error('Cannot find Signeture "WAVE".');if(!this.byteReader.getCheckSignature("fmt "))throw e=!1,new Error('Cannot find Signeture "fmt".');const r=this.byteReader.get32LittleEndian();if(this.byteReader.get16LittleEndian()!=1)throw e=!1,new Error("File is not linear PCM.");for(this.wavFileInfo._numberOfChannels=this.byteReader.get16LittleEndian(),this.wavFileInfo._samplingRate=this.byteReader.get32LittleEndian(),this.byteReader.get32LittleEndian(),this.byteReader.get16LittleEndian(),this.wavFileInfo._bitsPerSample=this.byteReader.get16LittleEndian(),r>16&&(this.byteReader._readOffset+=r-16);!this.byteReader.getCheckSignature("data")&&this.byteReader._readOffset<this.byteReader._fileSize;)this.byteReader._readOffset+=this.byteReader.get32LittleEndian()+4;if(this.byteReader._readOffset>=this.byteReader._fileSize)throw e=!1,new Error('Cannot find "data" Chunk.');{const a=this.byteReader.get32LittleEndian();this.wavFileInfo._samplesPerChannel=a*8/(this.wavFileInfo._bitsPerSample*this.wavFileInfo._numberOfChannels)}this.pcmData=new Array(this.wavFileInfo._numberOfChannels);for(let a=0;a<this.wavFileInfo._numberOfChannels;a++)this.pcmData[a]=new Float32Array(this.wavFileInfo._samplesPerChannel);for(let a=0;a<this.wavFileInfo._samplesPerChannel;a++)for(let l=0;l<this.wavFileInfo._numberOfChannels;l++)this.pcmData[l][a]=this.getPcmSample();e=!0}catch(r){console.error(r)}return e}playWavFile(t){this.audio.src=t,this.audioPlayPromise=this.audio.play()}getPcmSample(){let t;switch(this.wavFileInfo._bitsPerSample){case 8:t=this.byteReader.get8()-128,t<<=24;break;case 16:t=this.byteReader.get16LittleEndian()<<16;break;case 24:t=this.byteReader.get24LittleEndian()<<8;break;default:t=0;break}return t/2147483647}releasePcmData(){for(let t=0;t<this.wavFileInfo._numberOfChannels;t++)delete this.pcmData[t];delete this.pcmData,this.pcmData=null}release(){var t;(t=this.audioPlayPromise)==null||t.then(()=>this.audio.pause())}};let pe=oi;n(pe,"_instance",null);class po{constructor(){n(this,"_fileName");n(this,"_numberOfChannels");n(this,"_bitsPerSample");n(this,"_samplingRate");n(this,"_samplesPerChannel");this._fileName="",this._numberOfChannels=0,this._bitsPerSample=0,this._samplingRate=0,this._samplesPerChannel=0}}class fo{constructor(){n(this,"_fileByte");n(this,"_fileDataView");n(this,"_fileSize");n(this,"_readOffset");this._fileByte=null,this._fileDataView=null,this._fileSize=0,this._readOffset=0}get8(){const t=this._fileDataView.getUint8(this._readOffset);return this._readOffset++,t}get16LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=2,t}get24LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=3,t}get32LittleEndian(){const t=this._fileDataView.getUint8(this._readOffset+3)<<24|this._fileDataView.getUint8(this._readOffset+2)<<16|this._fileDataView.getUint8(this._readOffset+1)<<8|this._fileDataView.getUint8(this._readOffset);return this._readOffset+=4,t}getCheckSignature(t){const e=new Uint8Array(4),i=new TextEncoder().encode(t);if(t.length!=4)return!1;for(let r=0;r<4;r++)e[r]=this.get8();return e[0]==i[0]&&e[1]==i[1]&&e[2]==i[2]&&e[3]==i[3]}}class yo extends Re{constructor(){super();n(this,"modelSetting");n(this,"modelHomeDir");n(this,"userTimeSeconds");n(this,"eyeBlinkIds");n(this,"lipSyncIds");n(this,"motions");n(this,"expressions");n(this,"_hitArea");n(this,"_userArea");n(this,"idParamAngleX");n(this,"idParamAngleY");n(this,"idParamAngleZ");n(this,"idParamEyeBallX");n(this,"idParamEyeBallY");n(this,"idParamBodyAngleX");n(this,"state");n(this,"expressionCount");n(this,"textureCount");n(this,"motionCount");n(this,"allMotionCount");n(this,"wavFileHandler");n(this,"_rightArmMotionManager");n(this,"_leftArmMotionManager");this.modelSetting=null,this.modelHomeDir=null,this.userTimeSeconds=0,this.eyeBlinkIds=new v,this.lipSyncIds=new v,this.motions=new H,this.expressions=new H,this._hitArea=new v,this._userArea=new v,this.idParamAngleX=R.getIdManager().getId(C.ParamAngleX),this.idParamAngleY=R.getIdManager().getId(C.ParamAngleY),this.idParamAngleZ=R.getIdManager().getId(C.ParamAngleZ),this.idParamEyeBallX=R.getIdManager().getId(C.ParamEyeBallX),this.idParamEyeBallY=R.getIdManager().getId(C.ParamEyeBallY),this.idParamBodyAngleX=R.getIdManager().getId(C.ParamBodyAngleX),this.state=0,this.expressionCount=0,this.textureCount=0,this.motionCount=0,this.allMotionCount=0,this.wavFileHandler=new pe,this._rightArmMotionManager=new Kt,this._leftArmMotionManager=new Kt}get model(){return this._model}loadAssets(e,i){this.modelHomeDir=e,fetch(tt.join(e,i)).then(r=>r.arrayBuffer()).then(r=>{const a=new Ws(r,r.byteLength);this.state=1,this.setupModel(a)})}setupModel(e){if(this._updating=!0,this._initialized=!1,this.modelSetting=e,this.modelSetting.getModelFileName()!=""){const c=this.modelSetting.getModelFileName();fetch(tt.join(this.modelHomeDir,c)).then(d=>d.arrayBuffer()).then(d=>{this.loadModel(d),this.state=3,i()}),this.state=2}else T.printMessage("Model data does not exist.");const i=()=>{if(this.modelSetting.getExpressionCount()>0){const c=this.modelSetting.getExpressionCount();for(let d=0;d<c;d++){const _=this.modelSetting.getExpressionName(d),f=this.modelSetting.getExpressionFileName(d);fetch(tt.join(this.modelHomeDir,f)).then(b=>b.arrayBuffer()).then(b=>{const y=this.loadExpression(b,b.byteLength,_);this.expressions.getValue(_)!=null&&(Ut.delete(this.expressions.getValue(_)),this.expressions.setValue(_,null)),this.expressions.setValue(_,y),this.expressionCount++,this.expressionCount>=c&&(this.state=5,r())})}this.state=4}else this.state=5,r()},r=()=>{if(this.modelSetting.getPhysicsFileName()!=""){const c=this.modelSetting.getPhysicsFileName();fetch(tt.join(this.modelHomeDir,c)).then(d=>d.arrayBuffer()).then(d=>{this.loadPhysics(d,d.byteLength),this.state=7,a()}),this.state=6}else this.state=7,a()},a=()=>{if(this.modelSetting.getPoseFileName()!=""){const c=this.modelSetting.getPoseFileName();fetch(tt.join(this.modelHomeDir,c)).then(d=>d.arrayBuffer()).then(d=>{this.loadPose(d,d.byteLength),this.state=9,l()}),this.state=8}else this.state=9,l()},l=()=>{this.modelSetting.getEyeBlinkParameterCount()>0&&(this._eyeBlink=kt.create(this.modelSetting),this.state=10),o()},o=()=>{this._breath=re.create();const c=new v;c.pushBack(new Vt(this.idParamAngleX,0,15,6.5345,.5)),c.pushBack(new Vt(this.idParamAngleY,0,8,3.5345,.5)),c.pushBack(new Vt(this.idParamAngleZ,0,10,5.5345,.5)),c.pushBack(new Vt(this.idParamBodyAngleX,0,4,15.5345,.5)),c.pushBack(new Vt(R.getIdManager().getId(C.ParamBreath),.5,.5,3.2345,1)),this._breath.setParameters(c),this.state=11,h()},h=()=>{if(this.modelSetting.getUserDataFile()!==""){const c=this.modelSetting.getUserDataFile();fetch(tt.join(this.modelHomeDir,c)).then(d=>d.arrayBuffer()).then(d=>{this.loadUserData(d,d.byteLength),this.state=13,u()}),this.state=12}else this.state=13,u()},u=()=>{const c=this.modelSetting.getEyeBlinkParameterCount();for(let d=0;d<c;++d)this.eyeBlinkIds.pushBack(this.modelSetting.getEyeBlinkParameterId(d));this.state=14,g()},g=()=>{const c=this.modelSetting.getLipSyncParameterCount();for(let d=0;d<c;++d)this.lipSyncIds.pushBack(this.modelSetting.getLipSyncParameterId(d));this.state=15,m()},m=()=>{const c=new H;if(this.modelSetting===null||this._modelMatrix===null){X("Failed to setupLayout().");return}this.modelSetting.getLayoutMap(c),this._modelMatrix.setupFromLayout(c),this.state=16,p()},p=()=>{this.state=17,this.model.saveParameters(),this.allMotionCount=0,this.motionCount=0;const c=[],d=this.modelSetting.getMotionGroupCount();for(let _=0;_<d;_++)c[_]=this.modelSetting.getMotionGroupName(_),this.allMotionCount+=this.modelSetting.getMotionCount(c[_]);for(let _=0;_<d;_++)this.preLoadMotionGroup(c[_]);d==0&&this.reloadTextures()}}setupTextures(){var e;if(this.state===20){const i=this.modelSetting.getTextureCount();for(let r=0;r<i;r++){if(this.modelSetting.getTextureFileName(r)===""){T.printMessage("getTextureFileName null");continue}const a=this.modelSetting.getTextureFileName(r),l=tt.join(this.modelHomeDir,a),o=h=>{var u;(u=this.getRenderer())==null||u.bindTexture(r,h.id),this.textureCount++,this.textureCount>=i&&(this.state=22)};w.instance.textureManager.createTextureFromPngFile(l,!0,o),(e=this.getRenderer())==null||e.setIsPremultipliedAlpha(!0)}this.state=21}}reloadRenderer(){this.deleteRenderer(),this.createRenderer(),this.setupTextures()}update(){var r,a,l,o,h,u;if(this.state!=22)return;const e=T.getDeltaTime();this.userTimeSeconds+=e,this._dragManager.update(e),this._dragX=this._dragManager.getX(),this._dragY=this._dragManager.getY();let i=!1;if(this.model.loadParameters(),this._motionManager.isFinished())this.startRandomMotion(Lt.Idle,lt.Idle);else{const g=this._motionManager.updateMotion(this.model,e),m=this._rightArmMotionManager.updateMotion(this.model,e),p=this._leftArmMotionManager.updateMotion(this.model,e);i=[g,m,p].some(c=>c)}if(this.model.saveParameters(),i||((r=this._eyeBlink)==null||r.updateParameters(this.model,e)),(a=this._expressionManager)==null||a.updateMotion(this.model,e),this.model.addParameterValueById(this.idParamAngleX,this._dragX*30),this.model.addParameterValueById(this.idParamAngleY,this._dragY*30),this.model.addParameterValueById(this.idParamAngleZ,this._dragX*this._dragY*-30),this.model.addParameterValueById(this.idParamBodyAngleX,this._dragX*10),this.model.addParameterValueById(this.idParamEyeBallX,this._dragX),this.model.addParameterValueById(this.idParamEyeBallY,this._dragY),(l=this._breath)==null||l.updateParameters(this.model,e),(o=this._physics)==null||o.evaluate(this.model,e),this._lipsync){(h=this.wavFileHandler)==null||h.update(e);const g=this.wavFileHandler.getRms();for(let m=0;m<this.lipSyncIds.getSize();++m)this.model.addParameterValueById(this.lipSyncIds.at(m),g,.8)}(u=this._pose)==null||u.updateParameters(this.model,e),this.model.update()}startMotion(e,i,r,a){if(r==lt.Force)this._motionManager.setReservePriority(r);else if(!this._motionManager.reserveMotion(r))return this._debugMode&&T.printMessage("[APP]can't start motion."),vt;const{motion:l,autoDelete:o}=this.getMotion(e,i,a),h=this.modelSetting.getMotionSoundFileName(e,i);if(h.localeCompare("")!=0){let u=this.modelHomeDir+h;this.wavFileHandler.start(u).catch()}return this._debugMode&&T.printMessage(`[APP]start motion: [${e}_${i}`),this._motionManager.startMotionPriority(l,o,r)}startRandomMotion(e,i,r){if(this.modelSetting.getMotionCount(e)==0)return vt;const a=Math.floor(Math.random()*this.modelSetting.getMotionCount(e));return this.startMotion(e,a,i,r)}getMotion(e,i,r){const a=this.modelSetting.getMotionFileName(e,i),l=`${e}_${i}`;let o=this.motions.getValue(l),h=!1;const u=tt.join(this.modelHomeDir,a);return o==null?fetch(u).then(g=>g.arrayBuffer()).then(g=>{o=this.loadMotion(g,g.byteLength,null,r);let m=this.modelSetting.getMotionFadeInTimeValue(e,i);m>=0&&o.setFadeInTime(m),m=this.modelSetting.getMotionFadeOutTimeValue(e,i),m>=0&&o.setFadeOutTime(m),o.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),h=!0}):o.setFinishedMotionHandler(r),{motion:o,autoDelete:h}}startHandMotion(e,i,r,a,l){if(a==lt.Force)e.setReservePriority(a);else if(!e.reserveMotion(a))return this._debugMode&&T.printMessage("[APP]can't start motion."),vt;const{motion:o,autoDelete:h}=this.getMotion(i,r,l),u=this.modelSetting.getMotionSoundFileName(i,r);if(u.localeCompare("")!=0){let g=this.modelHomeDir+u;this.wavFileHandler.start(g).catch()}return this._debugMode&&T.printMessage(`[APP]start motion: ${name}`),e.startMotionPriority(o,h,a)}startRandomRightHandMotion(e,i,r){if(this.modelSetting.getMotionCount(e)==0)return vt;let a=Math.floor(Math.random()*this.modelSetting.getMotionCount(e));return this.startHandMotion(this._rightArmMotionManager,e,a,i,r)}startRandomLeftHandMotion(e,i,r){if(this.modelSetting.getMotionCount(e)==0)return vt;let a=Math.floor(Math.random()*this.modelSetting.getMotionCount(e));return this.startHandMotion(this._leftArmMotionManager,e,a,i,r)}setExpression(e){const i=this.expressions.getValue(e);this._debugMode&&T.printMessage(`[APP]expression: [${e}]`),i!=null?this._expressionManager.startMotionPriority(i,!1,lt.Force):this._debugMode&&T.printMessage(`[APP]expression[${e}] is null`)}setRandomExpression(){if(this.expressions.getSize()==0)return;const e=Math.floor(Math.random()*this.expressions.getSize());for(let i=0;i<this.expressions.getSize();i++)if(i==e){const r=this.expressions._keyValues[i].first;this.setExpression(r);return}}motionEventFired(e){nt("{0} is fired on LAppModel!!",e.s)}hitOpacity(){return this._opacity<1}hitTest(e,i,r){if(this.hitOpacity())return!1;const a=this.modelSetting.getHitAreasCount();for(let l=0;l<a;l++)if(this.modelSetting.getHitAreaName(l)==e){const o=this.modelSetting.getHitAreaId(l);return this.isHit(o,i,r)}return!1}preLoadMotionGroup(e){for(let i=0;i<this.modelSetting.getMotionCount(e);i++){const r=this.modelSetting.getMotionFileName(e,i),a=`${e}_${i}`;this._debugMode&&T.printMessage(`[APP]load motion: ${r} => [${a}]`),fetch(tt.join(this.modelHomeDir,r)).then(l=>l.arrayBuffer()).then(l=>{const o=this.loadMotion(l,l.byteLength,a);let h=this.modelSetting.getMotionFadeInTimeValue(e,i);h>=0&&o.setFadeInTime(h),h=this.modelSetting.getMotionFadeOutTimeValue(e,i),h>=0&&o.setFadeOutTime(h),o.setEffectIds(this.eyeBlinkIds,this.lipSyncIds),this.motions.getValue(a)!=null&&Ut.delete(this.motions.getValue(a)),this.motions.setValue(a,o),this.motionCount++,this.motionCount>=this.allMotionCount&&this.reloadTextures()})}}reloadTextures(){var e;this.state=20,(e=this._motionManager)==null||e.stopAllMotions(),this._updating=!1,this._initialized=!0,this.createRenderer(),this.setupTextures(),this.getRenderer().startUp(w.gl)}releaseMotions(){this.motions.clear()}releaseExpressions(){this.expressions.clear()}doDraw(){if(this.model==null)return;const e=[0,0,w.canvas.width,w.canvas.height];this.getRenderer().setRenderState(w.frameBuffer,e),this.getRenderer().drawModel()}draw(e){this.model!==null&&this.state==22&&(e.multiplyByMatrix(this._modelMatrix),this.getRenderer().setMvpMatrix(e),this.doDraw())}release(){this._leftArmMotionManager.release(),this._rightArmMotionManager.release(),this.wavFileHandler.release(),super.release()}}const li=class{constructor(){n(this,"viewMatrix");n(this,"models");n(this,"sceneIndex");n(this,"_finishedMotion",t=>{T.printMessage("Motion Finished: OK")});this.viewMatrix=new k,this.models=new v,this.sceneIndex=0,this.changeScene(0)}static get instance(){return this.initialize()}static initialize(){return this._instance==null&&(this._instance=new li),this._instance}static releaseInstance(){this._instance!=null&&(this._instance=void 0),this._instance=null}getModel(t){return t<this.models.getSize()?this.models.at(t):null}releaseAllModel(){for(let t=0;t<this.models.getSize();t++)this.models.at(t).release(),this.models.set(t,null);this.models.clear()}onDrag(t,e){for(let i=0;i<this.models.getSize();i++){const r=this.getModel(i);r&&r.setDragging(t,e)}}onTap(t,e){T.printMessage(`[APP]tap point: {x: ${t.toFixed(2)} y: ${e.toFixed(2)}}`);for(let i=0;i<this.models.getSize();i++){const r=this.models.at(i);if(r.modelSetting.getHitAreasCount()===0){T.printMessage(`[APP]hit area: [${D.Other}]`),r.startRandomMotion(Lt.Tap,lt.Normal,this._finishedMotion),Et.emit(D.Other);return}r.hitTest(D.Head,t,e)?(T.printMessage(`[APP]hit area: [${D.Head}]`),r.setRandomExpression(),Et.emit(D.Head)):r.hitTest(D.Left,t,e)?(T.printMessage(`[APP]hit area: [${D.Body+D.Left}]`),r.startRandomLeftHandMotion(Lt.TapLeft,lt.Normal,this._finishedMotion),Et.emit(D.Left)):r.hitTest(D.Right,t,e)?(T.printMessage(`[APP]hit area: [${D.Body+D.Right}]`),r.startRandomRightHandMotion(Lt.TapRight,lt.Normal,this._finishedMotion),Et.emit(D.Right)):r.hitTest(D.Body,t,e)&&(T.printMessage(`[APP]hit area: [${D.Body}]`),r.startRandomMotion(Lt.TapBody,lt.Normal,this._finishedMotion),Et.emit(D.Body))}}onUpdate(){const{width:t,height:e}=w.canvas,i=this.models.getSize();for(let r=0;r<i;++r){const a=new k,l=this.getModel(r);l.getModel()&&(l.getModel().getCanvasWidth()>1&&t<e?(l.getModelMatrix().setWidth(2),a.scale(1,t/e)):a.scale(e/t,1),a.multiplyByMatrix(this.viewMatrix)),l.update(),l.draw(a)}}prevScene(){const t=(this.sceneIndex-1)%j.source.models.length;this.changeScene(t)}nextScene(){const t=(this.sceneIndex+1)%j.source.models.length;this.changeScene(t)}changeScene(t){this.sceneIndex=t,T.printMessage(`[APP]model index: ${this.sceneIndex}`);const e=j.source.models.at(t),i=tt.join(j.source.path,e);let r=`${e}.model3.json`;this.releaseAllModel(),this.models.pushBack(new yo),this.models.at(0).loadAssets(i,r)}setViewMatrix(t){for(let e=0;e<16;e++)this.viewMatrix.getArray()[e]=t.getArray()[e]}};let Q=li;n(Q,"_instance",null);class xo{constructor(){n(this,"textures");this.textures=new v}release(){for(let t=this.textures.begin();t.notEqual(this.textures.end());t.preIncrement())w.gl.deleteTexture(t.ptr().id);this.textures=new v}createTextureFromPngFile(t,e,i){for(let a=this.textures.begin();a.notEqual(this.textures.end());a.preIncrement())if(a.ptr().fileName==t&&a.ptr().usePremultply==e){a.ptr().img=new Image,a.ptr().img.onload=()=>i(a.ptr()),a.ptr().img.src=t;return}const r=new Image;r.onload=()=>{const a=w.gl,l=a.createTexture();a.bindTexture(a.TEXTURE_2D,l),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR_MIPMAP_LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),e&&a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,1),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r),a.generateMipmap(a.TEXTURE_2D),a.bindTexture(a.TEXTURE_2D,null);const o=new So;o!=null&&(o.fileName=t,o.width=r.width,o.height=r.height,o.id=l,o.img=r,o.usePremultply=e,this.textures.pushBack(o)),i(o)},r.src=t}releaseTextures(){for(let t=0;t<this.textures.getSize();t++)this.textures.set(t,null);this.textures.clear()}releaseTextureByTexture(t){for(let e=0;e<this.textures.getSize();e++)if(this.textures.at(e).id==t){this.textures.set(e,null),this.textures.remove(e);break}}releaseTextureByFilePath(t){for(let e=0;e<this.textures.getSize();e++)if(this.textures.at(e).fileName==t){this.textures.set(e,null),this.textures.remove(e);break}}}class So{constructor(){n(this,"img");n(this,"id",null);n(this,"width",0);n(this,"height",0);n(this,"usePremultply");n(this,"fileName")}}class Sr extends k{constructor(){super();n(this,"_screenLeft");n(this,"_screenRight");n(this,"_screenTop");n(this,"_screenBottom");n(this,"_maxLeft");n(this,"_maxRight");n(this,"_maxTop");n(this,"_maxBottom");n(this,"_maxScale");n(this,"_minScale");this._screenLeft=0,this._screenRight=0,this._screenTop=0,this._screenBottom=0,this._maxLeft=0,this._maxRight=0,this._maxTop=0,this._maxBottom=0,this._maxScale=0,this._minScale=0}adjustTranslate(e,i){this._tr[0]*this._maxLeft+(this._tr[12]+e)>this._screenLeft&&(e=this._screenLeft-this._tr[0]*this._maxLeft-this._tr[12]),this._tr[0]*this._maxRight+(this._tr[12]+e)<this._screenRight&&(e=this._screenRight-this._tr[0]*this._maxRight-this._tr[12]),this._tr[5]*this._maxTop+(this._tr[13]+i)<this._screenTop&&(i=this._screenTop-this._tr[5]*this._maxTop-this._tr[13]),this._tr[5]*this._maxBottom+(this._tr[13]+i)>this._screenBottom&&(i=this._screenBottom-this._tr[5]*this._maxBottom-this._tr[13]);const r=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,i,0,1]);k.multiply(r,this._tr,this._tr)}adjustScale(e,i,r){const a=this.getMaxScale(),l=this.getMinScale(),o=r*this._tr[0];o<l?this._tr[0]>0&&(r=l/this._tr[0]):o>a&&this._tr[0]>0&&(r=a/this._tr[0]);const h=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,e,i,0,1]),u=new Float32Array([r,0,0,0,0,r,0,0,0,0,1,0,0,0,0,1]),g=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,-e,-i,0,1]);k.multiply(g,this._tr,this._tr),k.multiply(u,this._tr,this._tr),k.multiply(h,this._tr,this._tr)}setScreenRect(e,i,r,a){this._screenLeft=e,this._screenRight=i,this._screenBottom=r,this._screenTop=a}setMaxScreenRect(e,i,r,a){this._maxLeft=e,this._maxRight=i,this._maxTop=a,this._maxBottom=r}setMaxScale(e){this._maxScale=e}setMinScale(e){this._minScale=e}getMaxScale(){return this._maxScale}getMinScale(){return this._minScale}isMaxScale(){return this.getScaleX()>=this._maxScale}isMinScale(){return this.getScaleX()<=this._minScale}getScreenLeft(){return this._screenLeft}getScreenRight(){return this._screenRight}getScreenBottom(){return this._screenBottom}getScreenTop(){return this._screenTop}getMaxLeft(){return this._maxLeft}getMaxRight(){return this._maxRight}getMaxBottom(){return this._maxBottom}getMaxTop(){return this._maxTop}}var Rs;(s=>{s.CubismViewMatrix=Sr})(Rs||(Rs={}));class Co{constructor(t,e,i,r,a,l){n(this,"texture");n(this,"vertexBuffer");n(this,"uvBuffer");n(this,"indexBuffer");n(this,"rect");n(this,"positionLocation");n(this,"uvLocation");n(this,"textureLocation");n(this,"positionArray");n(this,"uvArray");n(this,"indexArray");n(this,"firstDraw");n(this,"hitCallback");this.rect=new Mo,this.rect.left=t-i*.5,this.rect.right=t+i*.5,this.rect.up=e+r*.5,this.rect.down=e-r*.5,this.texture=a,this.vertexBuffer=null,this.uvBuffer=null,this.indexBuffer=null,this.positionLocation=null,this.uvLocation=null,this.textureLocation=null,this.positionArray=null,this.uvArray=null,this.indexArray=null,this.firstDraw=!0,this.hitCallback=l}release(){this.rect=null;const t=w.gl;t.deleteTexture(this.texture),this.texture=null,t.deleteBuffer(this.uvBuffer),this.uvBuffer=null,t.deleteBuffer(this.vertexBuffer),this.vertexBuffer=null,t.deleteBuffer(this.indexBuffer),this.indexBuffer=null}getTexture(){return this.texture}render(t){if(this.texture==null)return;const e=w.gl;if(this.firstDraw){this.positionLocation=e.getAttribLocation(t,"position"),e.enableVertexAttribArray(this.positionLocation),this.uvLocation=e.getAttribLocation(t,"uv"),e.enableVertexAttribArray(this.uvLocation),this.textureLocation=e.getUniformLocation(t,"texture"),e.uniform1i(this.textureLocation,0),this.uvArray=new Float32Array([1,0,0,0,0,1,1,1]),this.uvBuffer=e.createBuffer();{const i=w.canvas.width,r=w.canvas.height;this.positionArray=new Float32Array([(this.rect.right-i*.5)/(i*.5),(this.rect.up-r*.5)/(r*.5),(this.rect.left-i*.5)/(i*.5),(this.rect.up-r*.5)/(r*.5),(this.rect.left-i*.5)/(i*.5),(this.rect.down-r*.5)/(r*.5),(this.rect.right-i*.5)/(i*.5),(this.rect.down-r*.5)/(r*.5)]),this.vertexBuffer=e.createBuffer()}this.indexArray=new Uint16Array([0,1,2,3,2,0]),this.indexBuffer=e.createBuffer(),this.firstDraw=!1}e.bindBuffer(e.ARRAY_BUFFER,this.uvBuffer),e.bufferData(e.ARRAY_BUFFER,this.uvArray,e.STATIC_DRAW),e.vertexAttribPointer(this.uvLocation,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ARRAY_BUFFER,this.vertexBuffer),e.bufferData(e.ARRAY_BUFFER,this.positionArray,e.STATIC_DRAW),e.vertexAttribPointer(this.positionLocation,2,e.FLOAT,!1,0,0),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,this.indexBuffer),e.bufferData(e.ELEMENT_ARRAY_BUFFER,this.indexArray,e.DYNAMIC_DRAW),e.bindTexture(e.TEXTURE_2D,this.texture),e.drawElements(e.TRIANGLES,this.indexArray.length,e.UNSIGNED_SHORT,0)}isHit(t,e){const{height:i}=w.canvas,r=i-e;return t>=this.rect.left&&t<=this.rect.right&&r<=this.rect.up&&r>=this.rect.down}}class Mo{constructor(){n(this,"left");n(this,"right");n(this,"up");n(this,"down")}}class vo{constructor(){n(this,"startY");n(this,"startX");n(this,"lastX");n(this,"lastY");n(this,"lastX1");n(this,"lastY1");n(this,"lastX2");n(this,"lastY2");n(this,"lastTouchDistance");n(this,"deltaX");n(this,"deltaY");n(this,"scale");n(this,"touchSingle");n(this,"flipAvailable");this.startX=0,this.startY=0,this.lastX=0,this.lastY=0,this.lastX1=0,this.lastY1=0,this.lastX2=0,this.lastY2=0,this.lastTouchDistance=0,this.deltaX=0,this.deltaY=0,this.scale=1,this.touchSingle=!1,this.flipAvailable=!1}getCenterX(){return this.lastX}getCenterY(){return this.lastY}getDeltaX(){return this.deltaX}getDeltaY(){return this.deltaY}getStartX(){return this.startX}getStartY(){return this.startY}getScale(){return this.scale}getX(){return this.lastX}getY(){return this.lastY}getX1(){return this.lastX1}getY1(){return this.lastY1}getX2(){return this.lastX2}getY2(){return this.lastY2}isSingleTouch(){return this.touchSingle}isFlickAvailable(){return this.flipAvailable}disableFlick(){this.flipAvailable=!1}touchesBegan(t,e){this.lastX=t,this.lastY=e,this.startX=t,this.startY=e,this.lastTouchDistance=-1,this.flipAvailable=!0,this.touchSingle=!0}touchesMoved(t,e){this.lastX=t,this.lastY=e,this.lastTouchDistance=-1,this.touchSingle=!0}getFlickDistance(){return this.calculateDistance(this.startX,this.startY,this.lastX,this.lastY)}calculateDistance(t,e,i,r){return Math.sqrt((t-i)*(t-i)+(e-r)*(e-r))}calculateMovingAmount(t,e){if(t>0!=e>0)return 0;const i=t>0?1:-1,r=Math.abs(t),a=Math.abs(e);return i*(r<a?r:a)}}class Bo{constructor(){n(this,"touchManager");n(this,"deviceToScreen");n(this,"viewMatrix");n(this,"sprites",[]);n(this,"programId");n(this,"released",!1);this.programId=null,this.released=!1,this.touchManager=new vo,this.deviceToScreen=new k,this.viewMatrix=new Sr}initialize(){const{width:t,height:e}=w.canvas,i=t/e,r=-i,a=i??me.Right,l=me.Bottom,o=me.Top;if(this.viewMatrix.setScreenRect(r,a,l,o),this.viewMatrix.scale(j.scale,j.scale),this.deviceToScreen.loadIdentity(),t>e){const h=Math.abs(a-r);this.deviceToScreen.scaleRelative(h/t,-h/t)}else{const h=Math.abs(o-l);this.deviceToScreen.scaleRelative(h/e,-h/e)}this.deviceToScreen.translateRelative(-t*.5,-e*.5),this.viewMatrix.setMaxScale(He.Max),this.viewMatrix.setMinScale(He.Min),this.viewMatrix.setMaxScreenRect(Ht.Left,Ht.Right,Ht.Bottom,Ht.Top)}release(){this.sprites.forEach(t=>t.release()),this.sprites.length=0,w.gl.deleteProgram(this.programId),this.released=!0}render(){const t=w.gl;t.useProgram(this.programId),this.sprites.forEach(e=>e.render(this.programId)),t.flush(),Q.instance.setViewMatrix(this.viewMatrix),Q.instance.onUpdate()}addSprite(t,e,i,r){w.instance.textureManager.createTextureFromPngFile(t,!1,a=>{const{width:l,height:o}=w.canvas,h=e?e.x:l-a.width*.5,u=e?e.y:o-a.height*.5,g=i?i.width:a.width,m=i?i.height:a.height,p=new Co(h,u,g,m,a.id,r);this.sprites.push(p)})}initializeSprite(){this.programId=w.instance.createShader()}onTouchesBegan(t,e){this.touchManager.touchesBegan(t,e)}onTouchesMoved(t,e){const i=this.transformViewX(this.touchManager.getX()),r=this.transformViewY(this.touchManager.getY());this.touchManager.touchesMoved(t,e),Q.instance.onDrag(i,r)}onTouchesEnded(t,e){Q.instance.onDrag(0,0);{const i=this.deviceToScreen.transformX(this.touchManager.getX()),r=this.deviceToScreen.transformY(this.touchManager.getY());"ontouchend"in w.canvas&&T.printMessage(`[APP]touchesEnded x: ${i} y: ${r}`),Q.instance.onTap(i,r),this.sprites.forEach(a=>{a.isHit(t,e)&&a.hitCallback()})}}transformViewX(t){const e=this.deviceToScreen.transformX(t);return this.viewMatrix.invertTransformX(e)}transformViewY(t){const e=this.deviceToScreen.transformY(t);return this.viewMatrix.invertTransformY(e)}transformScreenX(t){return this.deviceToScreen.transformX(t)}transformScreenY(t){return this.deviceToScreen.transformY(t)}}const O=class{constructor(){n(this,"cubismOption");n(this,"view");n(this,"captured");n(this,"textureManager");n(this,"canvasId","live2d-canvas");this.captured=!1,this.cubismOption=new Ma,this.view=new Bo,this.textureManager=new xo}static get instance(){return this._instance==null&&(this._instance=new O),this._instance}static releaseInstance(){this._instance!=null&&this._instance.release(),this._instance=null}initialize(){const t=O.canvas=this.getCanvas(),e=O.gl=t.getContext("webgl")||t.getContext("experimental-webgl");return e?(O.frameBuffer||(O.frameBuffer=e.getParameter(e.FRAMEBUFFER_BINDING)),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.onEvent(),this.view.initialize(),this.initializeCubism(),!0):(alert("Cannot initialize WebGL. This browser does not support."),O.gl=null,bt.body.innerHTML="This browser does not support the <code>&lt;canvas&gt;</code> element.",!1)}getCanvas(){let t=bt.querySelector(`#${this.canvasId}`);return t?this.release():(t=bt.createElement("canvas"),t.setAttribute("id",this.canvasId)),j.canvas==="auto"?this._resizeCanvas():(t.width=j.canvas.width||t.width,t.height=j.canvas.height||t.height),j.target.appendChild(t),t}onEvent(){const t=O.canvas;"ontouchend"in t?(t.ontouchstart=Io,t.ontouchmove=To,t.ontouchend=Vs,t.ontouchcancel=Vs):(t.onmousedown=bo,t.onmousemove=Po,t.onmouseup=wo)}onResize(){this._resizeCanvas(),this.view.initialize(),this.view.initializeSprite();const{width:t,height:e}=O.canvas;O.gl.viewport(0,0,t,e)}release(){this.textureManager.release(),this.view.release(),Q.releaseInstance(),R.dispose()}run(){const t=()=>{if(O.instance==null)return;T.updateTime();const e=O.gl;e.clearColor(0,0,0,0),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.clearDepth(1),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),this.view.render(),requestAnimationFrame(t)};t()}createShader(){const t=O.gl,e=t.createShader(t.VERTEX_SHADER);if(e===null)return T.printMessage("failed to create vertexShader"),null;const i=`
        precision mediump float;
        attribute vec3 position;
        attribute vec2 uv;
        varying vec2 vuv;
        void main(void)
        {
           gl_Position = vec4(position, 1.0);
           vuv = uv;
        }
      `;t.shaderSource(e,i),t.compileShader(e);const r=t.createShader(t.FRAGMENT_SHADER);if(r==null)return T.printMessage("failed to create fragmentShader"),null;const a=`
        precision mediump float;
        varying vec2 vuv;
        uniform sampler2D texture;
        void main(void)
        {
           gl_FragColor = texture2D(texture, vuv);
        }
      `;t.shaderSource(r,a),t.compileShader(r);const l=t.createProgram();return t.attachShader(l,e),t.attachShader(l,r),t.deleteShader(e),t.deleteShader(r),t.linkProgram(l),t.useProgram(l),l}initializeCubism(){this.cubismOption.logFunction=T.printMessage,this.cubismOption.loggingLevel=At.LogLevel_Error,R.startUp(this.cubismOption),R.initialize(),Q.initialize(),T.updateTime(),this.view.initializeSprite()}_resizeCanvas(){O.canvas.width=window.innerWidth,O.canvas.height=window.innerHeight}};let w=O;n(w,"_instance",null),n(w,"frameBuffer",null),n(w,"canvas",null),n(w,"gl",null);function bo(s){if(w.instance.captured=!0,w.instance.view.released){T.printMessage("view released");return}const t=s.target.getBoundingClientRect(),e=s.pageX-t.left,i=s.pageY-t.top;w.instance.view.onTouchesBegan(e,i)}function Po(s){if(!w.instance.captured)return;if(w.instance.view.released){T.printMessage("view released");return}const t=s.target.getBoundingClientRect(),e=s.clientX-t.left,i=s.clientY-t.top;w.instance.view.onTouchesMoved(e,i)}function wo(s){if(w.instance.captured=!1,w.instance.view.released){T.printMessage("view released");return}const t=s.target.getBoundingClientRect(),e=s.clientX-t.left,i=s.clientY-t.top;w.instance.view.onTouchesEnded(e,i)}function Io(s){if(w.instance.captured=!0,w.instance.view.released){T.printMessage("view released");return}const t=s.target.getBoundingClientRect(),e=s.changedTouches[0].clientX-t.left,i=s.changedTouches[0].clientY-t.top;w.instance.view.onTouchesBegan(e,i)}function To(s){if(!w.instance.captured)return;if(w.instance.view.released){T.printMessage("view released");return}const t=s.target.getBoundingClientRect(),e=s.changedTouches[0].clientX-t.left,i=s.changedTouches[0].clientY-t.top;w.instance.view.onTouchesMoved(e,i)}function Vs(s){if(w.instance.captured=!1,w.instance.view.released){T.printMessage("view released");return}const t=s.target.getBoundingClientRect(),e=s.changedTouches[0].clientX-t.left,i=s.changedTouches[0].clientY-t.top;w.instance.view.onTouchesEnded(e,i)}class Cr{static get model(){return w.instance}static get scene(){return Q.instance}static get view(){return this.model.view}static async loadScript(){return new Promise(t=>{globalThis.Live2DCubismCore&&t(globalThis.Live2DCubismCore);const e=bt.createElement("script");e.src=j.cubismCorePath,bt.body.appendChild(e),e.onload=()=>t(globalThis.Live2DCubismCore)})}static async init(t){fa(t),await this.loadScript(),this.model.initialize()&&(this.model.run(),this.listener())}static async release(){return this.model.release()}static listener(){window.addEventListener("beforeunload",()=>w.releaseInstance()),window.addEventListener("resize",()=>j.canvas==="auto"&&this.model.onResize())}static on(t,e){var i;(i=this.eventListener[t])==null||i.push(e)}static emit(t){var e;(e=this.eventListener[t])==null||e.forEach(i=>i())}}n(Cr,"eventListener",{[D.Head]:[],[D.Body]:[],[D.Left]:[],[D.Right]:[],[D.Other]:[]});var Et=Cr;const Ro=ie({__name:"Live2dWidget",props:{isDark:{type:Boolean}},setup(s){const t=s,e=Es(()=>localStorage.getItem("vitepress-theme-appearance")==="dark"||t.isDark),i=Gt(null);return Qe(()=>{i.value&&Et.init({canvas:{width:180,height:180},target:i.value,source:{path:di("/live2d/models"),models:e.value?["hijiki"]:["tororo"]},cubismCorePath:di("/live2d/core/live2dCubismCore.min.js")})}),(r,a)=>(pt(),ft("div",{id:"models",ref_key:"elRef",ref:i},null,512))}});const Vo=Ke(Ro,[["__scopeId","data-v-9b523d08"]]);const Eo=()=>{var s;return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test((s=globalThis.navigator)==null?void 0:s.userAgent)},Lo={...mi,Layout:()=>{var r;const{frontmatter:s,isDark:t,site:e}=Ds(),{path:i}=Rr();return Vr(()=>{Ao(),!Eo()&&i!==e.value.base&&Do(t.value)}).catch(a=>console.error(a)),Pe(mi.Layout,{class:(r=s.value)==null?void 0:r.layoutClass})}},Ao=()=>{if(!globalThis.document)return;document.querySelectorAll("p > img").forEach(t=>{const e=t.parentElement;if(!e)return;let i=e;e.childNodes.length>1&&(i=document.createElement("div"),e.appendChild(i));const r=Pe(pa,{src:t.getAttribute("src")});t.remove(),Fs(r,i)})},Do=s=>{globalThis.document&&Fs(Pe(Vo,{isDark:s}),document.body)};function Mr(s){if(s.extends){const t=Mr(s.extends);return{...t,...s,async enhanceApp(e){t.enhanceApp&&await t.enhanceApp(e),s.enhanceApp&&await s.enhanceApp(e)}}}return s}const Ot=Mr(Lo),Fo=ie({name:"VitePressApp",setup(){const{site:s}=Ds();return Ls(()=>{Qe(()=>{document.documentElement.lang=s.value.lang,document.documentElement.dir=s.value.dir})}),Lr(),Ar(),Dr(),Ot.setup&&Ot.setup(),()=>Pe(Ot.Layout)}});async function ko(){const s=Oo(),t=No();t.provide(Fr,s);const e=kr(s.route);return t.provide(Nr,e),t.component("Content",Or),t.component("ClientOnly",zr),Object.defineProperties(t.config.globalProperties,{$frontmatter:{get(){return e.frontmatter.value}},$params:{get(){return e.page.value.params}}}),Ot.enhanceApp&&await Ot.enhanceApp({app:t,router:s,siteData:Ur}),{app:t,router:s,data:e}}function No(){return jr(Fo)}function Oo(){let s=Ye,t;return Yr(e=>{let i=Xr(e);return s&&(t=i),(s||t===i)&&(i=i.replace(/\.js$/,".lean.js")),Ye&&(s=!1),Hr(()=>import(i),[])},Ot.NotFound)}Ye&&ko().then(({app:s,router:t,data:e})=>{t.go().then(()=>{Er(t.route,e.site),s.mount("#app")})});export{ko as createApp};
